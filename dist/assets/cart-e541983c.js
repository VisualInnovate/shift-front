import{_ as ne,a as ie,q as ce,u as de,r as g,s as j,B as ue,o as _e,c as n,d as i,f as s,e as W,h as o,t as a,F as D,k as M,m as f,D as z,a0 as me,g as R,G as H,j as A,y as ve,x as J,z as ye}from"./index-df8b6085.js";const be={class:"max-w-7xl mx-auto p-4 sm:p-6 lg:p-8 font-inter"},fe={class:"flex lg:flex-row flex-col gap-10"},pe={class:"flex-1 bg-white rounded-2xl shadow-lg p-6"},ge={key:0,class:"flex justify-center items-center py-12 gap-4"},he={class:"text-lg text-gray-700"},xe={key:1},we={class:"mb-8"},ke={class:"text-lg font-semibold text-gray-800 mb-4"},qe={class:"flex flex-wrap gap-3"},Ae=["onClick"],Se={key:0,class:"text-xs block opacity-80"},Fe={class:"mb-8"},Ce={class:"text-lg font-semibold text-gray-800 mb-3"},De={key:0,class:"relative flex gap-3 items-center"},Me={value:null,disabled:""},Ne=["value"],je={key:1,class:"p-4 bg-red-100 border border-red-300 rounded-lg"},$e={class:"text-red-700 font-medium mb-3"},Te={key:0,class:"text-center py-16 text-gray-500 text-lg"},Ie={key:1},Be=["src","alt"],Ee={class:"flex-1"},ze={class:"font-semibold text-gray-900 text-lg"},Pe={class:"text-yellow-700 text-sm mt-1"},Ve={key:0,class:"text-sm m-1 text-[#0b3baa] line-through opacity-80"},Oe={class:"flex flex-wrap items-center gap-6 mt-4"},Ue={class:"flex items-center border border-gray-300 rounded-lg overflow-hidden"},Le=["onClick","disabled"],We={class:"w-16 text-center font-medium py-2"},Re=["onClick"],He={class:"text-lg font-bold text-gray-900"},Je=["onClick"],Ke={class:"text-xl font-bold text-gray-800 mb-4"},Xe={class:"font-semibold"},Ye={key:1,class:"mb-4 p-4 bg-orange-100 border border-orange-300 rounded-lg text-orange-800 text-sm"},Ze={class:"font-semibold"},Qe={class:"mx-1 text-base opacity-90"},Ge={class:"space-y-3 text-sm"},et={class:"flex justify-between"},tt={class:"text-gray-600"},st={class:"font-medium"},at={class:"flex justify-between"},ot={class:"text-gray-600"},rt={class:"flex justify-between"},lt={class:"text-gray-600"},nt={class:"flex justify-between"},it={class:"text-gray-600"},ct={key:0,class:"flex justify-between"},dt={class:"text-green-600 font-medium"},ut={class:"text-green-600 font-medium"},_t={class:"flex justify-between"},mt={class:"text-gray-600"},vt={class:"flex justify-between"},yt={class:"text-green-600 font-medium"},bt={class:"text-green-600 font-medium"},ft={class:"flex justify-between text-lg font-bold text-gray-900 pt-4 border-t border-amber-300"},pt=["onClick","disabled"],gt={class:"lg:w-96 w-full bg-white rounded-2xl shadow-lg p-6 h-fit sticky top-6"},ht={class:"text-xl font-bold text-gray-800 mb-6"},xt={class:"space-y-4 text-sm border-b pb-6"},wt={class:"flex justify-between"},kt={class:"text-gray-600"},qt={class:"flex justify-between"},At={class:"text-gray-600"},St={key:0,class:"flex justify-between"},Ft={class:"text-green-600 font-medium"},Ct={class:"text-green-600 font-medium"},Dt={key:1,class:"flex justify-between"},Mt={class:"text-green-600 font-medium"},Nt={class:"text-green-600 font-medium"},jt={class:"flex justify-between text-xl font-bold pt-4 text-gray-900"},$t={class:"text-yellow-700"},Tt={key:0,class:"mt-4 p-4 bg-orange-100 border border-orange-300 rounded-lg text-orange-800 text-sm"},It={class:"font-semibold"},Bt={class:"mt-2 text-xs list-disc list-inside opacity-90"},Et={class:"mt-8"},zt=["placeholder"],Pt=["disabled"],Vt={class:"mt-6"},Ot={class:"block text-gray-700 font-medium mb-2"},Ut=["placeholder"],Lt=["disabled"],Wt={key:1,class:"text-red-500 text-xs mt-2 text-center"},Rt={__name:"cart",setup(Ht){const{t,locale:$}=ie(),u=ce(),K=de(),T=g(!0),S=g([]),v=g(null),b=g(""),w=g(""),k=g([]),q=g([]),_=g([]),h=g([]),P=r=>`${r.store_id}-${r.market_id||"default"}`,X=async()=>{try{const{data:r}=await A.get("/api/home/address");if(r.is_success&&(S.value=r.data,S.value.length>0)){const l=S.value.find(e=>e.is_default);v.value=l?l.id:S.value[0].id}}catch{u.add({severity:"error",summary:t("error"),detail:t("cart.addressLoadError"),life:4e3})}},Y=async()=>{try{T.value=!0;const{data:r}=await A.get("/api/cart");if(!r.is_success)return;const l=[],e=new Map;r.data.stores.forEach(c=>{const y=P(c);e.has(y)||e.set(y,{unique_store_id:y,store_id:c.store_id,display_name:$.value==="ar"?c.store_name_ar:c.store_name_en,market_name:$.value==="ar"?c.market_name_ar:c.market_name_en}),c.items.forEach(d=>{var O,U,L;const C=((O=d.variant)==null?void 0:O.price)||d.product.base_price||0,p=((L=(U=d.product.media)==null?void 0:U[0])==null?void 0:L.url)||d.product.key_default_image||"/images/placeholder-product.png";l.push({uniqueId:`${d.product_id}-${d.variant_id||"novar"}-${y}-${Date.now()}`,product_id:d.product_id,variant_id:d.variant_id||null,name:$.value==="ar"?d.product.name_ar:d.product.name_en,img:p,price:Number(C),total_discounts_value:d.product.total_discounts_value||0,quantity:d.quantity,store_id:c.store_id,unique_store_id:y})})}),q.value=Array.from(e.values()),k.value=l,q.value.length>0&&(_.value=q.value.map(c=>c.unique_store_id)),await F()}catch{u.add({severity:"error",summary:t("error"),detail:t("cart.cartLoadError"),life:4e3})}finally{T.value=!1}},x=j(()=>_.value.length===0?[]:k.value.filter(r=>_.value.includes(r.unique_store_id))),Z=j(()=>S.value.length>0),N=r=>{const l=parseFloat(r.min_amount_order||0);return parseFloat(r.subtotal||0)<l},m=j(()=>h.value.length===0?{subtotal:0,tax:0,total:0,coupon:0,total_discounts_fees:0,unavailable:!1,belowMinAmountStores:[]}:h.value.reduce((l,e)=>({subtotal:l.subtotal+Number(e.subtotal||0),tax:l.tax+Number(e.tax||0),total:l.total+Number(e.total||0),coupon:l.coupon+Number(e.coupon||0),total_discounts_fees:l.total_discounts_fees+Number(e.total_discounts_fees||0),unavailable:l.unavailable||e.delivery_status==="not_available",belowMinAmountStores:N(e)?[...l.belowMinAmountStores,e]:l.belowMinAmountStores}),{subtotal:0,tax:0,total:0,coupon:0,total_discounts_fees:0,unavailable:!1,belowMinAmountStores:[]})),I=j(()=>v.value&&x.value.length>0&&!m.value.unavailable&&m.value.belowMinAmountStores.length===0),F=async()=>{if(!v.value||x.value.length===0){h.value=[];return}try{const r={address_id:v.value,view:!0,items:x.value.map(e=>({product_id:e.product_id,variant_id:e.variant_id,quantity:e.quantity}))};b.value.trim()&&(r.coupon=b.value.trim());const{data:l}=await A.post("/api/order/view",r);l.is_success&&(h.value=l.data.map(e=>({...e,subtotal:parseFloat(e.subtotal),tax:parseFloat(e.tax),total:parseFloat(e.total),coupon:parseFloat(e.coupon||0),total_service_fees:parseFloat(e.total_service_fees||0),total_discounts_fees:parseFloat(e.total_discounts_fees||0),delivery_fee:parseFloat(e.delivery_fee||0),min_amount_order:e.min_amount_order||"0.00",unique_store_id:P({store_id:e.store_id,market_id:e.market_id})})))}catch(r){console.error("Failed to fetch order totals:",r),h.value=[]}},B=r=>{const l=q.value.find(e=>e.unique_store_id===r);return l?`${l.display_name}${l.market_name?` (${l.market_name})`:""}`:t("cart.unknownStore")},E=()=>{K.push({name:"add-addres"})},Q=r=>{switch(r){case"available":return t("cart.statusAvailable");case"free":return t("cart.statusFree");case"not_available":return t("cart.statusNotAvailable");default:return r}},G=r=>{switch(r){case"available":case"free":return"bg-green-100 text-green-800 border-green-300";case"not_available":return"bg-red-100 text-red-800 border-red-300";default:return"bg-yellow-100 text-yellow-800 border-yellow-300"}},ee=r=>{_.value=_.value.includes(r)?_.value.filter(l=>l!==r):[..._.value,r]},te=()=>{_.value=q.value.map(r=>r.unique_store_id)},se=r=>((r.price-r.total_discounts_value)*r.quantity).toFixed(2),V=async(r,l)=>{if(!(l<1))try{await A.post("/api/cart/update",{product_id:r.product_id,variant_id:r.variant_id,quantity:l}),r.quantity=l,await F(),u.add({severity:"success",summary:t("success"),detail:l>r.quantity?t("cart.quantityIncreased"):t("cart.quantityDecreased"),life:2e3})}catch{u.add({severity:"error",summary:t("error"),detail:t("cart.quantityUpdateError"),life:4e3})}},ae=async r=>{try{await A.post("/api/cart/remove",{product_id:r.product_id,variant_id:r.variant_id}),k.value=k.value.filter(l=>l.uniqueId!==r.uniqueId),await F(),u.add({severity:"success",summary:t("success"),detail:t("cart.removeSuccess"),life:3e3})}catch{u.add({severity:"error",summary:t("error"),detail:t("cart.removeError"),life:4e3})}},oe=async()=>{await F(),u.add({severity:"success",summary:t("success"),detail:t("cart.couponApplied"),life:3e3})},re=async r=>{var c,y;const l=h.value.find(d=>d.unique_store_id===r);if(!v.value){u.add({severity:"warn",summary:t("warning"),detail:t("cart.selectAddressFirst"),life:4e3});return}if(l.delivery_status==="not_available"){u.add({severity:"error",summary:t("error"),detail:t("cart.cannotCheckoutDueToDelivery"),life:5e3});return}if(N(l)){u.add({severity:"warn",summary:t("warning"),detail:t("cart.minAmountNotMet",{min:l.min_amount_order}),life:5e3});return}const e=x.value.filter(d=>d.unique_store_id===r);if(e.length===0){u.add({severity:"info",summary:t("info"),detail:t("cart.noItemsInStore"),life:3e3});return}try{const d={address_id:v.value,items:e.map(p=>({product_id:p.product_id,variant_id:p.variant_id,quantity:p.quantity}))};b.value.trim()&&(d.coupon=b.value.trim()),w.value.trim()&&(d.notes=w.value.trim());const{data:C}=await A.post("/api/order",d);C.is_success&&(u.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccessStore",{store:B(r)}),life:5e3}),k.value=k.value.filter(p=>p.unique_store_id!==r),_.value=_.value.filter(p=>p!==r),await F())}catch(d){const C=((y=(c=d.response)==null?void 0:c.data)==null?void 0:y.message)||t("cart.orderError");u.add({severity:"error",summary:t("error"),detail:C,life:5e3})}},le=async()=>{var r,l;if(!I.value){if(!v.value){u.add({severity:"error",summary:t("error"),detail:t("cart.selectAddressWarning"),life:5e3}),E();return}m.value.belowMinAmountStores.length>0?u.add({severity:"warn",summary:t("warning"),detail:t("cart.cannotCheckoutDueToMinAmount"),life:5e3}):m.value.unavailable&&u.add({severity:"error",summary:t("error"),detail:t("cart.cannotCheckoutDueToDelivery"),life:5e3});return}try{const e={address_id:v.value,items:x.value.map(y=>({product_id:y.product_id,variant_id:y.variant_id,quantity:y.quantity}))};b.value.trim()&&(e.coupon=b.value.trim()),w.value.trim()&&(e.notes=w.value.trim());const{data:c}=await A.post("/api/order",e);c.is_success&&(u.add({severity:"success",summary:t("success"),detail:t("cart.orderSuccess"),life:5e3}),k.value=[],h.value=[],_.value=[],w.value="",b.value="")}catch(e){const c=((l=(r=e.response)==null?void 0:r.data)==null?void 0:l.message)||t("cart.orderError");u.add({severity:"error",summary:t("error"),detail:c,life:5e3})}};return ue(()=>[v.value,_.value,b.value],F,{deep:!0}),_e(()=>{X(),Y()}),(r,l)=>(n(),i("div",be,[s("div",fe,[s("section",pe,[T.value?(n(),i("div",ge,[W(o(ve),{style:{width:"50px",height:"50px"},strokeWidth:"4",class:"text-yellow-600"}),s("p",he,a(o(t)("loading")),1)])):(n(),i("div",xe,[s("div",we,[s("h3",ke,a(o(t)("cart.selectStore")),1),s("div",qe,[(n(!0),i(D,null,M(q.value,e=>(n(),i("button",{key:e.unique_store_id,onClick:c=>ee(e.unique_store_id),class:J(["px-5 py-3 rounded-lg text-sm font-medium transition-all",_.value.includes(e.unique_store_id)?"bg-yellow-600 text-white shadow-md":"bg-amber-50 text-yellow-700 hover:bg-amber-100"])},[R(a(e.display_name)+" ",1),e.market_name?(n(),i("span",Se," ("+a(e.market_name)+") ",1)):f("",!0)],10,Ae))),128)),q.value.length>1?(n(),i("button",{key:0,onClick:te,class:"px-5 py-3 rounded-lg text-sm font-medium bg-amber-50 text-yellow-700 hover:bg-amber-100 transition-all"},a(o(t)("cart.selectAllStores")),1)):f("",!0)])]),s("div",Fe,[s("h3",Ce,a(o(t)("cart.selectAddress")),1),Z.value?(n(),i("div",De,[z(s("select",{"onUpdate:modelValue":l[0]||(l[0]=e=>v.value=e),class:"flex-1 bg-amber-50 border border-amber-300 rounded-lg px-4 py-1 text-gray-800 focus:outline-none focus:ring-2 focus:ring-yellow-600"},[s("option",Me,a(o(t)("cart.selectAddressPlaceholder")),1),(n(!0),i(D,null,M(S.value,e=>(n(),i("option",{key:e.id,value:e.id},a(e.address_line_1)+", "+a(e.city),9,Ne))),128))],512),[[me,v.value]]),s("button",{onClick:E,class:"px-5 py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300 transition duration-200 text-sm flex-shrink-0"},a(o(t)("cart.addAddressButton")),1)])):(n(),i("div",je,[s("p",$e,[l[3]||(l[3]=s("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 inline-block -mt-0.5",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z","clip-rule":"evenodd"})],-1)),R(" "+a(o(t)("cart.selectAddressWarning")),1)]),s("button",{onClick:E,class:"w-full py-2 bg-yellow-600 text-white font-semibold rounded-lg hover:bg-yellow-700 transition duration-200"},a(o(t)("cart.addAddressButton")),1)]))]),x.value.length===0?(n(),i("div",Te,a(_.value.length===0?o(t)("cart.selectStorePrompt"):o(t)("cart.emptyCart")),1)):(n(),i("div",Ie,[(n(!0),i(D,null,M(x.value,e=>(n(),i("div",{key:e.uniqueId,class:"flex flex-col sm:flex-row items-start sm:items-center gap-4 p-5 bg-gray-50 rounded-xl mb-4 shadow-sm hover:shadow-md transition-shadow"},[s("img",{src:e.img||"/images/placeholder-product.png",alt:e.name,class:"w-24 h-24 object-contain rounded-lg border border-gray-200",loading:"lazy"},null,8,Be),s("div",Ee,[s("h4",ze,a(e.name),1),s("span",Pe,a(o(t)("cart.price"))+": "+a((e.price-e.total_discounts_value).toFixed(2))+" "+a(o(t)("cart.currency")),1),e.total_discounts_value>0?(n(),i("span",Ve,a(Number(e.price).toFixed(2))+" "+a(o(t)("cart.currency")),1)):f("",!0),s("div",Oe,[s("div",Ue,[s("button",{onClick:c=>V(e,e.quantity-1),disabled:e.quantity<=1,class:"w-12 h-10 text-gray-600 hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition"}," − ",8,Le),s("span",We,a(e.quantity),1),s("button",{onClick:c=>V(e,e.quantity+1),class:"w-12 h-10 text-gray-600 hover:bg-gray-100 transition"}," + ",8,Re)]),s("div",He,a(o(t)("cart.total")||"Total")+": "+a(se(e))+" "+a(o(t)("cart.currency")),1),s("button",{onClick:c=>ae(e),class:"text-red-600 hover:text-red-800 text-sm font-medium transition"},a(o(t)("cart.remove")),9,Je)])])]))),128)),(n(!0),i(D,null,M(h.value,e=>(n(),i("div",{key:e.unique_store_id,class:"bg-gradient-to-r from-amber-50 to-yellow-50 p-6 mt-8 rounded-xl border border-amber-200"},[s("h3",Ke,a(o(t)("cart.orderFrom"))+" "+a(B(e.unique_store_id)),1),e.delivery_message?(n(),i("div",{key:0,class:J(["mb-4 p-4 rounded-lg text-sm",G(e.delivery_status)])},[s("p",Xe,a(o(t)("cart.deliveryStatus"))+": "+a(Q(e.delivery_status)),1)],2)):f("",!0),N(e)?(n(),i("div",Ye,[s("span",Ze," ⚠️ "+a(o(t)("cart.minAmountWarning",{min:e.min_amount_order,currency:o(t)("cart.currency")})),1),s("span",Qe,a(e.min_amount_order)+" "+a(r.$t("currencyLabel")),1)])):f("",!0),s("div",Ge,[s("div",et,[s("span",tt,a(o(t)("cart.shippingTime")),1),s("span",st,a(e.delivery_time||o(t)("cart.notAvailable")),1)]),s("div",at,[s("span",ot,a(o(t)("cart.deliveryFee")),1),s("span",null,a(Number(e.delivery_fee||0).toFixed(2))+" "+a(o(t)("cart.currency")),1)]),s("div",rt,[s("span",lt,a(o(t)("cart.subtotal")),1),s("span",null,a(Number(e.subtotal).toFixed(2))+" "+a(o(t)("cart.currency")),1)]),s("div",nt,[s("span",it,a(o(t)("cart.tax")),1),s("span",null,a(Number(e.tax).toFixed(2))+" "+a(o(t)("cart.currency")),1)]),e.coupon>0?(n(),i("div",ct,[s("span",dt,a(o(t)("cart.couponDiscount")),1),s("span",ut,"- "+a(Number(e.coupon).toFixed(2))+" "+a(o(t)("cart.currency")),1)])):f("",!0),s("div",_t,[s("span",mt,a(o(t)("cart.serviceFees")),1),s("span",null,a(Number(e.total_service_fees).toFixed(2))+" "+a(o(t)("cart.currency")),1)]),s("div",vt,[s("span",yt,a(o(t)("cart.discountsFees")||"Discount Fees"),1),s("span",bt,a(Number(e.total_discounts_fees).toFixed(2))+" "+a(o(t)("cart.currency")),1)]),s("div",ft,[s("span",null,a(o(t)("cart.total")),1),s("span",null,a(Number(e.total).toFixed(2))+" "+a(o(t)("cart.currency")),1)])]),s("button",{onClick:c=>re(e.unique_store_id),disabled:!v.value||e.delivery_status==="not_available"||N(e),class:"w-full mt-6 py-3 bg-yellow-600 text-white font-bold rounded-lg hover:bg-yellow-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition duration-200 shadow-md"},a(o(t)("cart.checkoutThisStoreOnly")),9,pt)]))),128))]))]))]),s("aside",gt,[s("h3",ht,a(o(t)("cart.orderSummary")),1),s("div",xt,[s("div",wt,[s("span",kt,a(o(t)("cart.subtotal")),1),s("span",null,a(m.value.subtotal.toFixed(2))+" "+a(o(t)("cart.currency")),1)]),s("div",qt,[s("span",At,a(o(t)("cart.tax")),1),s("span",null,a(m.value.tax.toFixed(2))+" "+a(o(t)("cart.currency")),1)]),m.value.coupon>0?(n(),i("div",St,[s("span",Ft,a(o(t)("cart.couponDiscount")),1),s("span",Ct,"- "+a(m.value.coupon.toFixed(2))+" "+a(o(t)("cart.currency")),1)])):f("",!0),m.value.total_discounts_fees>0?(n(),i("div",Dt,[s("span",Mt,a(o(t)("cart.discountsFees")||"Discount Fees"),1),s("span",Nt,a(m.value.total_discounts_fees.toFixed(2))+" "+a(o(t)("cart.currency")),1)])):f("",!0),s("div",jt,[s("span",null,a(o(t)("cart.total")),1),s("span",$t,a(m.value.total.toFixed(2))+" "+a(o(t)("cart.currency")),1)])]),m.value.belowMinAmountStores.length>0?(n(),i("div",Tt,[s("p",It,"⚠️ "+a(o(t)("cart.someStoresBelowMin")),1),s("ul",Bt,[(n(!0),i(D,null,M(m.value.belowMinAmountStores,e=>(n(),i("li",{key:e.unique_store_id},a(B(e.unique_store_id))+": "+a(o(t)("cart.minRequired"))+" "+a(e.min_amount_order)+" "+a(o(t)("cart.currency")),1))),128))])])):f("",!0),s("div",Et,[z(s("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>b.value=e),type:"text",placeholder:o(t)("cart.couponPlaceholder"),class:"w-full px-4 py-3 border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-600 transition"},null,8,zt),[[H,b.value]]),s("button",{onClick:oe,disabled:!b.value.trim(),class:"w-full mt-3 py-3 bg-amber-100 text-yellow-700 font-semibold rounded-lg hover:bg-amber-200 disabled:opacity-60 disabled:cursor-not-allowed transition"},a(o(t)("cart.applyCoupon")),9,Pt)]),s("div",Vt,[s("label",Ot,a(o(t)("cart.notes")||"Special Instructions"),1),z(s("textarea",{"onUpdate:modelValue":l[2]||(l[2]=e=>w.value=e),placeholder:o(t)("cart.notesPlaceholder")||"Add any special instructions for your order...",class:"w-full px-4 py-3 border border-amber-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-600 transition resize-none",rows:"4"},null,8,Ut),[[H,w.value]])]),s("button",{onClick:le,disabled:!I.value,class:"w-full mt-8 py-4 bg-gray-900 text-white font-bold text-lg rounded-lg hover:bg-gray-800 disabled:bg-gray-400 disabled:cursor-not-allowed transition duration-200"},a(o(t)("cart.checkoutAll")),9,Lt),!I.value&&v.value&&x.value.length>0?(n(),i("p",Wt,a(m.value.unavailable?o(t)("cart.cannotCheckoutDueToDelivery"):o(t)("cart.cannotCheckoutDueToMinAmount")),1)):f("",!0)])]),W(o(ye))]))}},Kt=ne(Rt,[["__scopeId","data-v-10558aa3"]]);export{Kt as default};
