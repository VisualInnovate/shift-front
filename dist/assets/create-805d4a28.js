import{_ as z,c,l as A,a as G,u as W,r as p,x as T,o as H,a1 as J,B as q,e as _,h as m,g as o,t as d,j as s,D as K,v as h,i as u,A as D,n as g,G as Q,b as I,V as M,aj as X,al as Z,W as S,k as ee}from"./index-a7b03100.js";import{h as te}from"./moment-fbc5633a.js";const ae=["dir"],se={class:"text-3xl font-bold text-center mb-8 text-gray-800"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},oe={class:"space-y-2"},ie={for:"product_id",class:"block text-sm font-medium text-gray-700"},re={key:0,class:"p-error"},ne={key:0,class:"space-y-2"},de={for:"variant_id",class:"block text-sm font-medium text-gray-700"},ue={class:"text-xs text-gray-500"},ce={class:"space-y-2"},pe={for:"discount_value",class:"block text-sm font-medium text-gray-700"},ve={key:0,class:"p-error"},_e={class:"space-y-2"},me={for:"expires_at",class:"block text-sm font-medium text-gray-700"},fe={key:0,class:"p-error"},ye={class:"pt-6 flex justify-center gap-6"},xe={__name:"create",setup(he){const b=c(()=>localStorage.getItem("appLang")||"en"),U=c(()=>b.value==="en"?"name_en":"name_ar"),B=c(()=>b.value==="ar"),F=A(),f=G(),{t}=W(),y=p(!1),n=p({}),a=p({product_id:null,variant_id:null,discount_type:1,discount_value:null,expires_at:null}),V=p([]),w=p(""),k=p(!1),v=c(()=>V.value.find(i=>i.id===a.value.product_id)),L=c(()=>!v.value||!v.value.has_variants?[]:v.value.variants||[]),R=c(()=>v.value&&v.value.has_variants&&L.value.length>0);T(()=>a.value.product_id,()=>{a.value.variant_id=null});const Y=(i,e)=>{let r;return(...l)=>{clearTimeout(r),r=setTimeout(()=>i(...l),e)}},$=async()=>{k.value=!0;try{const{data:i}=await I.get("/api/discount/create/data",{params:{...w.value?{search:w.value}:{}}});V.value=i.data.data??[]}catch(i){console.error(i),f.add({severity:"error",summary:t("error"),detail:t("error.productLoad"),life:3e3})}finally{k.value=!1}},C=Y($,300),E=i=>{w.value=i.value??"",C()};H(()=>{$()}),T(b,()=>{});class N{constructor(e,r){this.errors=e,this.t=r}required(e,r){return e==null?(this.errors.value[r]=this.t("validation.requiredFields",{field:this.t(`discount.${r}`)}),!1):!0}numericRange(e,r,l){return e==null||isNaN(e)?(this.errors.value[r]=this.t("validation.requiredFields",{field:this.t(`discount.${r}`)}),!1):l!==void 0&&e<l?(this.errors.value[r]=this.t("validation.minValue",{field:this.t(`discount.${r}`),min:l}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const O=async()=>{var P,j;n.value={};const i=new N(n,t);if(i.required(a.value.product_id,"select_product"),i.numericRange(a.value.discount_value,"discount_value",0),i.required(a.value.expires_at,"expiration_date"),!i.isValid()){const x=Object.values(n.value).join(", ");f.add({severity:"error",summary:t("error"),detail:x,life:3e3});return}y.value=!0;const e=a.value.variant_id!==null,r=e?a.value.variant_id:a.value.product_id,l={type:e?"variant":"product",ids:[r],discount_type:a.value.discount_type,discount_value:a.value.discount_value,expires_at:te(a.value.expires_at).format("YYYY-MM-DD")};try{await I.post("/api/discount",l),f.add({severity:"success",summary:t("success"),detail:t("discount.created_successfully"),life:3e3}),F.push({name:"discount"})}catch(x){console.error(x),f.add({severity:"error",summary:t("error"),detail:((j=(P=x.response)==null?void 0:P.data)==null?void 0:j.message)||t("error.createError"),life:3e3})}finally{y.value=!1}};return(i,e)=>{const r=J("can");return q((_(),m("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:B.value?"rtl":"ltr"},[o("h1",se,d(s(t)("discount.create_new_discount")),1),o("form",{onSubmit:Q(O,["prevent"]),class:"space-y-6"},[q(o("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=l=>a.value.discount_type=l)},null,512),[[K,a.value.discount_type]]),o("div",le,[o("div",oe,[o("label",ie,[h(d(s(t)("discount.select_product"))+" ",1),e[6]||(e[6]=o("span",{class:"text-red-500"},"*",-1))]),u(s(M),{id:"product_id",modelValue:a.value.product_id,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.product_id=l),options:V.value,optionLabel:U.value,optionValue:"id",filter:"",filterPlaceholder:s(t)("discount.searchProducts"),placeholder:s(t)("discount.searchProducts"),loading:k.value,class:D(["w-full",{"p-invalid":n.value.select_product}]),onFilter:E},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),n.value.select_product?(_(),m("small",re,d(n.value.select_product),1)):g("",!0)]),R.value?(_(),m("div",ne,[o("label",de,[h(d(s(t)("discount.select_variant"))+" ",1),e[7]||(e[7]=o("span",{class:"text-gray-400"},"(اختياري)",-1))]),u(s(M),{id:"variant_id",modelValue:a.value.variant_id,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.variant_id=l),options:L.value,optionLabel:"sku",optionValue:"id",placeholder:s(t)("discount.apply_to_all_variants"),class:"w-full",clearable:""},null,8,["modelValue","options","placeholder"]),o("small",ue,d(s(t)("discount.variant_hint")),1)])):g("",!0),o("div",ce,[o("label",pe,[h(d(s(t)("discount.discount_value"))+" ("+d(s(t)("discount.fixed_amount"))+") ",1),e[8]||(e[8]=o("span",{class:"text-red-500"},"*",-1))]),u(s(X),{id:"discount_value",modelValue:a.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.discount_value=l),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:0,placeholder:s(t)("discount.enter_discount_value"),class:D(["w-full",{"p-invalid":n.value.discount_value}])},null,8,["modelValue","placeholder","class"]),n.value.discount_value?(_(),m("small",ve,d(n.value.discount_value),1)):g("",!0)]),o("div",_e,[o("label",me,[h(d(s(t)("discount.expiration_date"))+" ",1),e[9]||(e[9]=o("span",{class:"text-red-500"},"*",-1))]),u(s(Z),{id:"expires_at",modelValue:a.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:s(t)("discount.select_expiration_date"),class:D(["w-full",{"p-invalid":n.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),n.value.expiration_date?(_(),m("small",fe,d(n.value.expiration_date),1)):g("",!0)])]),o("div",ye,[u(s(S),{type:"button",label:s(t)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=l=>s(F).go(-1)),severity:"secondary",disabled:y.value},null,8,["label","disabled"]),u(s(S),{type:"submit",label:s(t)("discount.create_discount"),icon:"pi pi-plus",loading:y.value,class:"px-8"},null,8,["label","loading"])])],32),u(s(ee))],8,ae)),[[r,"create discounts"]])}}},Ve=z(xe,[["__scopeId","data-v-cdc6c41e"]]);export{Ve as default};
