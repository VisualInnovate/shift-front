import{_ as O,d as v,b as G,c as W,u as A,r as p,z as T,o as H,a1 as J,B as j,e as _,f as m,g as r,t as u,i as s,D as K,k as g,h as c,n as b,l as f,G as Q,p as I,V as M,aj as X,al as Z,W as S,x as ee}from"./index-6aa0199c.js";import{h as te}from"./moment-fbc5633a.js";const ae=["dir"],se={class:"text-3xl font-bold text-center mb-8 text-gray-800"},le={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},oe={class:"space-y-2"},ie={for:"product_id",class:"block text-sm font-medium text-gray-700"},re={key:0,class:"p-error"},ne={key:0,class:"space-y-2"},ue={for:"variant_id",class:"block text-sm font-medium text-gray-700"},de={key:0,class:"p-error"},ce={class:"space-y-2"},ve={for:"discount_value",class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"p-error"},_e={class:"space-y-2"},me={for:"expires_at",class:"block text-sm font-medium text-gray-700"},fe={key:0,class:"p-error"},ye={class:"pt-6 flex justify-center gap-6"},xe={__name:"create",setup(he){const V=v(()=>localStorage.getItem("appLang")||"en"),U=v(()=>V.value==="en"?"name_en":"name_ar"),B=v(()=>V.value==="ar"),F=G(),y=W(),{t:a}=A(),x=p(!1),n=p({}),t=p({product_id:null,variant_id:null,discount_type:1,discount_value:null,expires_at:null}),w=p([]),k=p(""),D=p(!1),d=v(()=>w.value.find(o=>o.id===t.value.product_id)),L=v(()=>!d.value||!d.value.has_variants?[]:d.value.variants||[]),R=v(()=>d.value&&d.value.has_variants&&L.value.length>0);T(()=>t.value.product_id,()=>{t.value.variant_id=null});const Y=(o,e)=>{let i;return(...l)=>{clearTimeout(i),i=setTimeout(()=>o(...l),e)}},$=async()=>{D.value=!0;try{const{data:o}=await I.get("/api/discount/create/data",{params:{...k.value?{search:k.value}:{}}});w.value=o.data.data??[]}catch(o){console.error(o),y.add({severity:"error",summary:a("error"),detail:a("error.productLoad"),life:3e3})}finally{D.value=!1}},C=Y($,300),z=o=>{k.value=o.value??"",C()};H(()=>{$()}),T(V,()=>{});class E{constructor(e,i){this.errors=e,this.t=i}required(e,i){return e==null?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):!0}numericRange(e,i,l){return e==null||isNaN(e)?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):l!==void 0&&e<l?(this.errors.value[i]=this.t("validation.minValue",{field:this.t(`discount.${i}`),min:l}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const N=async()=>{var P,q;n.value={};const o=new E(n,a);if(o.required(t.value.product_id,"select_product"),d.value&&d.value.has_variants&&o.required(t.value.variant_id,"select_variant"),o.numericRange(t.value.discount_value,"discount_value",0),o.required(t.value.expires_at,"expiration_date"),!o.isValid()){const h=Object.values(n.value).join(", ");y.add({severity:"error",summary:a("error"),detail:h,life:3e3});return}x.value=!0;const e=t.value.variant_id!==null,i=e?t.value.variant_id:t.value.product_id,l={type:e?"variant":"product",ids:[i],discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:te(t.value.expires_at).format("YYYY-MM-DD")};try{await I.post("/api/discount",l),y.add({severity:"success",summary:a("success"),detail:a("discount.created_successfully"),life:3e3}),F.push({name:"discount"})}catch(h){console.error(h),y.add({severity:"error",summary:a("error"),detail:((q=(P=h.response)==null?void 0:P.data)==null?void 0:q.message)||a("error.createError"),life:3e3})}finally{x.value=!1}};return(o,e)=>{const i=J("can");return j((_(),m("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:B.value?"rtl":"ltr"},[r("h1",se,u(s(a)("discount.create_new_discount")),1),r("form",{onSubmit:Q(N,["prevent"]),class:"space-y-6"},[j(r("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=l=>t.value.discount_type=l)},null,512),[[K,t.value.discount_type]]),r("div",le,[r("div",oe,[r("label",ie,[g(u(s(a)("discount.select_product"))+" ",1),e[6]||(e[6]=r("span",{class:"text-red-500"},"*",-1))]),c(s(M),{id:"product_id",modelValue:t.value.product_id,"onUpdate:modelValue":e[1]||(e[1]=l=>t.value.product_id=l),options:w.value,optionLabel:U.value,optionValue:"id",filter:"",filterPlaceholder:s(a)("discount.searchProducts"),placeholder:s(a)("discount.searchProducts"),loading:D.value,class:b(["w-full",{"p-invalid":n.value.select_product}]),onFilter:z},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),n.value.select_product?(_(),m("small",re,u(n.value.select_product),1)):f("",!0)]),R.value?(_(),m("div",ne,[r("label",ue,[g(u(s(a)("discount.select_variant"))+" ",1),e[7]||(e[7]=r("span",{class:"text-red-500"},"*",-1))]),c(s(M),{id:"variant_id",modelValue:t.value.variant_id,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.variant_id=l),options:L.value,optionLabel:"sku",optionValue:"id",placeholder:s(a)("discount.select_variant"),class:b(["w-full",{"p-invalid":n.value.select_variant}])},null,8,["modelValue","options","placeholder","class"]),n.value.select_variant?(_(),m("small",de,u(n.value.select_variant),1)):f("",!0)])):f("",!0),r("div",ce,[r("label",ve,[g(u(s(a)("discount.discount_value"))+" ("+u(s(a)("discount.fixed_amount"))+") ",1),e[8]||(e[8]=r("span",{class:"text-red-500"},"*",-1))]),c(s(X),{id:"discount_value",modelValue:t.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.discount_value=l),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:0,placeholder:s(a)("discount.enter_discount_value"),class:b(["w-full",{"p-invalid":n.value.discount_value}])},null,8,["modelValue","placeholder","class"]),n.value.discount_value?(_(),m("small",pe,u(n.value.discount_value),1)):f("",!0)]),r("div",_e,[r("label",me,[g(u(s(a)("discount.expiration_date"))+" ",1),e[9]||(e[9]=r("span",{class:"text-red-500"},"*",-1))]),c(s(Z),{id:"expires_at",modelValue:t.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:s(a)("discount.select_expiration_date"),class:b(["w-full",{"p-invalid":n.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),n.value.expiration_date?(_(),m("small",fe,u(n.value.expiration_date),1)):f("",!0)])]),r("div",ye,[c(s(S),{type:"button",label:s(a)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=l=>s(F).go(-1)),severity:"secondary",disabled:x.value},null,8,["label","disabled"]),c(s(S),{type:"submit",label:s(a)("discount.create_discount"),icon:"pi pi-plus",loading:x.value,class:"px-8"},null,8,["label","loading"])])],32),c(s(ee))],8,ae)),[[i,"create discounts"]])}}},Ve=O(xe,[["__scopeId","data-v-96519e91"]]);export{Ve as default};
