import{_ as S,l as g,u as Y,G as A,j as B,r as c,o as E,q as N,n as O,a0 as z,y as b,a as m,c as y,f as r,t as d,e as o,A as L,p as V,h as p,x as w,g as k,C as G,i as $,U as Q,ai as H,V as q,Q as J}from"./index-9c7fed1c.js";import{h as K}from"./moment-fbc5633a.js";const W=["dir"],X={class:"text-3xl font-bold text-center mb-8 text-gray-800"},Z={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ee={class:"space-y-2"},te={for:"product_id",class:"block text-sm font-medium text-gray-700"},se={key:0,class:"p-error"},ae={class:"space-y-2"},oe={for:"discount_value",class:"block text-sm font-medium text-gray-700"},le={key:0,class:"p-error"},re={class:"space-y-2"},ue={for:"expires_at",class:"block text-sm font-medium text-gray-700"},ie={key:0,class:"p-error"},ne={class:"pt-4 flex justify-center space-x-4"},de={__name:"create",setup(ce){const f=g(()=>localStorage.getItem("appLang")||"en"),I=g(()=>f.value==="en"?"name_en":"name_ar"),P=g(()=>f.value==="ar"),D=Y(),v=A(),{t}=B(),_=c(!1),i=c({}),s=c({type:"product",products:null,discount_type:1,discount_value:null,expires_at:null}),F=c([]),x=c(""),h=c(!1),U=(u,e)=>{let a;return(...n)=>{clearTimeout(a),a=setTimeout(()=>u(...n),e)}},T=async()=>{h.value=!0;try{const{data:u}=await $.get("/api/product",{params:{...x.value?{search:x.value}:{}}});F.value=u.data.data??[]}catch(u){console.error(u),v.add({severity:"error",summary:t("error"),detail:t("error.productLoad"),life:3e3})}finally{h.value=!1}},j=U(T,300),C=u=>{x.value=u.value??"",j()};E(()=>{T()}),N(f,()=>{});class M{constructor(e,a){this.errors=e,this.t=a}required(e,a){return e==null||Array.isArray(e)&&e.length===0?(this.errors.value[a]=this.t("validation.requiredFields",{field:this.t(`discount.${a}`)}),!1):!0}numericRange(e,a,n,l){return e==null||isNaN(e)?(this.errors.value[a]=this.t("validation.requiredFields",{field:this.t(`discount.${a}`)}),!1):n!==null&&e<n?(this.errors.value[a]=this.t("validation.minValue",{field:this.t(`discount.${a}`),min:n}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const R=async()=>{var a,n;i.value={};const u=new M(i,t);if(u.required(s.value.products,"select_product"),u.numericRange(s.value.discount_value,"discount_value",0,null),u.required(s.value.expires_at,"expiration_date"),!u.isValid()){const l=Object.values(i.value).join(", ");v.add({severity:"error",summary:t("error"),detail:l,life:3e3});return}_.value=!0;const e={type:s.value.type,ids:[s.value.products],discount_type:s.value.discount_type,discount_value:s.value.discount_value,expires_at:K(s.value.expires_at).format("YYYY-MM-DD")};try{await $.post("/api/discount",e),v.add({severity:"success",summary:t("success"),detail:t("discount.created_successfully"),life:3e3}),D.push({name:"discount"})}catch(l){console.error(l),v.add({severity:"error",summary:t("error"),detail:((n=(a=l.response)==null?void 0:a.data)==null?void 0:n.message)||t("error.createError"),life:3e3})}finally{_.value=!1}};return(u,e)=>{const a=O("InputText"),n=z("can");return b((m(),y("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:P.value?"rtl":"ltr"},[r("h1",X,d(o(t)("discount.create_new_discount")),1),r("form",{onSubmit:G(R,["prevent"]),class:"space-y-6"},[b(r("input",{type:"hidden","onUpdate:modelValue":e[0]||(e[0]=l=>s.value.type=l)},null,512),[[L,s.value.type]]),b(r("input",{type:"hidden","onUpdate:modelValue":e[1]||(e[1]=l=>s.value.discount_type=l)},null,512),[[L,s.value.discount_type]]),r("div",Z,[r("div",ee,[r("label",te,[V(d(o(t)("discount.select_product"))+" ",1),e[6]||(e[6]=r("span",{class:"text-red-500"},"*",-1))]),p(o(Q),{id:"product_id",modelValue:s.value.products,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.products=l),options:F.value,optionLabel:I.value,optionValue:"id",filter:"",filterPlaceholder:o(t)("discount.searchProducts"),placeholder:o(t)("discount.searchProducts"),loading:h.value,class:w(["w-full",{"p-invalid":i.value.select_product}]),onFilter:C},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),i.value.select_product?(m(),y("small",se,d(i.value.select_product),1)):k("",!0)]),r("div",ae,[r("label",oe,[V(d(o(t)("discount.discount_value"))+" ("+d(o(t)("discount.fixed_amount"))+") ",1),e[7]||(e[7]=r("span",{class:"text-red-500"},"*",-1))]),p(a,{type:"number",id:"discount_value",modelValue:s.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.discount_value=l),placeholder:o(t)("discount.enter_discount_value"),class:w(["w-full",{"p-invalid":i.value.discount_value}])},null,8,["modelValue","placeholder","class"]),i.value.discount_value?(m(),y("small",le,d(i.value.discount_value),1)):k("",!0)]),r("div",re,[r("label",ue,[V(d(o(t)("discount.expiration_date"))+" ",1),e[8]||(e[8]=r("span",{class:"text-red-500"},"*",-1))]),p(o(H),{id:"expires_at",modelValue:s.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.expires_at=l),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:o(t)("discount.select_expiration_date"),class:w(["w-full",{"p-invalid":i.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),i.value.expiration_date?(m(),y("small",ie,d(i.value.expiration_date),1)):k("",!0)])]),r("div",ne,[p(o(q),{type:"button",label:o(t)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=l=>o(D).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md",disabled:_.value},null,8,["label","disabled"]),p(o(q),{type:"submit",label:o(t)("discount.create_discount"),icon:"pi pi-plus",loading:_.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),p(o(J))],8,W)),[[n,"create discounts"]])}}},_e=S(de,[["__scopeId","data-v-915bc943"]]);export{_e as default};
