import{l as Ne,a as ze,u as Oe,r as d,x as fe,b,o as We,a1 as _e,e as h,h as C,g as s,i,w as c,j as e,t as u,F as ge,m as qe,U as Ae,W as p,ae as he,B as R,a3 as Qe,k as Ge,a4 as y,v as j,ad as Ke,af as ye,f as xe,s as ke,n as T,a5 as He,A as Je,V as A,T as I,ag as H}from"./index-7cbef6f0.js";const Xe={class:"grid"},Ye={class:"col-12"},Ze={class:"card p-4 shadow-2 border-round"},ea={class:"text-2xl font-bold"},aa={class:"p-input-icon-left mx-4"},ta={class:"flex flex-wrap gap-3 align-items-center"},la={class:"card shadow-1 surface-0"},oa={class:"flex justify-content-center align-items-center"},ia={class:"flex justify-content-center align-items-center"},sa={class:"text-center py-4"},ra={class:"text-xl"},da={class:"p-paginator p-component p-unselectable-text p-paginator-bottom"},na={class:"p-paginator-left-content"},ca={class:"p-paginator-current"},ua={class:"p-paginator-right-content"},pa=["disabled"],va=["disabled"],ma=["onClick","aria-label"],ba={key:1,class:"p-paginator-dots"},fa=["disabled"],_a=["disabled"],ga={class:"space-y-4"},ha={class:"block text-900 font-medium mb-2"},ya={class:"block text-900 font-medium mb-2"},xa={class:"block text-900 font-medium mb-2"},ka={class:"flex align-items-center justify-content-center"},wa={class:"flex flex-column gap-3"},Ca={key:0,class:"mt-2"},Sa={class:"font-semibold"},$a={class:"flex flex-column gap-3"},Fa={key:0,class:"mt-2"},Ua={class:"font-semibold"},Va={class:"flex flex-column gap-3"},La={__name:"index",setup(Ea){const J=Ne(),n=ze(),{t:a}=Oe(),M=d(!0),X=d([]),P=d(!1),Y=d(null),S=d(""),$=d(!1),F=d(!1),m=d(null),U=d(!1),Z=d([]),ee=d([]),ae=d([]),x=d(null),k=d(null),w=d(null),te=d(""),le=d(""),N=d(localStorage.getItem("appLang")||"en"),V=d(!1),E=d(null),Q=d(!1),L=d(!1),z=d({}),O=d({}),_=d(1),oe=d(0),D=d(10),W=d(0),ie=d(0),se=d(0),re=d([]),de=d(null),ne=d(null),ce=d([{label:a("importProducts"),icon:"pi pi-download",command:()=>{$.value=!0}},{label:a("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{F.value=!0}},{label:a("updatePrice"),icon:"pi pi-dollar",command:()=>{V.value=!0}}]),ue=d([{label:a("exportProducts"),icon:"pi pi-upload",command:()=>{ve()}},{label:a("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{me()}}]),G=async()=>{try{const o=await b.get("/api/category",{params:{search:te.value||void 0}}),l=N.value;Z.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:a("error"),detail:a("category.loadError"),life:3e3})}},pe=async()=>{try{const o=await b.get("/api/store"),l=N.value;ee.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:a("error"),detail:a("store.loadError"),life:3e3})}},K=async()=>{try{const o=await b.get("/api/market",{params:{search:le.value||void 0}}),l=N.value;ae.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:a("error"),detail:a("market.loadError"),life:3e3})}},g=()=>{M.value=!0,b.get("/api/product",{params:{page:_.value,limit:D.value,search:S.value||void 0,category_id:x.value||void 0,store_id:k.value||void 0,market_id:w.value||void 0}}).then(o=>{X.value=o.data.data.data,oe.value=o.data.data.total,W.value=o.data.data.last_page,ie.value=o.data.data.from,se.value=o.data.data.to,re.value=o.data.data.links,M.value=!1}).catch(o=>{n.add({severity:"error",summary:a("error"),detail:a("product.loadError"),life:3e3}),M.value=!1,console.error("Error fetching products:",o)})};fe([S,D,x,k,w],()=>{_.value=1,g()},{deep:!0}),fe(N,()=>{G(),pe(),K(),ce.value=[{label:a("importProducts"),icon:"pi pi-download",command:()=>{$.value=!0}},{label:a("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{F.value=!0}},{label:a("updatePrice"),icon:"pi pi-dollar",command:()=>{V.value=!0}}],ue.value=[{label:a("product.exportProducts"),icon:"pi pi-upload",command:()=>{ve()}},{label:a("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{me()}}]});const we=o=>{te.value=o.value,G()},Ce=o=>{le.value=o.filter,K()},Se=()=>{x.value=null,k.value=null,w.value=null,_.value=1,g()},B=o=>{o>=1&&o<=W.value&&(_.value=o,g())},$e=o=>{D.value=o.value,_.value=1,g()},Fe=o=>{Y.value=o,P.value=!0},Ue=()=>{b.delete(`/api/product/${Y.value}`).then(()=>{n.add({severity:"success",summary:a("success"),detail:a("product.deleteSuccess"),life:3e3}),g(),P.value=!1}).catch(()=>{n.add({severity:"error",summary:a("error"),detail:a("product.deleteError"),life:3e3})})},ve=()=>{const l=`/api/export/products?${new URLSearchParams({search:S.value||"",category_id:x.value||"",store_id:k.value||"",market_id:w.value||""}).toString()}`;b.get(l,{responseType:"blob"}).then(r=>{const v=new Blob([r.data],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(v),t.download="products_export.csv",t.click(),n.add({severity:"success",summary:a("success"),detail:a("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:a("error"),detail:a("product.exportError"),life:3e3})})},me=()=>{const l=`/api/export/variants?${new URLSearchParams({search:S.value||"",category_id:x.value||"",store_id:k.value||"",market_id:w.value||""}).toString()}`;b.get(l,{responseType:"blob"}).then(r=>{const v=new Blob([r.data],{type:"text/csv"}),t=document.createElement("a");t.href=URL.createObjectURL(v),t.download="products_variants_export.csv",t.click(),n.add({severity:"success",summary:a("success"),detail:a("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:a("error"),detail:a("product.exportError"),life:3e3})})},Ve=()=>{const o=`store_id,category_id,market_id,name_en,name_ar,sku,brand_id,sub_name_en,sub_name_ar,description_en,description_ar,base_price,cost_price,tax
1,1,1,Demo Product,منتج تجريبي,SKU001,1,Sub Demo,تجريبي فرعي,Description,وصف,15.50,10.00,0.05`,l=new Blob([o],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(l),r.download="product_import_example.csv",r.click()},Ee=()=>{const o=[{product_id:84,variant_id:9,price:2},{product_id:1650,variant_id:10,price:0},{product_id:22516,variant_id:11,price:.03},{product_id:22516,variant_id:12,price:.33},{product_id:37864,variant_id:19,price:10},{product_id:37864,variant_id:20,price:9},{product_id:37864,variant_id:21,price:10},{product_id:37864,variant_id:22,price:9},{product_id:55,variant_id:25,price:.77}],r=[["product_id","variant_id","price"].join(","),...o.map(q=>`${q.product_id},${q.variant_id},${q.price}`)].join(`
`),v=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(v),f=document.createElement("a");f.href=t,f.setAttribute("download","products_template.csv"),document.body.appendChild(f),f.click(),document.body.removeChild(f)},Pe=()=>{const o=`id,price,cost_price
1,16.00,10.50
2,23.50,15.00`,l=new Blob([o],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(l),r.download="product_price_update_example.csv",r.click()},be=o=>{m.value=o.files[0]},Le=o=>{E.value=o.files[0]},De=()=>{if(!m.value)return n.add({severity:"error",detail:a("validation.fileRequired"),life:3e3});U.value=!0;const o=new FormData;o.append("file",m.value),b.post("/api/import/products",o).then(()=>{n.add({severity:"success",detail:a("product.importSuccess"),life:3e3}),g(),$.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:a("product.importError"),life:3e3})).finally(()=>U.value=!1)},Be=()=>{if(!m.value)return n.add({severity:"error",detail:a("validation.fileRequired"),life:3e3});U.value=!0;const o=new FormData;o.append("file",m.value),b.post("/api/product/update/variants/prices",o).then(()=>{n.add({severity:"success",detail:a("product.importSuccess"),life:3e3}),g(),F.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:a("product.importError"),life:3e3})).finally(()=>U.value=!1)},Re=()=>{if(!E.value)return n.add({severity:"error",detail:a("validation.fileRequired"),life:3e3});Q.value=!0;const o=new FormData;o.append("file",E.value),b.post("/api/product/update/prices",o).then(()=>{n.add({severity:"success",detail:a("product.priceUpdateSuccess"),life:3e3}),g(),V.value=!1,E.value=null}).catch(()=>n.add({severity:"error",detail:a("product.priceUpdateError"),life:3e3})).finally(()=>Q.value=!1)},je=async o=>{const l=o.id,r=o.is_free_shipping,v=r===1?0:1;z.value[l]=!0;try{await b.post(`/api/product/is/free/shipping/${l}`,{is_free_shipping:v}),o.is_free_shipping=v,n.add({severity:"success",detail:a(v===1?"product.freeShippingEnabled":"product.freeShippingDisabled"),life:3e3})}catch{o.is_free_shipping=r,n.add({severity:"error",detail:a("product.freeShippingUpdateError"),life:3e3})}finally{z.value[l]=!1}},Te=async o=>{const l=o.id,r=o.is_best_seller?1:0,v=r===1?0:1;O.value[l]=!0;try{await b.get(`/api/product/update/best-sellers/${l}`),o.is_best_seller=v===1,n.add({severity:"success",detail:v===1?"Product marked as Best Seller":"Product removed from Best Sellers",life:3e3})}catch{o.is_best_seller=r===1,n.add({severity:"error",detail:"Failed to update Best Seller status",life:3e3})}finally{O.value[l]=!1}},Ie=()=>J.push({name:"product-create"}),Me=o=>J.push({name:"product-update",params:{id:o}});return We(()=>{Promise.all([G(),pe(),K(),g()])}),(o,l)=>{const r=_e("can"),v=_e("tooltip");return h(),C("div",Xe,[s("div",Ye,[s("div",Ze,[i(e(Qe),{class:"mb-4"},{start:c(()=>[s("h2",ea,u(e(a)("product.managementTitle")),1),s("span",aa,[l[23]||(l[23]=s("i",{class:"pi pi-search"},null,-1)),i(e(Ae),{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=t=>S.value=t),placeholder:e(a)("product.search")},null,8,["modelValue","placeholder"])])]),end:c(()=>[s("div",ta,[i(e(p),{label:e(a)("filters"),icon:"pi pi-filter",class:"p-button-outlined",onClick:l[1]||(l[1]=t=>L.value=!0)},null,8,["label"]),i(e(p),{label:e(a)("product.import"),icon:"pi pi-download",class:"p-button-outlined",onClick:l[2]||(l[2]=t=>de.value.toggle(t))},null,8,["label"]),i(e(he),{ref_key:"importMenu",ref:de,model:ce.value,popup:!0},null,8,["model"]),i(e(p),{label:e(a)("product.export"),icon:"pi pi-upload",class:"p-button-outlined",onClick:l[3]||(l[3]=t=>ne.value.toggle(t))},null,8,["label"]),i(e(he),{ref_key:"exportMenu",ref:ne,model:ue.value,popup:!0},null,8,["model"]),R(i(e(p),{label:e(a)("product.new"),icon:"pi pi-plus",class:"p-button-success",onClick:Ie},null,8,["label"]),[[r,"create products"]])])]),_:1}),i(e(Ge)),s("div",la,[i(e(He),{value:X.value,loading:M.value,"data-key":"id","responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:c(()=>[s("div",sa,[s("p",ra,u(e(a)("product.noData")),1)])]),default:c(()=>[i(e(y),{field:"id",header:e(a)("id"),sortable:!0,"header-style":"width:6%"},{body:c(t=>[j(u(t.data.id),1)]),_:1},8,["header"]),i(e(y),{field:"name_ar",header:e(a)("product.nameAr"),sortable:!0},{body:c(t=>[j(u(t.data.name_ar),1)]),_:1},8,["header"]),i(e(y),{field:"name_en",header:e(a)("product.nameEn"),sortable:!0},{body:c(t=>[j(u(t.data.name_en),1)]),_:1},8,["header"]),i(e(y),{field:"base_price",header:e(a)("product.basePrice")},{body:c(t=>[j(u(t.data.base_price),1)]),_:1},8,["header"]),i(e(y),{header:e(a)("product.Price after discount")},{body:c(t=>[j(u(t.data.base_price-t.data.total_discounts_value),1)]),_:1},8,["header"]),i(e(y),{field:"is_displayed",header:e(a)("product.isDisplayed")},{body:c(t=>[i(e(Ke),{value:t.data.is_displayed?e(a)("yes"):e(a)("no"),severity:t.data.is_displayed?"success":"info"},null,8,["value","severity"])]),_:1},8,["header"]),i(e(y),{header:e(a)("product.freeShipping")},{body:c(t=>[s("div",oa,[R(i(e(ye),{"model-value":t.data.is_free_shipping===1,disabled:z.value[t.data.id],"onUpdate:modelValue":f=>je(t.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[v,t.data.is_free_shipping===1?e(a)("product.freeShipping"):e(a)("product.notFreeShipping"),void 0,{top:!0}]]),z.value[t.data.id]?(h(),xe(e(ke),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):T("",!0)])]),_:1},8,["header"]),i(e(y),{header:e(a)("product.bestSeller")},{body:c(t=>[s("div",ia,[R(i(e(ye),{"model-value":t.data.is_best_seller,disabled:O.value[t.data.id],"onUpdate:modelValue":f=>Te(t.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[v,t.data.is_best_seller?"Best Seller":"Not Best Seller",void 0,{top:!0}]]),O.value[t.data.id]?(h(),xe(e(ke),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):T("",!0)])]),_:1},8,["header"]),i(e(y),{header:e(a)("actions")},{body:c(t=>[R(i(e(p),{icon:"pi pi-pencil",class:"p-detail",onClick:f=>Me(t.data.id)},null,8,["onClick"]),[[r,"edit products"],[v,e(a)("edit"),void 0,{top:!0}]]),R(i(e(p),{icon:"pi pi-trash",class:"p-delete mx-2",onClick:f=>Fe(t.data.id)},null,8,["onClick"]),[[r,"delete products"],[v,e(a)("delete"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading"]),s("div",da,[s("div",na,[s("span",ca,u(e(a)("show"))+" "+u(ie.value)+" "+u(e(a)("to"))+" "+u(se.value)+" "+u(e(a)("from"))+" "+u(oe.value),1)]),s("div",ua,[s("button",{class:"p-paginator-first p-paginator-element p-link",disabled:_.value===1,onClick:l[4]||(l[4]=t=>B(1)),"aria-label":"First page"},l[24]||(l[24]=[s("span",{class:"p-paginator-icon pi pi-angle-double-left"},null,-1)]),8,pa),s("button",{class:"p-paginator-prev p-paginator-element p-link",disabled:!o.prevPageUrl,onClick:l[5]||(l[5]=t=>B(_.value-1)),"aria-label":"Previous page"},l[25]||(l[25]=[s("span",{class:"p-paginator-icon pi pi-angle-left"},null,-1)]),8,va),(h(!0),C(ge,null,qe(re.value,(t,f)=>(h(),C(ge,{key:f},[t.label&&!isNaN(parseInt(t.label))?(h(),C("button",{key:0,class:Je(["p-paginator-page p-paginator-element p-link",{"p-highlight":t.active}]),onClick:q=>B(parseInt(t.label)),"aria-label":`Page ${t.label}`},u(t.label),11,ma)):t.label==="..."?(h(),C("span",ba,"...")):T("",!0)],64))),128)),s("button",{class:"p-paginator-next p-paginator-element p-link",disabled:!o.nextPageUrl,onClick:l[6]||(l[6]=t=>B(_.value+1)),"aria-label":"Next page"},l[26]||(l[26]=[s("span",{class:"p-paginator-icon pi pi-angle-right"},null,-1)]),8,fa),s("button",{class:"p-paginator-last p-paginator-element p-link",disabled:_.value===W.value,onClick:l[7]||(l[7]=t=>B(W.value)),"aria-label":"Last page"},l[27]||(l[27]=[s("span",{class:"p-paginator-icon pi pi-angle-double-right"},null,-1)]),8,_a),i(e(A),{modelValue:D.value,"onUpdate:modelValue":l[8]||(l[8]=t=>D.value=t),options:[5,10,20,30],onChange:$e,class:"ml-2",style:{width:"80px"},"aria-label":"Rows per page"},null,8,["modelValue"])])])]),i(e(I),{visible:L.value,"onUpdate:visible":l[14]||(l[14]=t=>L.value=t),header:e(a)("filters"),modal:!0,style:{width:"90vw",maxWidth:"500px"}},{footer:c(()=>[i(e(p),{label:e(a)("clearFilters"),icon:"pi pi-refresh",class:"p-button-text p-button-secondary",onClick:l[12]||(l[12]=t=>{Se(),L.value=!1})},null,8,["label"]),i(e(p),{label:e(a)("apply"),icon:"pi pi-check",onClick:l[13]||(l[13]=t=>{L.value=!1,_.value=1,g()})},null,8,["label"])]),default:c(()=>[s("div",ga,[s("div",null,[s("label",ha,u(e(a)("product.categoryFilter")),1),i(e(A),{modelValue:x.value,"onUpdate:modelValue":l[9]||(l[9]=t=>x.value=t),options:Z.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("product.categoryFilter"),showClear:"",filter:"",onFilter:we,class:"w-full"},null,8,["modelValue","options","placeholder"])]),s("div",null,[s("label",ya,u(e(a)("product.storeFilter")),1),i(e(A),{modelValue:k.value,"onUpdate:modelValue":l[10]||(l[10]=t=>k.value=t),options:ee.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("product.storeFilter"),showClear:"",class:"w-full"},null,8,["modelValue","options","placeholder"])]),s("div",null,[s("label",xa,u(e(a)("product.marketFilter")),1),i(e(A),{modelValue:w.value,"onUpdate:modelValue":l[11]||(l[11]=t=>w.value=t),options:ae.value,optionLabel:"label",optionValue:"value",placeholder:e(a)("product.marketFilter"),showClear:"",filter:"",onFilter:Ce,class:"w-full"},null,8,["modelValue","options","placeholder"])])])]),_:1},8,["visible","header"]),i(e(I),{visible:P.value,"onUpdate:visible":l[16]||(l[16]=t=>P.value=t),style:{width:"450px"},header:e(a)("product.deleteConfirmTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(a)("no"),icon:"pi pi-times",class:"p-button-text",onClick:l[15]||(l[15]=t=>P.value=!1)},null,8,["label"]),i(e(p),{label:e(a)("yes"),icon:"pi pi-check",class:"p-button-danger",onClick:Ue},null,8,["label"])]),default:c(()=>[s("div",ka,[l[28]||(l[28]=s("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),s("span",null,u(e(a)("product.deleteConfirmMessage")),1)])]),_:1},8,["visible","header"]),i(e(I),{visible:$.value,"onUpdate:visible":l[18]||(l[18]=t=>$.value=t),style:{width:"450px"},header:e(a)("product.importTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[17]||(l[17]=t=>{$.value=!1,m.value=null})},null,8,["label"]),i(e(p),{label:e(a)("product.importButton"),icon:"pi pi-check",loading:U.value,disabled:!m.value,onClick:De},null,8,["label","loading","disabled"])]),default:c(()=>[s("div",wa,[i(e(p),{label:e(a)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Ve},null,8,["label"]),i(e(H),{mode:"basic","custom-upload":!0,onSelect:be,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(h(),C("div",Ca,[s("p",Sa,u(e(a)("selectedFile"))+": "+u(m.value.name),1)])):T("",!0)])]),_:1},8,["visible","header"]),i(e(I),{visible:F.value,"onUpdate:visible":l[20]||(l[20]=t=>F.value=t),style:{width:"450px"},header:e(a)("product.import_product_characteristics"),modal:!0},{footer:c(()=>[i(e(p),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[19]||(l[19]=t=>{F.value=!1,m.value=null})},null,8,["label"]),i(e(p),{label:e(a)("product.importButton"),icon:"pi pi-check",loading:U.value,disabled:!m.value,onClick:Be},null,8,["label","loading","disabled"])]),default:c(()=>[s("div",$a,[i(e(p),{label:e(a)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Ee},null,8,["label"]),i(e(H),{mode:"basic","custom-upload":!0,onSelect:be,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(h(),C("div",Fa,[s("p",Ua,u(e(a)("selectedFile"))+": "+u(m.value.name),1)])):T("",!0)])]),_:1},8,["visible","header"]),i(e(I),{visible:V.value,"onUpdate:visible":l[22]||(l[22]=t=>V.value=t),style:{width:"450px"},header:e(a)("product.updatePriceTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[21]||(l[21]=t=>{V.value=!1,E.value=null})},null,8,["label"]),i(e(p),{label:e(a)("product.updatePriceButton"),icon:"pi pi-check",loading:Q.value,disabled:!E.value,onClick:Re},null,8,["label","loading","disabled"])]),default:c(()=>[s("div",Va,[i(e(p),{label:e(a)("product.downloadPriceExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Pe},null,8,["label"]),i(e(H),{mode:"basic","custom-upload":!0,onSelect:Le,maxFileSize:1e7,chooseLabel:"Select Price File"})])]),_:1},8,["visible","header"])])])])}}};export{La as default};
