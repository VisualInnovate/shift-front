import{_ as de,c as re,u as ue,r as s,z as pe,o as ce,p as D,a1 as H,e as b,f as N,g as i,h as n,w as p,i as e,B as C,v as ve,t as d,F as J,m as me,U as x,W as g,a3 as fe,x as be,s as ge,a4 as $,k as L,a5 as _e,n as ye,l as K,V as he,T as X,E as Ne,ah as xe}from"./index-ee4707b9.js";const Ve={class:"grid"},ke={class:"col-12"},Ue={class:"card p-4 shadow-2 border-round"},we={class:"text-2xl font-bold"},Ce={class:"flex gap-2"},$e={class:"p-input-icon-left"},Pe={class:"card shadow-1 surface-0"},Te={class:"text-center py-4"},Be={class:"text-xl"},Fe={class:"flex justify-content-center align-items-center py-4"},De={class:"p-paginator p-component p-unselectable-text p-paginator-bottom"},Se={class:"p-paginator-left-content"},Ee={class:"p-paginator-current"},Ie={class:"p-paginator-right-content"},Le=["disabled"],Re=["disabled"],Ae=["onClick"],Me={key:1,class:"p-paginator-dots"},ze=["disabled"],We=["disabled"],je={class:"p-fluid"},qe={class:"p-field mb-4"},Ge={for:"name"},Oe={class:"p-field mb-4"},Qe={for:"title"},He={class:"p-field"},Je={for:"body"},Ke={class:"p-fluid"},Xe={class:"p-field mb-4"},Ye={for:"send-title"},Ze={class:"p-field mb-4"},et={for:"send-body"},tt={class:"p-field mb-4"},at={for:"send-all"},lt={class:"flex align-items-center"},it=["disabled"],ot={class:"ml-2"},st={key:0,class:"p-field mb-4"},nt={for:"send-users"},dt={__name:"index",setup(rt){const v=re(),{t:a}=ue(),P=s(!0),R=s([]),A=s(null),Y=s({}),T=s("");s(null);const m=s(1),S=s(0),_=s(10),B=s(0),Z=s(""),ee=s(""),M=s(""),z=s(""),W=s(0),j=s(0),q=s([]),V=s(!1),E=s(null),u=s({name:"",title:"",body:""}),y=s(!1),k=s(!1),r=s({all:1,title:"",body:"",ids:[]}),f=s(!1),G=s([]),h=s([]),I=s(!1),U=()=>{P.value=!0,D.get("/api/template-notification",{params:{page:m.value,per_page:_.value,search:T.value||void 0}}).then(o=>{R.value=o.data.data.data,S.value=o.data.data.total,B.value=o.data.data.last_page,Z.value=o.data.data.first_page_url,ee.value=o.data.data.last_page_url,M.value=o.data.data.next_page_url,z.value=o.data.data.prev_page_url,W.value=o.data.data.from,j.value=o.data.data.to,q.value=o.data.data.links,P.value=!1}).catch(o=>{v.add({severity:"error",summary:a("error"),detail:a("templateNotification.loadError"),life:3e3}),P.value=!1,console.error("Error fetching template notifications:",o)})};pe([T,_],()=>{m.value=1,U()});const w=o=>{o>=1&&o<=B.value&&(m.value=o,U())},te=o=>{_.value=o.value,m.value=1,U()},ae=()=>{A.value.exportCSV()},le=o=>{E.value=o.id,u.value.name=o.name,u.value.title=o.title,u.value.body=o.body,V.value=!0},ie=()=>{y.value=!0,D.post(`/api/template-notification/${E.value}`,{name:u.value.name,title:u.value.title,body:u.value.body}).then(()=>{v.add({severity:"success",summary:a("success"),detail:a("templateNotification.updateSuccess"),life:3e3}),U(),V.value=!1,u.value={name:"",title:"",body:""},E.value=null}).catch(o=>{v.add({severity:"error",summary:a("error"),detail:a("templateNotification.updateError"),life:3e3})}).finally(()=>{y.value=!1})};ce(()=>{U(),O()});const O=(o="")=>{I.value=!0,D.get("/api/user",{params:{limit:20,search:o||void 0}}).then(t=>{G.value=t.data.data.data.map(c=>({id:c.id,label:`${c.name} `,value:c.id}))}).catch(t=>{console.error("Error fetching users:",t),v.add({severity:"error",summary:a("error"),detail:"Failed to load users",life:3e3})}).finally(()=>{I.value=!1})},oe=o=>{O(o.value)},se=()=>{r.value={all:1,title:"",body:"",ids:[]},h.value=[],k.value=!0},ne=()=>{if(!r.value.title||!r.value.body){v.add({severity:"warn",summary:a("warning"),detail:a("templateNotification.requiredFields"),life:3e3});return}if(r.value.all===0&&h.value.length===0){v.add({severity:"warn",summary:a("warning"),detail:a("templateNotification.selectAtLeastOne"),life:3e3});return}f.value=!0;const o={all:r.value.all,title:r.value.title,body:r.value.body,ids:r.value.all===0?h.value:[]};D.post("/api/user-notification/send",o).then(t=>{v.add({severity:"success",summary:a("success"),detail:a("templateNotification.notificationSent"),life:3e3}),k.value=!1,r.value={all:1,title:"",body:"",ids:[]},h.value=[]}).catch(t=>{var c,F;v.add({severity:"error",summary:a("error"),detail:((F=(c=t.response)==null?void 0:c.data)==null?void 0:F.message)||"Failed to send notification",life:3e3})}).finally(()=>{f.value=!1})};return(o,t)=>{const c=H("can"),F=H("tooltip");return b(),N("div",Ve,[i("div",ke,[i("div",Ue,[n(e(fe),{class:"mb-4"},{start:p(()=>[i("h2",we,d(e(a)("templateNotification.managementTitle")),1)]),end:p(()=>[i("div",Ce,[i("span",$e,[t[17]||(t[17]=i("i",{class:"pi pi-search"},null,-1)),n(e(x),{modelValue:T.value,"onUpdate:modelValue":t[0]||(t[0]=l=>T.value=l),placeholder:e(a)("templateNotification.search")},null,8,["modelValue","placeholder"])]),C(n(e(g),{label:e(a)("templateNotification.export"),icon:"pi pi-upload",class:"p-export",onClick:ae},null,8,["label"]),[[c,"list template-notification"]]),C(n(e(g),{label:e(a)("templateNotification.sendNotificationButton"),icon:"pi pi-send",class:"p-button-success",onClick:se},null,8,["label"]),[[c,"create template-notification"]])])]),_:1}),n(e(be)),i("div",Pe,[C((b(),ve(e(_e),{ref_key:"dt",ref:A,value:R.value,loading:P.value,"data-key":"id",paginator:!1,rows:_.value,filters:Y.value,totalRecords:S.value,"responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:p(()=>[i("div",Te,[t[18]||(t[18]=i("i",{class:"pi pi-exclamation-circle text-2xl mb-2"},null,-1)),i("p",Be,d(e(a)("templateNotification.noData")),1)])]),loading:p(()=>[i("div",Fe,[n(e(ge),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:p(()=>[n(e($),{"selection-mode":"multiple","header-style":"width: 3rem"}),n(e($),{field:"name",header:e(a)("templateNotification.name"),sortable:!0},{body:p(l=>[L(d(l.data.name),1)]),_:1},8,["header"]),n(e($),{field:"title",header:e(a)("templateNotification.title"),sortable:!0},{body:p(l=>[L(d(l.data.title),1)]),_:1},8,["header"]),n(e($),{field:"body",header:e(a)("templateNotification.body"),sortable:!0},{body:p(l=>[L(d(l.data.body||"-"),1)]),_:1},8,["header"]),n(e($),{header:e(a)("actions"),headerStyle:"width: 8rem"},{body:p(l=>[C(n(e(g),{icon:"pi pi-pencil",class:"p-detail",onClick:Q=>le(l.data)},null,8,["onClick"]),[[c,"edit template-notification"],[F,e(a)("edit"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading","rows","filters","totalRecords"])),[[c,"list template-notification"]]),i("div",De,[i("div",Se,[i("span",Ee,d(e(a)("show"))+" "+d(W.value)+" "+d(e(a)("to"))+" "+d(j.value)+" "+d(e(a)("from"))+" "+d(S.value),1)]),i("div",Ie,[i("button",{class:"p-paginator-first p-paginator-element p-link",disabled:m.value===1,onClick:t[1]||(t[1]=l=>w(1))},t[19]||(t[19]=[i("span",{class:"p-paginator-icon pi pi-angle-double-left"},null,-1)]),8,Le),i("button",{class:"p-paginator-prev p-paginator-element p-link",disabled:!z.value,onClick:t[2]||(t[2]=l=>w(m.value-1))},t[20]||(t[20]=[i("span",{class:"p-paginator-icon pi pi-angle-left"},null,-1)]),8,Re),(b(!0),N(J,null,me(q.value,(l,Q)=>(b(),N(J,{key:Q},[l.label&&!isNaN(parseInt(l.label))?(b(),N("button",{key:0,class:ye(["p-paginator-page p-paginator-element p-link",{"p-highlight":l.active}]),onClick:ut=>w(parseInt(l.label))},d(l.label),11,Ae)):l.label==="..."?(b(),N("span",Me,"...")):K("",!0)],64))),128)),i("button",{class:"p-paginator-next p-paginator-element p-link",disabled:!M.value,onClick:t[3]||(t[3]=l=>w(m.value+1))},t[21]||(t[21]=[i("span",{class:"p-paginator-icon pi pi-angle-right"},null,-1)]),8,ze),i("button",{class:"p-paginator-last p-paginator-element p-link",disabled:m.value===B.value,onClick:t[4]||(t[4]=l=>w(B.value))},t[22]||(t[22]=[i("span",{class:"p-paginator-icon pi pi-angle-double-right"},null,-1)]),8,We),n(e(he),{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=l=>_.value=l),options:[5,10,20,30],onChange:te,class:"ml-2",style:{width:"80px"}},null,8,["modelValue"])])])]),n(e(X),{visible:V.value,"onUpdate:visible":t[10]||(t[10]=l=>V.value=l),style:{width:"450px"},header:e(a)("templateNotification.updateTitle"),modal:!0},{footer:p(()=>[n(e(g),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",disabled:y.value,onClick:t[9]||(t[9]=l=>V.value=!1)},null,8,["label","disabled"]),n(e(g),{label:e(a)("save"),icon:"pi pi-check",class:"p-button-text p-button-success",disabled:y.value,onClick:ie},null,8,["label","disabled"])]),default:p(()=>[i("div",je,[i("div",qe,[i("label",Ge,d(e(a)("templateNotification.name")),1),n(e(x),{id:"name",disabled:"true",modelValue:u.value.name,"onUpdate:modelValue":t[6]||(t[6]=l=>u.value.name=l),placeholder:e(a)("templateNotification.name")},null,8,["modelValue","placeholder","disabled"])]),i("div",Oe,[i("label",Qe,d(e(a)("templateNotification.title")),1),n(e(x),{id:"title",modelValue:u.value.title,"onUpdate:modelValue":t[7]||(t[7]=l=>u.value.title=l),placeholder:e(a)("templateNotification.title"),disabled:y.value},null,8,["modelValue","placeholder","disabled"])]),i("div",He,[i("label",Je,d(e(a)("templateNotification.body")),1),n(e(x),{id:"body",modelValue:u.value.body,"onUpdate:modelValue":t[8]||(t[8]=l=>u.value.body=l),placeholder:e(a)("templateNotification.body"),disabled:y.value},null,8,["modelValue","placeholder","disabled"])])])]),_:1},8,["visible","header"]),n(e(X),{visible:k.value,"onUpdate:visible":t[16]||(t[16]=l=>k.value=l),style:{width:"600px"},header:e(a)("templateNotification.sendNotificationTitle"),modal:!0,maximizable:!0},{footer:p(()=>[n(e(g),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",disabled:f.value,onClick:t[15]||(t[15]=l=>k.value=!1)},null,8,["label","disabled"]),n(e(g),{label:e(a)("templateNotification.sendNotificationButton"),icon:"pi pi-send",class:"p-button-text p-button-success",disabled:f.value,onClick:ne},null,8,["label","disabled"])]),default:p(()=>[i("div",Ke,[i("div",Xe,[i("label",Ye,d(e(a)("templateNotification.notificationTitle")),1),n(e(x),{id:"send-title",modelValue:r.value.title,"onUpdate:modelValue":t[11]||(t[11]=l=>r.value.title=l),placeholder:e(a)("templateNotification.notificationTitle"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),i("div",Ze,[i("label",et,d(e(a)("templateNotification.notificationBody")),1),n(e(x),{id:"send-body",modelValue:r.value.body,"onUpdate:modelValue":t[12]||(t[12]=l=>r.value.body=l),placeholder:e(a)("templateNotification.notificationBody"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),i("div",tt,[i("label",at,d(e(a)("templateNotification.sendToAllUsers")),1),i("div",lt,[C(i("input",{id:"send-all","onUpdate:modelValue":t[13]||(t[13]=l=>r.value.all=l),type:"checkbox","true-value":1,"false-value":0,disabled:f.value},null,8,it),[[Ne,r.value.all,void 0,{number:!0}]]),i("span",ot,d(e(a)("templateNotification.yesAllUsers")),1)])]),r.value.all===0?(b(),N("div",st,[i("label",nt,d(e(a)("templateNotification.selectUsers")),1),n(e(xe),{id:"send-users",modelValue:h.value,"onUpdate:modelValue":t[14]||(t[14]=l=>h.value=l),options:G.value,"option-label":"label","option-value":"value",placeholder:e(a)("templateNotification.searchUsers"),"max-selected-labels":3,disabled:f.value,loading:I.value,filter:"",onFilter:oe,class:"w-full"},null,8,["modelValue","options","placeholder","disabled","loading"])])):K("",!0)])]),_:1},8,["visible","header"])])])])}}},ct=de(dt,[["__scopeId","data-v-ad6218c8"]]);export{ct as default};
