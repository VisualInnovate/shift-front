import{_ as Oe,l as qe,a as Ae,u as Qe,r as s,x as fe,b as _,o as We,a1 as ge,e as f,h as k,g as d,i,w as c,j as e,t as u,F as he,m as Ge,U as Ke,V as q,W as v,ae as ye,B as D,a3 as He,k as Je,a4 as g,v as R,ad as Xe,af as xe,f as ke,s as we,n as j,a5 as Ye,A as Ze,T as A,ag as K}from"./index-254a2c4d.js";const et={class:"grid"},tt={class:"col-12"},at={class:"card p-4 shadow-2 border-round"},lt={class:"text-2xl font-bold"},ot={class:"flex flex-column gap-3"},it={class:"flex gap-2 align-items-center"},st={class:"p-input-icon-left"},rt={class:"flex flex-wrap gap-2 align-items-center"},dt={class:"card shadow-1 surface-0"},nt={class:"flex justify-content-center align-items-center"},ct={class:"flex justify-content-center align-items-center"},ut={class:"text-center py-4"},pt={class:"text-xl"},vt={class:"p-paginator p-component p-unselectable-text p-paginator-bottom"},mt={class:"p-paginator-left-content"},bt={class:"p-paginator-current"},_t={class:"p-paginator-right-content"},ft=["disabled"],gt=["disabled"],ht=["onClick"],yt={key:1,class:"p-paginator-dots"},xt=["disabled"],kt=["disabled"],wt={class:"flex align-items-center justify-content-center"},St={class:"flex flex-column gap-3"},Ct={key:0,class:"mt-2"},Ut={class:"font-semibold"},Vt={class:"flex flex-column gap-3"},$t={key:0,class:"mt-4"},Ft={class:"font-semibold"},Et={class:"flex flex-column gap-3"},Lt={__name:"index",setup(Pt){const H=qe(),n=Ae(),{t}=Qe(),I=s(!0),J=s([]),F=s(!1),X=s(null);s(null),s({});const w=s("");s(null);const x=s(!1),E=s(!1),m=s(null),S=s(!1),Y=s([]),Z=s([]),ee=s([]),C=s(null),U=s(null),V=s(null),te=s(""),ae=s(""),T=s(localStorage.getItem("appLang")||"en"),$=s(!1),L=s(null),Q=s(!1),M=s({}),N=s({}),h=s(1),le=s(0),P=s(10),z=s(0),Se=s(""),Ce=s(""),oe=s(""),ie=s(""),se=s(0),re=s(0),de=s([]),ne=s(null),ce=s(null),ue=s([{label:t("product.import"),icon:"pi pi-download",command:()=>{x.value=!0}},{label:t("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{E.value=!0}},{label:t("product.updatePrice"),icon:"pi pi-dollar",command:()=>{$.value=!0}}]),pe=s([{label:t("product.export"),icon:"pi pi-upload",command:()=>{me()}},{label:t("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{be()}}]),W=async()=>{try{const o=await _.get("/api/category",{params:{search:te.value||void 0}}),l=T.value;Y.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("category.loadError"),life:3e3})}},ve=async()=>{try{const o=await _.get("/api/store"),l=T.value;Z.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("store.loadError"),life:3e3})}},G=async()=>{try{const o=await _.get("/api/market",{params:{search:ae.value||void 0}}),l=T.value;ee.value=o.data.data.data.map(r=>({label:l==="en"?r.name_en:r.name_ar,value:r.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("market.loadError"),life:3e3})}},y=()=>{I.value=!0,_.get("/api/product",{params:{page:h.value,limit:P.value,search:w.value||void 0,category_id:C.value||void 0,store_id:U.value||void 0,market_id:V.value||void 0}}).then(o=>{J.value=o.data.data.data,le.value=o.data.data.total,z.value=o.data.data.last_page,Se.value=o.data.data.first_page_url,Ce.value=o.data.data.last_page_url,oe.value=o.data.data.next_page_url,ie.value=o.data.data.prev_page_url,se.value=o.data.data.from,re.value=o.data.data.to,de.value=o.data.data.links,I.value=!1}).catch(o=>{n.add({severity:"error",summary:t("error"),detail:t("product.loadError"),life:3e3}),I.value=!1,console.error("Error fetching products:",o)})};fe([w,P,C,U,V],()=>{h.value=1,y()}),fe(T,()=>{W(),ve(),G(),ue.value=[{label:t("product.import"),icon:"pi pi-download",command:()=>{x.value=!0}},{label:t("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{E.value=!0}},{label:t("product.updatePrice"),icon:"pi pi-dollar",command:()=>{$.value=!0}}],pe.value=[{label:t("product.export"),icon:"pi pi-upload",command:()=>{me()}},{label:t("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{be()}}]});const Ue=o=>{te.value=o.value,W()},Ve=o=>{ae.value=o.value,G()},B=o=>{o>=1&&o<=z.value&&(h.value=o,y())},$e=o=>{P.value=o.value,h.value=1,y()},Fe=o=>{X.value=o,F.value=!0},Ee=()=>{_.delete(`/api/product/${X.value}`).then(()=>{n.add({severity:"success",summary:t("success"),detail:t("product.deleteSuccess"),life:3e3}),y(),F.value=!1}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.deleteError"),life:3e3})})},me=()=>{const l=`/api/export/products?${new URLSearchParams({search:w.value||"",category_id:C.value||"",store_id:U.value||"",market_id:V.value||""}).toString()}`;_.get(l,{responseType:"blob"}).then(r=>{const p=new Blob([r.data],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(p),a.download="products_export.csv",a.click(),n.add({severity:"success",summary:t("success"),detail:t("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.exportError"),life:3e3})})},be=()=>{const l=`/api/export/variants?${new URLSearchParams({search:w.value||"",category_id:C.value||"",store_id:U.value||"",market_id:V.value||""}).toString()}`;_.get(l,{responseType:"blob"}).then(r=>{const p=new Blob([r.data],{type:"text/csv"}),a=document.createElement("a");a.href=URL.createObjectURL(p),a.download="products_variants_export.csv",a.click(),n.add({severity:"success",summary:t("success"),detail:t("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.exportError"),life:3e3})})},Le=()=>{const o=`store_id,category_id,market_id,name_en,name_ar,sku,brand_id,sub_name_en,sub_name_ar,description_en,description_ar,base_price,cost_price,tax
1,1,1,Demo Product,منتج تجريبي,SKU001,1,Sub Demo,تجريبي فرعي,Description,وصف,15.50,10.00,0.05`,l=new Blob([o],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(l),r.download="product_import_example.csv",r.click()},Pe=()=>{const o=[{product_id:84,variant_id:9,price:2},{product_id:1650,variant_id:10,price:0},{product_id:22516,variant_id:11,price:.03},{product_id:22516,variant_id:12,price:.33},{product_id:37864,variant_id:19,price:10},{product_id:37864,variant_id:20,price:9},{product_id:37864,variant_id:21,price:10},{product_id:37864,variant_id:22,price:9},{product_id:55,variant_id:25,price:.77}],r=[["product_id","variant_id","price"].join(","),...o.map(O=>`${O.product_id},${O.variant_id},${O.price}`)].join(`
`),p=new Blob(["\uFEFF"+r],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(p),b=document.createElement("a");b.href=a,b.setAttribute("download","products_template.csv"),b.style.visibility="hidden",document.body.appendChild(b),b.click(),document.body.removeChild(b)},Be=()=>{const o=`id,price,cost_price
1,16.00,10.50
2,23.50,15.00`,l=new Blob([o],{type:"text/csv"}),r=document.createElement("a");r.href=URL.createObjectURL(l),r.download="product_price_update_example.csv",r.click()},_e=o=>{m.value=o.files[0]},De=o=>{L.value=o.files[0]},Re=()=>{if(!m.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});S.value=!0;const o=new FormData;o.append("file",m.value),_.post("/api/import/products",o).then(()=>{n.add({severity:"success",detail:t("product.importSuccess"),life:3e3}),y(),x.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:t("product.importError"),life:3e3})).finally(()=>S.value=!1)},je=()=>{if(!m.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});S.value=!0;const o=new FormData;o.append("file",m.value),_.post("/api/product/update/variants/prices",o).then(()=>{n.add({severity:"success",detail:t("product.importSuccess"),life:3e3}),y(),x.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:t("product.importError"),life:3e3})).finally(()=>S.value=!1)},Ie=()=>{if(!L.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});Q.value=!0;const o=new FormData;o.append("file",L.value),_.post("/api/product/update/prices",o).then(()=>{n.add({severity:"success",detail:t("product.priceUpdateSuccess"),life:3e3}),y(),$.value=!1,L.value=null}).catch(()=>n.add({severity:"error",detail:t("product.priceUpdateError"),life:3e3})).finally(()=>Q.value=!1)},Te=async o=>{const l=o.id,r=o.is_free_shipping,p=r===1?0:1;M.value[l]=!0;try{await _.post(`/api/product/is/free/shipping/${l}`,{is_free_shipping:p}),o.is_free_shipping=p,n.add({severity:"success",detail:t(p===1?"product.freeShippingEnabled":"product.freeShippingDisabled"),life:3e3})}catch{o.is_free_shipping=r,n.add({severity:"error",detail:t("product.freeShippingUpdateError"),life:3e3})}finally{M.value[l]=!1}},Me=async o=>{const l=o.id,r=o.is_best_seller?1:0,p=r===1?0:1;N.value[l]=!0;try{await _.get(`/api/product/update/best-sellers/${l}`),o.is_best_seller=p===1,n.add({severity:"success",summary:t("success"),detail:p===1?"Product marked as Best Seller":"Product removed from Best Sellers",life:3e3})}catch(a){o.is_best_seller=r===1,n.add({severity:"error",summary:t("error"),detail:"Failed to update Best Seller status",life:3e3}),console.error("Error updating best seller:",a)}finally{N.value[l]=!1}},Ne=()=>H.push({name:"product-create"}),ze=o=>H.push({name:"product-update",params:{id:o}});return We(()=>{Promise.all([W(),ve(),G(),y()])}),(o,l)=>{const r=ge("can"),p=ge("tooltip");return f(),k("div",et,[d("div",tt,[d("div",at,[i(e(He),{class:"mb-4"},{start:c(()=>[d("h2",lt,u(e(t)("product.managementTitle")),1)]),end:c(()=>[d("div",ot,[d("div",it,[d("span",st,[l[19]||(l[19]=d("i",{class:"pi pi-search"},null,-1)),i(e(Ke),{modelValue:w.value,"onUpdate:modelValue":l[0]||(l[0]=a=>w.value=a),placeholder:e(t)("product.search")},null,8,["modelValue","placeholder"])]),i(e(q),{modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=a=>C.value=a),options:Y.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.categoryFilter"),class:"w-12rem",showClear:!0,filter:"",onFilter:Ue},null,8,["modelValue","options","placeholder"]),i(e(q),{modelValue:U.value,"onUpdate:modelValue":l[2]||(l[2]=a=>U.value=a),options:Z.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.storeFilter"),class:"w-12rem",showClear:!0},null,8,["modelValue","options","placeholder"]),i(e(q),{modelValue:V.value,"onUpdate:modelValue":l[3]||(l[3]=a=>V.value=a),options:ee.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.marketFilter"),class:"w-12rem",showClear:!0,filter:"",onFilter:Ve},null,8,["modelValue","options","placeholder"])]),d("div",rt,[i(e(v),{label:e(t)("product.import"),icon:"pi pi-download",class:"p-button-outlined",onClick:l[4]||(l[4]=a=>ne.value.toggle(a))},null,8,["label"]),i(e(ye),{ref_key:"importMenu",ref:ne,model:ue.value,popup:!0},null,8,["model"]),i(e(v),{label:e(t)("product.export"),icon:"pi pi-upload",class:"p-button-outlined",onClick:l[5]||(l[5]=a=>ce.value.toggle(a))},null,8,["label"]),i(e(ye),{ref_key:"exportMenu",ref:ce,model:pe.value,popup:!0},null,8,["model"]),D(i(e(v),{label:e(t)("product.new"),icon:"pi pi-plus",class:"p-button-success",onClick:Ne},null,8,["label"]),[[r,"create products"]])])])]),_:1}),i(e(Je)),d("div",dt,[i(e(Ye),{value:J.value,loading:I.value,"data-key":"id","responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:c(()=>[d("div",ut,[d("p",pt,u(e(t)("product.noData")),1)])]),default:c(()=>[i(e(g),{field:"id",header:e(t)("id"),sortable:!0,"header-style":"width:6%;"},{body:c(a=>[R(u(a.data.id),1)]),_:1},8,["header"]),i(e(g),{field:"name_ar",header:e(t)("product.nameAr"),sortable:!0},{body:c(a=>[R(u(a.data.name_ar),1)]),_:1},8,["header"]),i(e(g),{field:"name_en",header:e(t)("product.nameEn"),sortable:!0},{body:c(a=>[R(u(a.data.name_en),1)]),_:1},8,["header"]),i(e(g),{field:"base_price",header:e(t)("product.basePrice")},{body:c(a=>[R(u(a.data.base_price),1)]),_:1},8,["header"]),i(e(g),{header:e(t)("product.Price after discount")},{body:c(a=>[R(u(a.data.base_price-a.data.total_discounts_value),1)]),_:1},8,["header"]),i(e(g),{field:"is_displayed",header:e(t)("product.isDisplayed")},{body:c(a=>[i(e(Xe),{value:a.data.is_displayed?e(t)("yes"):e(t)("no"),severity:a.data.is_displayed?"success":"info"},null,8,["value","severity"])]),_:1},8,["header"]),i(e(g),{header:e(t)("product.freeShipping")},{body:c(a=>[d("div",nt,[D(i(e(xe),{"model-value":a.data.is_free_shipping===1,disabled:M.value[a.data.id],"onUpdate:modelValue":b=>Te(a.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[p,a.data.is_free_shipping===1?e(t)("product.freeShipping"):e(t)("product.notFreeShipping"),void 0,{top:!0}]]),M.value[a.data.id]?(f(),ke(e(we),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):j("",!0)])]),_:1},8,["header"]),i(e(g),{header:e(t)("product.bestSeller")||"Best Seller"},{body:c(a=>[d("div",ct,[D(i(e(xe),{"model-value":a.data.is_best_seller,disabled:N.value[a.data.id],"onUpdate:modelValue":b=>Me(a.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[p,a.data.is_best_seller?"Best Seller":"Not Best Seller",void 0,{top:!0}]]),N.value[a.data.id]?(f(),ke(e(we),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):j("",!0)])]),_:1},8,["header"]),i(e(g),{header:e(t)("actions")},{body:c(a=>[D(i(e(v),{icon:"pi pi-pencil",class:"p-detail",onClick:b=>ze(a.data.id)},null,8,["onClick"]),[[r,"edit products"],[p,e(t)("edit"),void 0,{top:!0}]]),D(i(e(v),{icon:"pi pi-trash mx-2",class:"p-delete",onClick:b=>Fe(a.data.id)},null,8,["onClick"]),[[r,"delete products"],[p,e(t)("delete"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading"]),d("div",vt,[d("div",mt,[d("span",bt,u(e(t)("show"))+" "+u(se.value)+" "+u(e(t)("to"))+" "+u(re.value)+" "+u(e(t)("from"))+" "+u(le.value),1)]),d("div",_t,[d("button",{class:"p-paginator-first p-link",disabled:h.value===1,onClick:l[6]||(l[6]=a=>B(1))},l[20]||(l[20]=[d("span",{class:"pi pi-angle-double-left"},null,-1)]),8,ft),d("button",{class:"p-paginator-prev p-link",disabled:!ie.value,onClick:l[7]||(l[7]=a=>B(h.value-1))},l[21]||(l[21]=[d("span",{class:"pi pi-angle-left"},null,-1)]),8,gt),(f(!0),k(he,null,Ge(de.value,(a,b)=>(f(),k(he,{key:b},[a.label&&!isNaN(parseInt(a.label))?(f(),k("button",{key:0,class:Ze(["p-paginator-page p-link",{"p-highlight":a.active}]),onClick:O=>B(parseInt(a.label))},u(a.label),11,ht)):a.label==="..."?(f(),k("span",yt,"...")):j("",!0)],64))),128)),d("button",{class:"p-paginator-next p-link",disabled:!oe.value,onClick:l[8]||(l[8]=a=>B(h.value+1))},l[22]||(l[22]=[d("span",{class:"pi pi-angle-right"},null,-1)]),8,xt),d("button",{class:"p-paginator-last p-link",disabled:h.value===z.value,onClick:l[9]||(l[9]=a=>B(z.value))},l[23]||(l[23]=[d("span",{class:"pi pi-angle-double-right"},null,-1)]),8,kt),i(e(q),{modelValue:P.value,"onUpdate:modelValue":l[10]||(l[10]=a=>P.value=a),options:[5,10,20,30],onChange:$e,class:"ml-2",style:{width:"80px"}},null,8,["modelValue"])])])]),i(e(A),{visible:F.value,"onUpdate:visible":l[12]||(l[12]=a=>F.value=a),style:{width:"450px"},header:e(t)("product.deleteConfirmTitle"),modal:!0},{footer:c(()=>[i(e(v),{label:e(t)("no"),icon:"pi pi-times",class:"p-button-text",onClick:l[11]||(l[11]=a=>F.value=!1)},null,8,["label"]),i(e(v),{label:e(t)("yes"),icon:"pi pi-check",class:"p-button-text p-button-danger",onClick:Ee},null,8,["label"])]),default:c(()=>[d("div",wt,[l[24]||(l[24]=d("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),d("span",null,u(e(t)("product.deleteConfirmMessage")),1)])]),_:1},8,["visible","header"]),i(e(A),{visible:x.value,"onUpdate:visible":l[14]||(l[14]=a=>x.value=a),style:{width:"450px"},header:e(t)("product.importTitle"),modal:!0},{footer:c(()=>[i(e(v),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[13]||(l[13]=a=>x.value=!1)},null,8,["label"]),i(e(v),{label:e(t)("product.importButton"),icon:"pi pi-check",loading:S.value,disabled:!m.value,onClick:Re},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",St,[i(e(v),{label:e(t)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Le},null,8,["label"]),i(e(K),{mode:"basic","custom-upload":!0,onSelect:_e,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(f(),k("div",Ct,[d("p",Ut,u(e(t)("selectedFile"))+": "+u(m.value.name),1)])):j("",!0)])]),_:1},8,["visible","header"]),i(e(A),{visible:E.value,"onUpdate:visible":l[16]||(l[16]=a=>E.value=a),style:{width:"450px"},header:e(t)("product.import_product_characteristics"),modal:!0},{footer:c(()=>[i(e(v),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[15]||(l[15]=a=>{E.value=!1,m.value=null})},null,8,["label"]),i(e(v),{label:e(t)("product.importButton"),icon:"pi pi-check",loading:S.value,disabled:!m.value,onClick:je},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",Vt,[i(e(v),{label:e(t)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Pe},null,8,["label"]),i(e(K),{mode:"basic","custom-upload":!0,onSelect:_e,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(f(),k("div",$t,[d("p",Ft,u(e(t)("selectedFile"))+": "+u(m.value.name),1)])):j("",!0)])]),_:1},8,["visible","header"]),i(e(A),{visible:$.value,"onUpdate:visible":l[18]||(l[18]=a=>$.value=a),style:{width:"450px"},header:e(t)("product.updatePriceTitle"),modal:!0},{footer:c(()=>[i(e(v),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:l[17]||(l[17]=a=>$.value=!1)},null,8,["label"]),i(e(v),{label:e(t)("product.updatePriceButton"),icon:"pi pi-check",loading:Q.value,disabled:!L.value,onClick:Ie},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",Et,[i(e(v),{label:e(t)("product.downloadPriceExample"),icon:"pi pi-download",class:"p-button-outlined p-button-warning",onClick:Be},null,8,["label"]),i(e(K),{mode:"basic","custom-upload":!0,onSelect:De,maxFileSize:1e7,chooseLabel:"Select Price File"})])]),_:1},8,["visible","header"])])])])}}},Dt=Oe(Lt,[["__scopeId","data-v-97a37f60"]]);export{Dt as default};
