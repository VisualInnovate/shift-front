import{_ as ne,q as re,a as ue,r as s,B as pe,o as ce,j as D,ab as Q,c as b,d as N,f as i,e as d,w as p,h as e,D as C,l as ve,t as n,F as X,k as me,X as x,Z as g,ad as fe,z as be,y as ge,ae as $,g as L,af as _e,x as ye,m as Y,Y as he,W as Z,H as Ne,ak as xe}from"./index-eef7b1a0.js";const ke={class:"grid"},Ve={class:"col-12"},we={class:"card p-4 shadow-2 border-round"},Ue={class:"text-2xl font-bold"},Ce={class:"flex gap-2"},$e={class:"p-input-icon-left"},Pe={class:"card shadow-1 surface-0"},Be={class:"text-center py-4"},Fe={class:"text-xl"},Te={class:"flex justify-content-center align-items-center py-4"},De={class:"p-paginator p-component p-unselectable-text p-paginator-bottom"},Se={class:"p-paginator-left-content"},Ee={class:"p-paginator-current"},Ie={class:"p-paginator-right-content"},Le=["disabled"],Re=["disabled"],Ae=["onClick"],Me={key:1,class:"p-paginator-dots"},ze=["disabled"],je=["disabled"],qe={class:"p-fluid"},We={class:"p-field mb-4"},Ge={for:"name"},He={class:"p-field mb-4"},Oe={for:"title"},Qe={class:"p-field"},Xe={for:"body"},Ye={class:"p-fluid"},Ze={class:"p-field mb-4"},Je={for:"send-title"},Ke={class:"p-field mb-4"},et={for:"send-body"},tt={class:"p-field mb-4"},at={for:"send-all"},lt={class:"flex align-items-center"},it=["disabled"],ot={class:"ml-2"},st={key:0,class:"p-field mb-4"},dt={for:"send-users"},nt={__name:"index",setup(rt){const v=re(),{t:a}=ue(),P=s(!0),R=s([]),A=s(null),J=s({}),B=s("");s(null);const m=s(1),S=s(0),_=s(10),F=s(0),K=s(""),ee=s(""),M=s(""),z=s(""),j=s(0),q=s(0),W=s([]),k=s(!1),E=s(null),u=s({name:"",title:"",body:""}),y=s(!1),V=s(!1),r=s({all:1,title:"",body:"",ids:[]}),f=s(!1),G=s([]),h=s([]),I=s(!1),w=()=>{P.value=!0,D.get("/api/template-notification",{params:{page:m.value,per_page:_.value,search:B.value||void 0}}).then(o=>{R.value=o.data.data.data,S.value=o.data.data.total,F.value=o.data.data.last_page,K.value=o.data.data.first_page_url,ee.value=o.data.data.last_page_url,M.value=o.data.data.next_page_url,z.value=o.data.data.prev_page_url,j.value=o.data.data.from,q.value=o.data.data.to,W.value=o.data.data.links,P.value=!1}).catch(o=>{v.add({severity:"error",summary:a("error"),detail:a("templateNotification.loadError"),life:3e3}),P.value=!1,console.error("Error fetching template notifications:",o)})};pe([B,_],()=>{m.value=1,w()});const U=o=>{o>=1&&o<=F.value&&(m.value=o,w())},te=o=>{_.value=o.value,m.value=1,w()},ae=()=>{A.value.exportCSV()},le=o=>{E.value=o.id,u.value.name=o.name,u.value.title=o.title,u.value.body=o.body,k.value=!0},ie=()=>{y.value=!0,D.post(`/api/template-notification/${E.value}`,{name:u.value.name,title:u.value.title,body:u.value.body}).then(()=>{v.add({severity:"success",summary:a("success"),detail:a("templateNotification.updateSuccess"),life:3e3}),w(),k.value=!1,u.value={name:"",title:"",body:""},E.value=null}).catch(o=>{v.add({severity:"error",summary:a("error"),detail:a("templateNotification.updateError"),life:3e3})}).finally(()=>{y.value=!1})};ce(()=>{w(),H()});const H=(o="")=>{I.value=!0,D.get("/api/user",{params:{limit:20,search:o||void 0}}).then(t=>{G.value=t.data.data.data.map(c=>({id:c.id,label:`${c.name} `,value:c.id}))}).catch(t=>{console.error("Error fetching users:",t),v.add({severity:"error",summary:a("error"),detail:"Failed to load users",life:3e3})}).finally(()=>{I.value=!1})},oe=o=>{H(o.value)},se=()=>{r.value={all:1,title:"",body:"",ids:[]},h.value=[],V.value=!0},de=()=>{if(!r.value.title||!r.value.body){v.add({severity:"warn",summary:a("warning"),detail:a("templateNotification.requiredFields"),life:3e3});return}if(r.value.all===0&&h.value.length===0){v.add({severity:"warn",summary:a("warning"),detail:a("templateNotification.selectAtLeastOne"),life:3e3});return}f.value=!0;const o={all:r.value.all,title:r.value.title,body:r.value.body,ids:r.value.all===0?h.value:[]};D.post("/api/user-notification/send",o).then(t=>{v.add({severity:"success",summary:a("success"),detail:a("templateNotification.notificationSent"),life:3e3}),V.value=!1,r.value={all:1,title:"",body:"",ids:[]},h.value=[]}).catch(t=>{var c,T;v.add({severity:"error",summary:a("error"),detail:((T=(c=t.response)==null?void 0:c.data)==null?void 0:T.message)||"Failed to send notification",life:3e3})}).finally(()=>{f.value=!1})};return(o,t)=>{const c=Q("can"),T=Q("tooltip");return b(),N("div",ke,[i("div",Ve,[i("div",we,[d(e(fe),{class:"mb-4"},{start:p(()=>[i("h2",Ue,n(e(a)("templateNotification.managementTitle")),1)]),end:p(()=>[i("div",Ce,[i("span",$e,[t[17]||(t[17]=i("i",{class:"pi pi-search"},null,-1)),d(e(x),{modelValue:B.value,"onUpdate:modelValue":t[0]||(t[0]=l=>B.value=l),placeholder:e(a)("templateNotification.search")},null,8,["modelValue","placeholder"])]),C(d(e(g),{label:e(a)("templateNotification.export"),icon:"pi pi-upload",class:"p-export",onClick:ae},null,8,["label"]),[[c,"list template-notification"]]),C(d(e(g),{label:e(a)("templateNotification.sendNotificationButton"),icon:"pi pi-send",class:"p-button-success",onClick:se},null,8,["label"]),[[c,"create template-notification"]])])]),_:1}),d(e(be)),i("div",Pe,[C((b(),ve(e(_e),{ref_key:"dt",ref:A,value:R.value,loading:P.value,"data-key":"id",paginator:!1,rows:_.value,filters:J.value,totalRecords:S.value,"responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:p(()=>[i("div",Be,[t[18]||(t[18]=i("i",{class:"pi pi-exclamation-circle text-2xl mb-2"},null,-1)),i("p",Fe,n(e(a)("templateNotification.noData")),1)])]),loading:p(()=>[i("div",Te,[d(e(ge),{style:{width:"50px",height:"50px"},strokeWidth:"4"})])]),default:p(()=>[d(e($),{"selection-mode":"multiple","header-style":"width: 3rem"}),d(e($),{field:"name",header:e(a)("templateNotification.name"),sortable:!0},{body:p(l=>[L(n(l.data.name),1)]),_:1},8,["header"]),d(e($),{field:"title",header:e(a)("templateNotification.title"),sortable:!0},{body:p(l=>[L(n(l.data.title),1)]),_:1},8,["header"]),d(e($),{field:"body",header:e(a)("templateNotification.body"),sortable:!0},{body:p(l=>[L(n(l.data.body||"-"),1)]),_:1},8,["header"]),d(e($),{header:e(a)("actions"),headerStyle:"width: 8rem"},{body:p(l=>[C(d(e(g),{icon:"pi pi-pencil",class:"p-detail",onClick:O=>le(l.data)},null,8,["onClick"]),[[c,"edit template-notification"],[T,e(a)("edit"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading","rows","filters","totalRecords"])),[[c,"list template-notification"]]),i("div",De,[i("div",Se,[i("span",Ee,n(e(a)("show"))+" "+n(j.value)+" "+n(e(a)("to"))+" "+n(q.value)+" "+n(e(a)("from"))+" "+n(S.value),1)]),i("div",Ie,[i("button",{class:"p-paginator-first p-paginator-element p-link",disabled:m.value===1,onClick:t[1]||(t[1]=l=>U(1))},t[19]||(t[19]=[i("span",{class:"p-paginator-icon pi pi-angle-double-left"},null,-1)]),8,Le),i("button",{class:"p-paginator-prev p-paginator-element p-link",disabled:!z.value,onClick:t[2]||(t[2]=l=>U(m.value-1))},t[20]||(t[20]=[i("span",{class:"p-paginator-icon pi pi-angle-left"},null,-1)]),8,Re),(b(!0),N(X,null,me(W.value,(l,O)=>(b(),N(X,{key:O},[l.label&&!isNaN(parseInt(l.label))?(b(),N("button",{key:0,class:ye(["p-paginator-page p-paginator-element p-link",{"p-highlight":l.active}]),onClick:ut=>U(parseInt(l.label))},n(l.label),11,Ae)):l.label==="..."?(b(),N("span",Me,"...")):Y("",!0)],64))),128)),i("button",{class:"p-paginator-next p-paginator-element p-link",disabled:!M.value,onClick:t[3]||(t[3]=l=>U(m.value+1))},t[21]||(t[21]=[i("span",{class:"p-paginator-icon pi pi-angle-right"},null,-1)]),8,ze),i("button",{class:"p-paginator-last p-paginator-element p-link",disabled:m.value===F.value,onClick:t[4]||(t[4]=l=>U(F.value))},t[22]||(t[22]=[i("span",{class:"p-paginator-icon pi pi-angle-double-right"},null,-1)]),8,je),d(e(he),{modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=l=>_.value=l),options:[5,10,20,30],onChange:te,class:"ml-2",style:{width:"80px"}},null,8,["modelValue"])])])]),d(e(Z),{visible:k.value,"onUpdate:visible":t[10]||(t[10]=l=>k.value=l),style:{width:"450px"},header:e(a)("templateNotification.updateTitle"),modal:!0},{footer:p(()=>[d(e(g),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",disabled:y.value,onClick:t[9]||(t[9]=l=>k.value=!1)},null,8,["label","disabled"]),d(e(g),{label:e(a)("save"),icon:"pi pi-check",class:"p-button-text p-button-success",disabled:y.value,onClick:ie},null,8,["label","disabled"])]),default:p(()=>[i("div",qe,[i("div",We,[i("label",Ge,n(e(a)("templateNotification.name")),1),d(e(x),{id:"name",disabled:"true",modelValue:u.value.name,"onUpdate:modelValue":t[6]||(t[6]=l=>u.value.name=l),placeholder:e(a)("templateNotification.name")},null,8,["modelValue","placeholder","disabled"])]),i("div",He,[i("label",Oe,n(e(a)("templateNotification.title")),1),d(e(x),{id:"title",modelValue:u.value.title,"onUpdate:modelValue":t[7]||(t[7]=l=>u.value.title=l),placeholder:e(a)("templateNotification.title"),disabled:y.value},null,8,["modelValue","placeholder","disabled"])]),i("div",Qe,[i("label",Xe,n(e(a)("templateNotification.body")),1),d(e(x),{id:"body",modelValue:u.value.body,"onUpdate:modelValue":t[8]||(t[8]=l=>u.value.body=l),placeholder:e(a)("templateNotification.body"),disabled:y.value},null,8,["modelValue","placeholder","disabled"])])])]),_:1},8,["visible","header"]),d(e(Z),{visible:V.value,"onUpdate:visible":t[16]||(t[16]=l=>V.value=l),style:{width:"600px"},header:e(a)("templateNotification.sendNotificationTitle"),modal:!0,maximizable:!0},{footer:p(()=>[d(e(g),{label:e(a)("cancel"),icon:"pi pi-times",class:"p-button-text",disabled:f.value,onClick:t[15]||(t[15]=l=>V.value=!1)},null,8,["label","disabled"]),d(e(g),{label:e(a)("templateNotification.sendNotificationButton"),icon:"pi pi-send",class:"p-button-text p-button-success",disabled:f.value,onClick:de},null,8,["label","disabled"])]),default:p(()=>[i("div",Ye,[i("div",Ze,[i("label",Je,n(e(a)("templateNotification.notificationTitle")),1),d(e(x),{id:"send-title",modelValue:r.value.title,"onUpdate:modelValue":t[11]||(t[11]=l=>r.value.title=l),placeholder:e(a)("templateNotification.notificationTitle"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),i("div",Ke,[i("label",et,n(e(a)("templateNotification.notificationBody")),1),d(e(x),{id:"send-body",modelValue:r.value.body,"onUpdate:modelValue":t[12]||(t[12]=l=>r.value.body=l),placeholder:e(a)("templateNotification.notificationBody"),disabled:f.value},null,8,["modelValue","placeholder","disabled"])]),i("div",tt,[i("label",at,n(e(a)("templateNotification.sendToAllUsers")),1),i("div",lt,[C(i("input",{id:"send-all","onUpdate:modelValue":t[13]||(t[13]=l=>r.value.all=l),type:"checkbox","true-value":1,"false-value":0,disabled:f.value},null,8,it),[[Ne,r.value.all,void 0,{number:!0}]]),i("span",ot,n(e(a)("templateNotification.yesAllUsers")),1)])]),r.value.all===0?(b(),N("div",st,[i("label",dt,n(e(a)("templateNotification.selectUsers")),1),d(e(xe),{id:"send-users",modelValue:h.value,"onUpdate:modelValue":t[14]||(t[14]=l=>h.value=l),options:G.value,"option-label":"label","option-value":"value",placeholder:e(a)("templateNotification.searchUsers"),"max-selected-labels":3,disabled:f.value,loading:I.value,filter:"",onFilter:oe,class:"w-full"},null,8,["modelValue","options","placeholder","disabled","loading"])])):Y("",!0)])]),_:1},8,["visible","header"])])])])}}},ct=ne(nt,[["__scopeId","data-v-ad6218c8"]]);export{ct as default};
