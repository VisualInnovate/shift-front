import{_ as Ie,l as Ne,a as Oe,u as ze,r,x as fe,b,o as We,a1 as _e,e as D,h as H,g as d,i,w as c,j as e,t as u,U as qe,W as p,ae as he,B,a3 as Qe,k as Ae,a4 as y,v as R,ad as Ge,af as ye,f as ge,s as xe,n as z,a5 as Ke,V as W,T as j,ag as J}from"./index-4ec82d3a.js";const He={class:"grid"},Je={class:"col-12"},Xe={class:"card p-4 shadow-2 border-round"},Ye={class:"text-2xl font-bold"},Ze={class:"p-input-icon-left mx-4"},et={class:"flex flex-wrap gap-3 align-items-center"},tt={class:"card shadow-1 surface-0"},lt={class:"flex justify-content-center align-items-center"},at={class:"flex justify-content-center align-items-center"},ot={class:"text-center py-4"},it={class:"text-xl"},st={class:"flex flex-column md:flex-row justify-content-between align-items-center mt-4"},rt={class:"text-sm text-500"},dt={class:"flex align-items-center gap-2 mt-3 md:mt-0"},nt={class:"mx-3 text-sm"},ct={class:"space-y-4"},ut={class:"block text-900 font-medium mb-2"},pt={class:"block text-900 font-medium mb-2"},vt={class:"block text-900 font-medium mb-2"},mt={class:"flex align-items-center justify-content-center"},bt={class:"flex flex-column gap-3"},ft={key:0,class:"mt-2"},_t={class:"font-semibold"},ht={class:"flex flex-column gap-3"},yt={key:0,class:"mt-2"},gt={class:"font-semibold"},xt={class:"flex flex-column gap-3"},kt={__name:"index",setup(wt){const X=Ne(),n=Oe(),{t}=ze(),T=r(!0),Y=r([]),V=r(!1),Z=r(null),w=r(""),S=r(!1),C=r(!1),m=r(null),$=r(!1),ee=r([]),te=r([]),le=r([]),g=r(null),x=r(null),k=r(null),ae=r(""),oe=r(""),M=r(localStorage.getItem("appLang")||"en"),F=r(!1),U=r(null),q=r(!1),E=r(!1),I=r({}),N=r({}),f=r(1),ie=r(0),L=r(10),P=r(0),se=r(0),re=r(0),Q=r([]),de=r(null),ne=r(null),ce=r([{label:t("importProducts"),icon:"pi pi-download",command:()=>{S.value=!0}},{label:t("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{C.value=!0}},{label:t("updatePrice"),icon:"pi pi-dollar",command:()=>{F.value=!0}}]),ue=r([{label:t("exportProducts"),icon:"pi pi-upload",command:()=>{ve()}},{label:t("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{me()}}]),A=async()=>{try{const o=await b.get("/api/category",{params:{search:ae.value||void 0}}),a=M.value;ee.value=o.data.data.data.map(s=>({label:a==="en"?s.name_en:s.name_ar,value:s.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("category.loadError"),life:3e3})}},pe=async()=>{try{const o=await b.get("/api/store"),a=M.value;te.value=o.data.data.data.map(s=>({label:a==="en"?s.name_en:s.name_ar,value:s.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("store.loadError"),life:3e3})}},G=async()=>{try{const o=await b.get("/api/market",{params:{search:oe.value||void 0}}),a=M.value;le.value=o.data.data.data.map(s=>({label:a==="en"?s.name_en:s.name_ar,value:s.id}))}catch{n.add({severity:"error",summary:t("error"),detail:t("market.loadError"),life:3e3})}},_=()=>{T.value=!0,b.get("/api/product",{params:{page:f.value,limit:L.value,search:w.value||void 0,category_id:g.value||void 0,store_id:x.value||void 0,market_id:k.value||void 0}}).then(o=>{Y.value=o.data.data.data,ie.value=o.data.data.total,P.value=o.data.data.last_page,se.value=o.data.data.from,re.value=o.data.data.to,Q.value=o.data.data.links,T.value=!1}).catch(o=>{n.add({severity:"error",summary:t("error"),detail:t("product.loadError"),life:3e3}),T.value=!1,console.error("Error fetching products:",o)})};fe([w,L,g,x,k],()=>{f.value=1,_()},{deep:!0}),fe(M,()=>{A(),pe(),G(),ce.value=[{label:t("importProducts"),icon:"pi pi-download",command:()=>{S.value=!0}},{label:t("product.import_product_characteristics"),icon:"pi pi-table",command:()=>{C.value=!0}},{label:t("updatePrice"),icon:"pi pi-dollar",command:()=>{F.value=!0}}],ue.value=[{label:t("product.exportProducts"),icon:"pi pi-upload",command:()=>{ve()}},{label:t("product.export_prices_features"),icon:"pi pi-file-export",command:()=>{me()}}]});const ke=o=>{ae.value=o.filter,A()},we=o=>{oe.value=o.filter,G()},Se=()=>{g.value=null,x.value=null,k.value=null,f.value=1,_()},O=o=>{o>=1&&o<=P.value&&(f.value=o,_())},Ce=o=>{L.value=o.value,f.value=1,_()},$e=o=>{Z.value=o,V.value=!0},Fe=()=>{b.delete(`/api/product/${Z.value}`).then(()=>{n.add({severity:"success",summary:t("success"),detail:t("product.deleteSuccess"),life:3e3}),_(),V.value=!1}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.deleteError"),life:3e3})})},ve=()=>{const a=`/api/export/products?${new URLSearchParams({search:w.value||"",category_id:g.value||"",store_id:x.value||"",market_id:k.value||""}).toString()}`;b.get(a,{responseType:"blob"}).then(s=>{const v=new Blob([s.data],{type:"text/csv"}),l=document.createElement("a");l.href=URL.createObjectURL(v),l.download="products_export.csv",l.click(),n.add({severity:"success",summary:t("success"),detail:t("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.exportError"),life:3e3})})},me=()=>{const a=`/api/export/variants?${new URLSearchParams({search:w.value||"",category_id:g.value||"",store_id:x.value||"",market_id:k.value||""}).toString()}`;b.get(a,{responseType:"blob"}).then(s=>{const v=new Blob([s.data],{type:"text/csv"}),l=document.createElement("a");l.href=URL.createObjectURL(v),l.download="products_variants_export.csv",l.click(),n.add({severity:"success",summary:t("success"),detail:t("product.exportSuccess"),life:3e3})}).catch(()=>{n.add({severity:"error",summary:t("error"),detail:t("product.exportError"),life:3e3})})},Ue=()=>{const o=`store_id,category_id,market_id,name_en,name_ar,sku,brand_id,sub_name_en,sub_name_ar,description_en,description_ar,base_price,cost_price,tax
1,1,1,Demo Product,منتج تجريبي,SKU001,1,Sub Demo,تجريبي فرعي,Description,وصف,15.50,10.00,0.05`,a=new Blob([o],{type:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download="product_import_example.csv",s.click()},Ve=()=>{const o=[{product_id:84,variant_id:9,price:2},{product_id:1650,variant_id:10,price:0},{product_id:22516,variant_id:11,price:.03},{product_id:22516,variant_id:12,price:.33},{product_id:37864,variant_id:19,price:10},{product_id:37864,variant_id:20,price:9},{product_id:37864,variant_id:21,price:10},{product_id:37864,variant_id:22,price:9},{product_id:55,variant_id:25,price:.77}],s=[["product_id","variant_id","price"].join(","),...o.map(K=>`${K.product_id},${K.variant_id},${K.price}`)].join(`
`),v=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(v),h=document.createElement("a");h.href=l,h.setAttribute("download","products_template.csv"),document.body.appendChild(h),h.click(),document.body.removeChild(h)},Ee=()=>{const o=`id,price,cost_price
1,16.00,10.50
2,23.50,15.00`,a=new Blob([o],{type:"text/csv"}),s=document.createElement("a");s.href=URL.createObjectURL(a),s.download="product_price_update_example.csv",s.click()},be=o=>{m.value=o.files[0]},Le=o=>{U.value=o.files[0]},Pe=()=>{if(!m.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});$.value=!0;const o=new FormData;o.append("file",m.value),b.post("/api/import/products",o).then(()=>{n.add({severity:"success",detail:t("product.importSuccess"),life:3e3}),_(),S.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:t("product.importError"),life:3e3})).finally(()=>$.value=!1)},De=()=>{if(!m.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});$.value=!0;const o=new FormData;o.append("file",m.value),b.post("/api/product/update/variants/prices",o).then(()=>{n.add({severity:"success",detail:t("product.importSuccess"),life:3e3}),_(),C.value=!1,m.value=null}).catch(()=>n.add({severity:"error",detail:t("product.importError"),life:3e3})).finally(()=>$.value=!1)},Be=()=>{if(!U.value)return n.add({severity:"error",detail:t("validation.fileRequired"),life:3e3});q.value=!0;const o=new FormData;o.append("file",U.value),b.post("/api/product/update/prices",o).then(()=>{n.add({severity:"success",detail:t("product.priceUpdateSuccess"),life:3e3}),_(),F.value=!1,U.value=null}).catch(()=>n.add({severity:"error",detail:t("product.priceUpdateError"),life:3e3})).finally(()=>q.value=!1)},Re=async o=>{const a=o.id,s=o.is_free_shipping,v=s===1?0:1;I.value[a]=!0;try{await b.post(`/api/product/is/free/shipping/${a}`,{is_free_shipping:v}),o.is_free_shipping=v,n.add({severity:"success",detail:t(v===1?"product.freeShippingEnabled":"product.freeShippingDisabled"),life:3e3})}catch{o.is_free_shipping=s,n.add({severity:"error",detail:t("product.freeShippingUpdateError"),life:3e3})}finally{I.value[a]=!1}},je=async o=>{const a=o.id,s=o.is_best_seller?1:0,v=s===1?0:1;N.value[a]=!0;try{await b.get(`/api/product/update/best-sellers/${a}`),o.is_best_seller=v===1,n.add({severity:"success",detail:v===1?"Product marked as Best Seller":"Product removed from Best Sellers",life:3e3})}catch{o.is_best_seller=s===1,n.add({severity:"error",detail:"Failed to update Best Seller status",life:3e3})}finally{N.value[a]=!1}},Te=()=>X.push({name:"product-create"}),Me=o=>X.push({name:"product-update",params:{id:o}});return We(()=>{Promise.all([A(),pe(),G(),_()])}),(o,a)=>{const s=_e("can"),v=_e("tooltip");return D(),H("div",He,[d("div",Je,[d("div",Xe,[i(e(Qe),{class:"mb-4"},{start:c(()=>[d("h2",Ye,u(e(t)("product.managementTitle")),1),d("span",Ze,[a[23]||(a[23]=d("i",{class:"pi pi-search"},null,-1)),i(e(qe),{modelValue:w.value,"onUpdate:modelValue":a[0]||(a[0]=l=>w.value=l),placeholder:e(t)("product.search")},null,8,["modelValue","placeholder"])])]),end:c(()=>[d("div",et,[i(e(p),{label:e(t)("filters"),icon:"pi pi-filter",class:"p-button-outlined",onClick:a[1]||(a[1]=l=>E.value=!0)},null,8,["label"]),i(e(p),{label:e(t)("product.import"),icon:"pi pi-download",class:"p-button-outlined",onClick:a[2]||(a[2]=l=>de.value.toggle(l))},null,8,["label"]),i(e(he),{ref_key:"importMenu",ref:de,model:ce.value,popup:!0},null,8,["model"]),i(e(p),{label:e(t)("product.export"),icon:"pi pi-upload",class:"p-button-outlined",onClick:a[3]||(a[3]=l=>ne.value.toggle(l))},null,8,["label"]),i(e(he),{ref_key:"exportMenu",ref:ne,model:ue.value,popup:!0},null,8,["model"]),B(i(e(p),{label:e(t)("product.new"),icon:"pi pi-plus",class:"p-button-success",onClick:Te},null,8,["label"]),[[s,"create products"]])])]),_:1}),i(e(Ae)),d("div",tt,[i(e(Ke),{value:Y.value,loading:T.value,"data-key":"id","responsive-layout":"scroll",stripedRows:"",showGridlines:"",class:"p-datatable-sm"},{empty:c(()=>[d("div",ot,[d("p",it,u(e(t)("product.noData")),1)])]),default:c(()=>[i(e(y),{field:"id",header:e(t)("id"),sortable:!0,"header-style":"width:6%"},{body:c(l=>[R(u(l.data.id),1)]),_:1},8,["header"]),i(e(y),{field:"name_ar",header:e(t)("product.nameAr"),sortable:!0},{body:c(l=>[R(u(l.data.name_ar),1)]),_:1},8,["header"]),i(e(y),{field:"name_en",header:e(t)("product.nameEn"),sortable:!0},{body:c(l=>[R(u(l.data.name_en),1)]),_:1},8,["header"]),i(e(y),{field:"base_price",header:e(t)("product.basePrice")},{body:c(l=>[R(u(l.data.base_price),1)]),_:1},8,["header"]),i(e(y),{header:e(t)("product.Price after discount")},{body:c(l=>[R(u(l.data.base_price-l.data.total_discounts_value),1)]),_:1},8,["header"]),i(e(y),{field:"is_displayed",header:e(t)("product.isDisplayed")},{body:c(l=>[i(e(Ge),{value:l.data.is_displayed?e(t)("yes"):e(t)("no"),severity:l.data.is_displayed?"success":"info"},null,8,["value","severity"])]),_:1},8,["header"]),i(e(y),{header:e(t)("product.freeShipping")},{body:c(l=>[d("div",lt,[B(i(e(ye),{"model-value":l.data.is_free_shipping===1,disabled:I.value[l.data.id],"onUpdate:modelValue":h=>Re(l.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[v,l.data.is_free_shipping===1?e(t)("product.freeShipping"):e(t)("product.notFreeShipping"),void 0,{top:!0}]]),I.value[l.data.id]?(D(),ge(e(xe),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):z("",!0)])]),_:1},8,["header"]),i(e(y),{header:e(t)("product.bestSeller")},{body:c(l=>[d("div",at,[B(i(e(ye),{"model-value":l.data.is_best_seller,disabled:N.value[l.data.id],"onUpdate:modelValue":h=>je(l.data)},null,8,["model-value","disabled","onUpdate:modelValue"]),[[v,l.data.is_best_seller?"Best Seller":"Not Best Seller",void 0,{top:!0}]]),N.value[l.data.id]?(D(),ge(e(xe),{key:0,style:{width:"20px",height:"20px"},class:"ml-2",strokeWidth:"5"})):z("",!0)])]),_:1},8,["header"]),i(e(y),{header:e(t)("actions")},{body:c(l=>[B(i(e(p),{icon:"pi pi-pencil",class:"p-detail",onClick:h=>Me(l.data.id)},null,8,["onClick"]),[[s,"edit products"],[v,e(t)("edit"),void 0,{top:!0}]]),B(i(e(p),{icon:"pi pi-trash",class:"p-delete mx-2",onClick:h=>$e(l.data.id)},null,8,["onClick"]),[[s,"delete products"],[v,e(t)("delete"),void 0,{top:!0}]])]),_:1},8,["header"])]),_:1},8,["value","loading"]),d("div",st,[d("span",rt,u(e(t)("show"))+" "+u(se.value)+" "+u(e(t)("to"))+" "+u(re.value)+" "+u(e(t)("from"))+" "+u(ie.value),1),d("div",dt,[i(e(p),{icon:"pi pi-angle-double-left",disabled:f.value===1,onClick:a[4]||(a[4]=l=>O(1)),class:"p-button-text"},null,8,["disabled"]),i(e(p),{icon:"pi pi-angle-left",disabled:!Q.value.prev,onClick:a[5]||(a[5]=l=>O(f.value-1)),class:"p-button-text"},null,8,["disabled"]),d("span",nt,"Page "+u(f.value)+" of "+u(P.value),1),i(e(p),{icon:"pi pi-angle-right",disabled:!Q.value.next,onClick:a[6]||(a[6]=l=>O(f.value+1)),class:"p-button-text"},null,8,["disabled"]),i(e(p),{icon:"pi pi-angle-double-right",disabled:f.value===P.value,onClick:a[7]||(a[7]=l=>O(P.value)),class:"p-button-text"},null,8,["disabled"]),i(e(W),{modelValue:L.value,"onUpdate:modelValue":a[8]||(a[8]=l=>L.value=l),options:[5,10,20,30],onChange:Ce,class:"ml-3",style:{width:"80px"}},null,8,["modelValue"])])])]),i(e(j),{visible:E.value,"onUpdate:visible":a[14]||(a[14]=l=>E.value=l),header:e(t)("filters"),modal:!0,style:{width:"90vw",maxWidth:"500px"}},{footer:c(()=>[i(e(p),{label:e(t)("clearFilters"),icon:"pi pi-refresh",class:"p-button-text p-button-secondary",onClick:a[12]||(a[12]=l=>{Se(),E.value=!1})},null,8,["label"]),i(e(p),{label:e(t)("apply"),icon:"pi pi-check",onClick:a[13]||(a[13]=l=>{E.value=!1,f.value=1,_()})},null,8,["label"])]),default:c(()=>[d("div",ct,[d("div",null,[d("label",ut,u(e(t)("product.categoryFilter")),1),i(e(W),{modelValue:g.value,"onUpdate:modelValue":a[9]||(a[9]=l=>g.value=l),options:ee.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.categoryFilter"),showClear:"",filter:"",onFilter:ke,class:"w-full"},null,8,["modelValue","options","placeholder"])]),d("div",null,[d("label",pt,u(e(t)("product.storeFilter")),1),i(e(W),{modelValue:x.value,"onUpdate:modelValue":a[10]||(a[10]=l=>x.value=l),options:te.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.storeFilter"),showClear:"",class:"w-full"},null,8,["modelValue","options","placeholder"])]),d("div",null,[d("label",vt,u(e(t)("product.marketFilter")),1),i(e(W),{modelValue:k.value,"onUpdate:modelValue":a[11]||(a[11]=l=>k.value=l),options:le.value,optionLabel:"label",optionValue:"value",placeholder:e(t)("product.marketFilter"),showClear:"",filter:"",onFilter:we,class:"w-full"},null,8,["modelValue","options","placeholder"])])])]),_:1},8,["visible","header"]),i(e(j),{visible:V.value,"onUpdate:visible":a[16]||(a[16]=l=>V.value=l),style:{width:"450px"},header:e(t)("product.deleteConfirmTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(t)("no"),icon:"pi pi-times",class:"p-button-text",onClick:a[15]||(a[15]=l=>V.value=!1)},null,8,["label"]),i(e(p),{label:e(t)("yes"),icon:"pi pi-check",class:"p-button-danger",onClick:Fe},null,8,["label"])]),default:c(()=>[d("div",mt,[a[24]||(a[24]=d("i",{class:"pi pi-exclamation-triangle mr-3",style:{"font-size":"2rem",color:"var(--red-500)"}},null,-1)),d("span",null,u(e(t)("product.deleteConfirmMessage")),1)])]),_:1},8,["visible","header"]),i(e(j),{visible:S.value,"onUpdate:visible":a[18]||(a[18]=l=>S.value=l),style:{width:"450px"},header:e(t)("product.importTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:a[17]||(a[17]=l=>{S.value=!1,m.value=null})},null,8,["label"]),i(e(p),{label:e(t)("product.importButton"),icon:"pi pi-check",loading:$.value,disabled:!m.value,onClick:Pe},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",bt,[i(e(p),{label:e(t)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Ue},null,8,["label"]),i(e(J),{mode:"basic","custom-upload":!0,onSelect:be,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(D(),H("div",ft,[d("p",_t,u(e(t)("selectedFile"))+": "+u(m.value.name),1)])):z("",!0)])]),_:1},8,["visible","header"]),i(e(j),{visible:C.value,"onUpdate:visible":a[20]||(a[20]=l=>C.value=l),style:{width:"450px"},header:e(t)("product.import_product_characteristics"),modal:!0},{footer:c(()=>[i(e(p),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:a[19]||(a[19]=l=>{C.value=!1,m.value=null})},null,8,["label"]),i(e(p),{label:e(t)("product.importButton"),icon:"pi pi-check",loading:$.value,disabled:!m.value,onClick:De},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",ht,[i(e(p),{label:e(t)("product.downloadExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Ve},null,8,["label"]),i(e(J),{mode:"basic","custom-upload":!0,onSelect:be,maxFileSize:1e7,chooseLabel:"Select File"}),m.value?(D(),H("div",yt,[d("p",gt,u(e(t)("selectedFile"))+": "+u(m.value.name),1)])):z("",!0)])]),_:1},8,["visible","header"]),i(e(j),{visible:F.value,"onUpdate:visible":a[22]||(a[22]=l=>F.value=l),style:{width:"450px"},header:e(t)("product.updatePriceTitle"),modal:!0},{footer:c(()=>[i(e(p),{label:e(t)("cancel"),icon:"pi pi-times",class:"p-button-text",onClick:a[21]||(a[21]=l=>{F.value=!1,U.value=null})},null,8,["label"]),i(e(p),{label:e(t)("product.updatePriceButton"),icon:"pi pi-check",loading:q.value,disabled:!U.value,onClick:Be},null,8,["label","loading","disabled"])]),default:c(()=>[d("div",xt,[i(e(p),{label:e(t)("product.downloadPriceExample"),icon:"pi pi-download",class:"p-button-outlined",onClick:Ee},null,8,["label"]),i(e(J),{mode:"basic","custom-upload":!0,onSelect:Le,maxFileSize:1e7,chooseLabel:"Select Price File"})])]),_:1},8,["visible","header"])])])])}}},Ct=Ie(kt,[["__scopeId","data-v-98f6b22e"]]);export{Ct as default};
