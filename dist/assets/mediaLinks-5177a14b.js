import{_ as P,p as Q,q as S,a as j,r as $,o as B,b as U,c as g,d as b,f as i,t as w,h as r,e as x,F as N,k as R,j as I,y as q,l as A,w as O,Y,ak as Z,Z as z,ap as G}from"./index-df8b6085.js";const H={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},J={class:"text-3xl font-bold text-center mb-8 text-gray-800"},K={key:0,class:"flex justify-center items-center h-64"},W={key:1,class:"text-center text-gray-600"},X={key:2,class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6"},ee={class:"relative group"},ae=["src","alt"],se={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},te=["href","aria-label"],le={class:"mt-2 text-center text-sm text-gray-600"},re={class:"mt-4"},oe={class:"block text-sm font-medium text-gray-700 mb-2"},ce={class:"mt-4"},ie={class:"block text-sm font-medium text-gray-700 mb-2"},ne={__name:"mediaLinks",setup(de){const m=Q(),u=S(),{t:e}=j(),h=$([]),k=$(!1),l=$({}),L=$(localStorage.getItem("appLang")||"en"),F=async()=>{var n,s;k.value=!0;const t=m.params.type==="1"?"store":m.params.type==="2"?"category":null,o=m.params.id;if(!t||!o){u.add({severity:"error",summary:e("error"),detail:e("invalidParams"),life:3e3}),k.value=!1;return}try{const a=await I.get(`/api/product/get/product/category?type=${t}&id=${o}`);if(a.data.is_success&&a.data.data.success)h.value=a.data.data.data||[],h.value.length===0?u.add({severity:"warn",summary:e("warning"),detail:e("noMediaFound"),life:3e3}):h.value.forEach(d=>{var _,E,f;l.value[d.id]={selectedType:((E=(_=d.media_links)==null?void 0:_.type)==null?void 0:E.toString())||m.params.type||"1",selectedIds:((f=d.media_links)==null?void 0:f.ids)||[],availableIds:[],searchQuery:""}});else throw new Error(a.data.message||e("mediaFetchError"))}catch(a){console.error("Error fetching media:",a),u.add({severity:"error",summary:e("error"),detail:((s=(n=a.response)==null?void 0:n.data)==null?void 0:s.message)||a.message||e("mediaFetchError"),life:3e3})}finally{k.value=!1}},T=async(t,o)=>{var n,s;try{const a=o==="1"?"product":"category",d=await I.get(`/api/${a}`,{params:{search:l.value[t].searchQuery||void 0}});let _=[];if(d.data.is_success)_=d.data.data.data||[],l.value[t].availableIds=_.map(c=>({label:L.value==="ar"?c.name_ar||c.name||`ID ${c.id}`:c.name_en||c.name||`ID ${c.id}`,value:c.id}));else throw new Error(d.data.message||e("idFetchError"));const f=l.value[t].selectedIds.filter(c=>!l.value[t].availableIds.some(p=>p.value===c));if(f.length>0){const c=[];for(const p of f)try{const v=await I.get(`/api/${a}`,{params:{search:p}});if(v.data.is_success&&v.data.data.data.length>0){const y=v.data.data.data[0];c.push({label:L.value==="ar"?y.name_ar||y.name||`ID ${y.id}`:y.name_en||y.name||`ID ${y.id}`,value:y.id})}}catch(v){console.warn(`Failed to fetch details for ID ${p}:`,v)}c.forEach(p=>{l.value[t].availableIds.some(v=>v.value===p.value)||l.value[t].availableIds.push(p)})}}catch(a){console.error("Error fetching IDs:",a),u.add({severity:"error",summary:e("error"),detail:((s=(n=a.response)==null?void 0:n.data)==null?void 0:s.message)||a.message||e("idFetchError"),life:3e3})}},V=(t,o)=>{l.value[o].searchQuery=t.value,T(o,l.value[o].selectedType)},C=async t=>{var n,s;const o=l.value[t];if(!o.selectedType){u.add({severity:"error",summary:e("error"),detail:e("selectType"),life:3e3});return}try{const a={media_id:t,type:parseInt(o.selectedType),ids:o.selectedIds},d=await I.post("/api/medialink",a);if(d.data.is_success)u.add({severity:"success",summary:e("success"),detail:e("mediaLinkCreated"),life:3e3}),l.value[t].selectedIds=[],l.value[t].searchQuery="",await T(t,o.selectedType);else throw new Error(d.data.message||e("mediaLinkError"))}catch(a){console.error("Error creating media link:",a),u.add({severity:"error",summary:e("error"),detail:((s=(n=a.response)==null?void 0:n.data)==null?void 0:s.message)||a.message||e("mediaLinkError"),life:3e3})}},D=async t=>{l.value[t].selectedIds=[],l.value[t].availableIds=[],l.value[t].searchQuery="",await T(t,l.value[t].selectedType)};B(async()=>{var t;await F();for(const o of h.value)await T(o.id,((t=l.value[o.id])==null?void 0:t.selectedType)||"1")});const M=[{label:e("product.mediaTitle"),value:"1"},{label:e("category.mediaTitle"),value:"2"}];return(t,o)=>{const n=U("Toast");return g(),b("div",H,[i("h1",J,w(r(m).params.type==="1"?r(e)("store.mediaTitle"):r(e)("category.mediaTitle")),1),k.value?(g(),b("div",K,[x(r(q),{style:{width:"50px",height:"50px"}})])):h.value.length===0?(g(),b("div",W,w(r(e)("noMediaFound")),1)):(g(),b("div",X,[(g(!0),b(N,null,R(h.value,s=>(g(),A(r(G),{key:s.id,class:"shadow-md hover:shadow-lg transition-shadow duration-300"},{content:O(()=>[i("div",ee,[i("img",{src:s.url,alt:s.name||`${r(m).params.type==="1"?r(e)("store.media"):r(e)("category.media")} ${s.id}`,class:"w-full h-[50px] object-contain rounded-lg"},null,8,ae),i("div",se,[i("a",{href:s.url,target:"_blank",class:"opacity-0 group-hover:opacity-100 bg-blue-500 text-white p-2 rounded-full hover:bg-blue-600 transition","aria-label":r(e)("viewMedia",{name:s.name||"Media "+s.id})},o[0]||(o[0]=[i("i",{class:"pi pi-link text-sm"},null,-1)]),8,te)])]),i("p",le,w(s.name||r(e)("mediaItem")),1),i("div",re,[i("label",oe,w(r(e)("selectType")),1),x(r(Y),{modelValue:l.value[s.id].selectedType,"onUpdate:modelValue":a=>l.value[s.id].selectedType=a,options:M,optionLabel:"label",optionValue:"value",class:"w-full",onChange:a=>D(s.id)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),i("div",ce,[i("label",ie,w(l.value[s.id].selectedType==="1"?r(e)("selectProducts"):r(e)("selectCategories")),1),x(r(Z),{modelValue:l.value[s.id].selectedIds,"onUpdate:modelValue":a=>l.value[s.id].selectedIds=a,options:l.value[s.id].availableIds||[],optionLabel:"label",optionValue:"value",placeholder:l.value[s.id].selectedType==="1"?r(e)("selectProducts"):r(e)("selectCategories"),class:"w-full",maxSelectedLabels:3,filter:"",filterPlaceholder:l.value[s.id].selectedType==="1"?r(e)("searchProducts"):r(e)("searchCategories"),onFilter:a=>V(a,s.id)},null,8,["modelValue","onUpdate:modelValue","options","placeholder","filterPlaceholder","onFilter"])]),x(r(z),{label:r(e)("linkMedia"),class:"mt-4 w-full",severity:"success",onClick:a=>C(s.id)},null,8,["label","onClick"])]),_:2},1024))),128))])),x(n)])}}},pe=P(ne,[["__scopeId","data-v-a850407e"]]);export{pe as default};
