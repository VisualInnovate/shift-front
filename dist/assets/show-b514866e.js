import{l as ye,p as he,a as we,as as $e,u as xe,r as v,c as I,x as Ve,o as ke,d as V,e as c,h as m,i as r,g as a,v as _,t as i,A as w,n as y,F as De,m as Ie,w as Z,b as U}from"./index-fdf8dab7.js";import{l as ee}from"./lodash-59d0be3f.js";const Ce=["dir"],Le={key:0,class:"card-fancy mb-8"},Fe={class:"flex flex-col md:flex-row md:justify-between md:items-center"},Se={class:"text-3xl font-extrabold text-blue-800 flex items-center mb-4 md:mb-0"},Ee={class:"text-blue-600"},Ue={class:"card-fancy mb-8"},qe={class:"text-2xl font-bold mb-6 text-gray-800 border-b pb-3 border-blue-100 flex items-center"},Ne={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},Te={class:"field-group"},Be={class:"input-label"},Pe={key:0,class:"p-error"},Re={class:"field-group"},Ae={class:"input-label"},Me={key:0,class:"p-error"},je={class:"field-group"},ze={class:"input-label"},He={key:0,class:"p-error"},Oe={class:"field-group"},Qe={class:"input-label"},Ge={class:"field-group lg:col-span-2"},Je={class:"input-label"},Ke={class:"flex items-center space-x-4"},We={key:0,class:"p-error"},Xe={class:"card-fancy mb-8"},Ye={class:"text-2xl font-bold mb-6 text-gray-800 border-b pb-3 border-blue-100 flex items-center"},Ze={key:0,class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"},et={key:0,class:"h-40 overflow-hidden"},tt=["src","alt"],at={class:"p-5"},st={class:"flex justify-between items-start mb-4"},lt={class:"flex-1"},ot={class:"font-bold text-lg text-gray-900 truncate"},nt=["dir"],it={class:"text-xs font-medium text-blue-600 bg-blue-50/50 inline-block px-2 py-1 rounded-full"},dt={class:"flex gap-3 justify-end pt-4 border-t border-gray-100"},ut={key:1,class:"text-center text-gray-500 py-12 text-lg italic border-2 border-dashed border-gray-300 rounded-xl m-4"},rt={key:0,class:"p-fluid"},ct={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"},mt={class:"field-group"},pt={class:"input-label"},vt={key:0,class:"p-error"},_t={class:"field-group"},bt={class:"input-label"},gt={key:0,class:"p-error"},ft={class:"field-group"},yt={class:"input-label"},ht={class:"text-xs text-orange-500"},wt={class:"field-group"},$t={class:"input-label"},xt={key:0,class:"p-error"},Vt={class:"field-group lg:col-span-2"},kt={class:"input-label"},Dt={class:"flex items-center space-x-4"},It={class:"text-xs text-gray-500 mt-1"},St={__name:"show",setup(Ct){ye();const R=he(),g=we(),te=$e(),{t:n,locale:ae}=xe(),k=v(null),F=v([]),z=v(!1),A=v(!1),f=v(!1),l=v({custom_tab_id:R.params.id,name_en:"",name_ar:"",type:null,ids:[],image:null}),S=v(!1),s=v(null),q=v([]),H=v(!1),M=v(!1),$=v(!1),D=v({new:"",edit:""}),se=I(()=>ae.value),j=I(()=>se.value==="en"?"name_en":"name_ar"),O=I(()=>j.value),le=I(()=>{var t;return{store:n("custom_tabs.store"),category:n("custom_tabs.category"),market:n("custom_tabs.market")}[(t=k.value)==null?void 0:t.belongs_to]||n("custom_tabs.unknown")}),oe=I(()=>{var t;const e=(t=k.value)==null?void 0:t.model;return e&&(e[j.value]||e.name)||""}),Q=[{label:n("custom_tabs.categories"),value:1},{label:n("custom_tabs.products"),value:2},{label:n("brands"),value:3}],E=e=>e?{1:n("custom_tabs.select_categories"),2:n("custom_tabs.select_products"),3:n("custom_tabs.select_brands")}[e]:n("custom_tabs.select_items"),G=e=>E(e),ne=e=>{const t=String(e);return{1:n("custom_tabs.category"),2:n("custom_tabs.product"),3:n("custom_tabs.brand")}[t]||n("custom_tabs.unknown")},ie=I(()=>l.value.name_en.trim()&&l.value.name_ar.trim()&&l.value.type&&l.value.image),de=I(()=>s.value?s.value.name_en.trim()&&s.value.name_ar.trim()&&s.value.type&&s.value.ids.length>0:!1),ue=(e,t,d)=>{const u=t.filter(b=>d.includes(b.id)&&!e.some(C=>C.id===b.id)),p=[...e,...u],h=new Map;for(const b of p)h.has(b.id)||h.set(b.id,b);return Array.from(h.values())},N=async(e,t,d)=>{var x,B;const u=e?String(e):null;if(!u){d==="new"&&(F.value=[]),d==="edit"&&(q.value=[]);return}const p=d==="new"?F:q,h=d==="new"?z:H,b=d==="new"?l.value.ids:((x=s.value)==null?void 0:x.ids)||[];h.value=!0;const C={1:"/api/category",2:"/api/product",3:"/api/brand"};try{const{data:L}=await U.get(C[u],{params:{search:t||void 0,per_page:50}}),P=((B=L.data)==null?void 0:B.data)||L.data||[];p.value=ue(P,p.value,b)}catch{g.add({severity:"error",summary:n("error"),detail:n("custom_tabs.items_load_failed"),life:3e3})}finally{h.value=!1}},re=ee.debounce(()=>N(l.value.type,D.value.new,"new"),400),ce=ee.debounce(()=>{var e;return N((e=s.value)==null?void 0:e.type,D.value.edit,"edit")},400),J=(e,t)=>{e==="new"?(D.value.new=t.value,re()):e==="edit"&&s.value&&(D.value.edit=t.value,ce())},T=()=>{U.get(`/api/custom-tabs/${R.params.id}`).then(({data:e})=>{if(e.is_success&&e.data)e.data.details=e.data.details.map(t=>({...t,type:Number(t.type),ids:t.ids||[]})),k.value=e.data;else throw new Error(e.message||n("custom_tabs.details_load_failed"))}).catch(e=>{console.error("Error fetching details:",e),g.add({severity:"error",summary:n("error"),detail:n("custom_tabs.details_load_failed"),life:3e3})})};Ve(()=>l.value.type,e=>{l.value.ids=[],F.value=[],D.value.new="",e&&N(e,"","new")});const K=(e,t)=>{const d=t.files[0];d&&(e==="new"?l.value.image=d:e==="edit"&&s.value&&(s.value.newImage=d))},me=async()=>{var t,d;if(f.value=!0,!ie.value){g.add({severity:"warn",summary:n("validation"),detail:n("custom_tabs.fill_all_fields"),life:4e3});return}A.value=!0;const e=new FormData;e.append("custom_tab_id",l.value.custom_tab_id),e.append("name_en",l.value.name_en),e.append("name_ar",l.value.name_ar),e.append("type",l.value.type),e.append("image",l.value.image),l.value.ids.forEach((u,p)=>{e.append(`ids[${p}]`,u)});try{await U.post("/api/custom-tab-details",e,{headers:{"Content-Type":"multipart/form-data"}}),g.add({severity:"success",summary:n("success"),detail:n("custom_tabs.detail_added"),life:3e3}),ge(),await T()}catch(u){console.error(u),g.add({severity:"error",summary:n("error"),detail:((d=(t=u.response)==null?void 0:t.data)==null?void 0:d.message)||n("custom_tabs.add_failed"),life:5e3})}finally{A.value=!1}},pe=e=>{te.require({message:n("custom_tabs.confirm_delete_message"),header:n("custom_tabs.confirm_delete"),icon:"pi pi-exclamation-triangle",acceptClass:"p-button-danger",accept:()=>{ve(e)}})},ve=async e=>{var t,d;try{await U.delete(`/api/custom-tab-details/${e}`),g.add({severity:"success",summary:n("success"),detail:n("custom_tabs.detail_deleted"),life:3e3}),await T()}catch(u){g.add({severity:"error",summary:n("error"),detail:((d=(t=u.response)==null?void 0:t.data)==null?void 0:d.message)||n("custom_tabs.delete_failed"),life:5e3})}},_e=async e=>{s.value={...e,ids:e.ids||[],newImage:null},await N(s.value.type,"","edit"),S.value=!0},be=async()=>{var t,d;if($.value=!0,!de.value){g.add({severity:"warn",summary:n("validation"),detail:n("custom_tabs.fill_all_fields"),life:4e3});return}M.value=!0;const e=new FormData;e.append("_method","PUT"),e.append("name_en",s.value.name_en),e.append("name_ar",s.value.name_ar),e.append("type",s.value.type),e.append("custom_tab_id",l.value.custom_tab_id),s.value.newImage&&e.append("image",s.value.newImage),s.value.ids.forEach((u,p)=>{e.append(`ids[${p}]`,u)});try{await U.post(`/api/custom-tab-details/${s.value.id}`,e,{headers:{"Content-Type":"multipart/form-data"}}),g.add({severity:"success",summary:n("success"),detail:n("custom_tabs.detail_updated"),life:3e3}),S.value=!1,W(),await T()}catch(u){console.error(u),g.add({severity:"error",summary:n("error"),detail:((d=(t=u.response)==null?void 0:t.data)==null?void 0:d.message)||n("custom_tabs.update_failed"),life:5e3})}finally{M.value=!1}},ge=()=>{l.value={custom_tab_id:R.params.id,name_en:"",name_ar:"",type:null,ids:[],image:null},f.value=!1,F.value=[],D.value.new=""},W=()=>{s.value=null,$.value=!1,q.value=[],D.value.edit=""};return ke(()=>{T()}),(e,t)=>{var L,P;const d=V("Toast"),u=V("ConfirmDialog"),p=V("InputText"),h=V("Dropdown"),b=V("MultiSelect"),C=V("FileUpload"),x=V("Button"),B=V("Dialog");return c(),m("div",{class:"min-h-screen bg-gray-50 p-6 lg:p-10",dir:e.$t("dir")},[r(d,{position:"top-right"}),r(u),k.value?(c(),m("div",Le,[a("div",Fe,[a("h1",Se,[t[16]||(t[16]=a("i",{class:"pi pi-table mr-3 text-4xl"},null,-1)),_(" "+i(k.value[j.value]),1)]),a("div",{class:w(["text-lg text-gray-600 space-y-1",{"text-right":e.$t("dir")==="rtl"}])},[a("p",null,[a("strong",Ee,i(le.value)+":",1),_(" "+i(oe.value),1)])],2)])])):y("",!0),a("div",Ue,[a("h2",qe,[t[17]||(t[17]=a("i",{class:"pi pi-plus-circle mr-3 text-blue-500"},null,-1)),_(" "+i(e.$t("custom_tabs.add_new_detail")),1)]),a("div",Ne,[a("div",Te,[a("label",Be,[_(i(e.$t("custom_tabs.name_en"))+" ",1),t[18]||(t[18]=a("span",{class:"text-red-500"},"*",-1))]),r(p,{modelValue:l.value.name_en,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value.name_en=o),placeholder:e.$t("custom_tabs.enter_name_en"),class:w(["w-full",{"p-invalid":f.value&&!l.value.name_en}])},null,8,["modelValue","placeholder","class"]),f.value&&!l.value.name_en?(c(),m("small",Pe,i(e.$t("custom_tabs.name_en_required")),1)):y("",!0)]),a("div",Re,[a("label",Ae,[_(i(e.$t("custom_tabs.name_ar"))+" ",1),t[19]||(t[19]=a("span",{class:"text-red-500"},"*",-1))]),r(p,{modelValue:l.value.name_ar,"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.name_ar=o),placeholder:e.$t("custom_tabs.enter_name_ar"),class:w(["w-full",{"p-invalid":f.value&&!l.value.name_ar}])},null,8,["modelValue","placeholder","class"]),f.value&&!l.value.name_ar?(c(),m("small",Me,i(e.$t("custom_tabs.name_ar_required")),1)):y("",!0)]),a("div",je,[a("label",ze,[_(i(e.$t("custom_tabs.type"))+" ",1),t[20]||(t[20]=a("span",{class:"text-red-500"},"*",-1))]),r(h,{modelValue:l.value.type,"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.type=o),options:Q,optionLabel:"label",optionValue:"value",placeholder:e.$t("custom_tabs.select_type"),class:w(["w-full",{"p-invalid":f.value&&!l.value.type}])},null,8,["modelValue","placeholder","class"]),f.value&&!l.value.type?(c(),m("small",He,i(e.$t("custom_tabs.type_required")),1)):y("",!0)]),a("div",Oe,[a("label",Qe,[_(i(E(l.value.type))+" ",1),t[21]||(t[21]=a("span",{class:"text-red-500"},"*",-1))]),r(b,{modelValue:l.value.ids,"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.ids=o),options:F.value,optionLabel:O.value,optionValue:"id",placeholder:G(l.value.type),filterPlaceholder:e.$t("custom_tabs.search")+" "+E(l.value.type).toLowerCase(),loading:z.value,filter:"",onFilter:t[4]||(t[4]=o=>J("new",o)),class:w(["w-full",{"p-invalid":f.value&&(!l.value.ids||l.value.ids.length===0)}]),disabled:!l.value.type},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder","loading","disabled","class"])]),a("div",Ge,[a("label",Je,[_(i(e.$t("custom_tabs.image"))+" ",1),t[22]||(t[22]=a("span",{class:"text-red-500"},"*",-1))]),a("div",Ke,[r(C,{mode:"basic",accept:"image/*",maxFileSize:2e6,onSelect:t[5]||(t[5]=o=>K("new",o)),onRemove:t[6]||(t[6]=o=>l.value.image=null),chooseLabel:e.$t("custom_tabs.select_image"),class:"p-button-sm p-button-rounded"},null,8,["chooseLabel"])]),f.value&&!l.value.image?(c(),m("small",We,i(e.$t("custom_tabs.image_required")),1)):y("",!0)])]),r(x,{label:e.$t("custom_tabs.add_detail"),icon:"pi pi-plus",class:"mt-8 px-6 py-3 button-primary",onClick:me,loading:A.value},null,8,["label","loading"])]),a("div",Xe,[a("h2",Ye,[t[23]||(t[23]=a("i",{class:"pi pi-list mr-3 text-blue-500"},null,-1)),_(" "+i(e.$t("custom_tabs.details")),1)]),(P=(L=k.value)==null?void 0:L.details)!=null&&P.length?(c(),m("div",Ze,[(c(!0),m(De,null,Ie(k.value.details,o=>{var X,Y;return c(),m("div",{key:o.id,class:"detail-card"},[(X=o.media)!=null&&X.length?(c(),m("div",et,[a("img",{src:o.media[0].url,alt:o.name_en,class:"w-full h-full object-cover transition-transform duration-500 hover:scale-110"},null,8,tt)])):y("",!0),a("div",at,[a("div",st,[a("div",lt,[a("p",ot,i(o.name_en),1),a("p",{class:"text-sm text-gray-600 mb-2",dir:e.$t("dir")==="rtl"?"rtl":"ltr"},i(o.name_ar),9,nt),a("p",it,i(ne(o.type))+" â€¢ "+i(((Y=o.ids)==null?void 0:Y.length)||0)+" items ",1)])]),a("div",dt,[r(x,{icon:"pi pi-pencil",class:"p-button-rounded p-button-sm p-button-info",onClick:fe=>_e(o)},null,8,["onClick"]),r(x,{icon:"pi pi-trash",severity:"danger",class:"p-button-rounded p-button-sm p-button-danger",onClick:fe=>pe(o.id)},null,8,["onClick"])])])])}),128))])):(c(),m("p",ut,[t[24]||(t[24]=a("i",{class:"pi pi-info-circle text-2xl mb-2 block"},null,-1)),_(" "+i(e.$t("custom_tabs.no_details")),1)]))]),r(B,{visible:S.value,"onUpdate:visible":t[15]||(t[15]=o=>S.value=o),header:e.$t("custom_tabs.edit_detail"),modal:!0,class:w(["w-full max-w-5xl",{rtl:e.$t("dir")==="rtl"}]),onHide:W},{footer:Z(()=>[r(x,{label:e.$t("custom_tabs.cancel"),icon:"pi pi-times",class:"p-button-text",onClick:t[14]||(t[14]=o=>S.value=!1)},null,8,["label"]),r(x,{label:e.$t("custom_tabs.save"),icon:"pi pi-check",class:"button-primary",onClick:be,loading:M.value},null,8,["label","loading"])]),default:Z(()=>[s.value?(c(),m("div",rt,[a("div",ct,[a("div",mt,[a("label",pt,[_(i(e.$t("custom_tabs.name_en"))+" ",1),t[25]||(t[25]=a("span",{class:"text-red-500"},"*",-1))]),r(p,{modelValue:s.value.name_en,"onUpdate:modelValue":t[7]||(t[7]=o=>s.value.name_en=o),placeholder:e.$t("custom_tabs.enter_name_en"),class:w(["w-full",{"p-invalid":$.value&&!s.value.name_en}])},null,8,["modelValue","placeholder","class"]),$.value&&!s.value.name_en?(c(),m("small",vt,i(e.$t("custom_tabs.name_en_required")),1)):y("",!0)]),a("div",_t,[a("label",bt,[_(i(e.$t("custom_tabs.name_ar"))+" ",1),t[26]||(t[26]=a("span",{class:"text-red-500"},"*",-1))]),r(p,{modelValue:s.value.name_ar,"onUpdate:modelValue":t[8]||(t[8]=o=>s.value.name_ar=o),placeholder:e.$t("custom_tabs.enter_name_ar"),class:w(["w-full",{"p-invalid":$.value&&!s.value.name_ar}])},null,8,["modelValue","placeholder","class"]),$.value&&!s.value.name_ar?(c(),m("small",gt,i(e.$t("custom_tabs.name_ar_required")),1)):y("",!0)]),a("div",ft,[a("label",yt,i(e.$t("custom_tabs.type")),1),r(h,{modelValue:s.value.type,"onUpdate:modelValue":t[9]||(t[9]=o=>s.value.type=o),options:Q,optionLabel:"label",optionValue:"value",class:"w-full bg-gray-100 cursor-not-allowed",disabled:""},null,8,["modelValue"]),a("small",ht,i(e.$t("custom_tabs.type_cannot_change")),1)]),a("div",wt,[a("label",$t,[_(i(E(s.value.type))+" ",1),t[27]||(t[27]=a("span",{class:"text-red-500"},"*",-1))]),r(b,{modelValue:s.value.ids,"onUpdate:modelValue":t[10]||(t[10]=o=>s.value.ids=o),options:q.value,optionLabel:O.value,optionValue:"id",placeholder:G(s.value.type),filterPlaceholder:e.$t("custom_tabs.search")+" "+E(s.value.type).toLowerCase(),loading:H.value,filter:"",onFilter:t[11]||(t[11]=o=>J("edit",o)),class:w(["w-full",{"p-invalid":$.value&&(!s.value.ids||s.value.ids.length===0)}])},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder","loading","class"]),$.value&&(!s.value.ids||s.value.ids.length===0)?(c(),m("small",xt,i(e.$t("custom_tabs.items_required")),1)):y("",!0)]),a("div",Vt,[a("label",kt,i(e.$t("custom_tabs.image"))+" ("+i(e.$t("custom_tabs.optional_reupload"))+") ",1),a("div",Dt,[r(C,{mode:"basic",accept:"image/*",maxFileSize:2e6,onSelect:t[12]||(t[12]=o=>K("edit",o)),onRemove:t[13]||(t[13]=o=>s.value.newImage=null),chooseLabel:s.value.newImage?e.$t("custom_tabs.change_image"):e.$t("custom_tabs.select_new_image"),class:"p-button-sm p-button-rounded p-button-secondary"},null,8,["chooseLabel"])]),a("small",It,i(e.$t("custom_tabs.leave_empty_to_keep")),1)])])])):y("",!0)]),_:1},8,["visible","header","class"])],8,Ce)}}};export{St as default};
