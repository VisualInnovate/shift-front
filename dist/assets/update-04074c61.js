import{_ as H,s as v,u as J,p as K,q as Q,a as W,r as f,B,o as X,ab as ee,D as te,c,d as p,f as u,t as n,h as i,g as V,e as _,x as k,m as x,I as ae,j as D,Y as M,am as se,ao as le,Z as S,z as ie}from"./index-df21bae4.js";import{h as oe}from"./moment-fbc5633a.js";const re=["dir"],ue={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ne={class:"space-y-2"},de={class:"block text-sm font-medium text-gray-700"},ce={key:0,class:"p-error"},pe={key:0,class:"space-y-2"},ve={class:"block text-sm font-medium text-gray-700"},_e={key:0,class:"p-error"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={class:"space-y-2"},fe={class:"block text-sm font-medium text-gray-700"},he={key:0},ge={key:1},xe={key:0,class:"p-error"},be={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},Ve={key:0,class:"p-error"},ke={class:"pt-6 flex justify-center gap-6"},De={__name:"update",setup($e){const I=v(()=>localStorage.getItem("appLang")||"en"),$=v(()=>I.value==="en"?"name_en":"name_ar"),U=v(()=>I.value==="ar"),F=J(),L=K(),m=Q(),{t:l}=W(),b=v(()=>!!L.params.id),y=f(!1),r=f({}),s=f({type:"product",product_id:null,variant_id:null,discount_type:1,discount_value:null,expires_at:null}),q=f([]),w=f(""),T=f(!1),h=v(()=>q.value.find(t=>t.id===s.value.product_id)),j=v(()=>{var t;return((t=h.value)==null?void 0:t.variants)||[]});B(j,t=>{t.length>0&&!s.value.variant_id?s.value.variant_id=t[0].id:t.length===0&&(s.value.variant_id=null)});const C=v(()=>h.value&&h.value.has_variants===!0),z=t=>{const e=t[$.value],o=t.base_price?t.base_price:"N/A";return`${e} - ${o}`},A=t=>{const e=t.price?t.price:"N/A";return`${t.sku} - ${e}`};B(()=>s.value.product_id,()=>{s.value.variant_id=null});const g=async()=>{T.value=!0;try{const{data:t}=await D.get("/api/discount/create/data",{params:{search:w.value||void 0,per_page:100}});q.value=t.data.data??[]}catch(t){console.error(t),m.add({severity:"error",summary:l("error"),detail:l("error.productLoad"),life:3e3})}finally{T.value=!1}};let E;const N=t=>{console.log("Product filter event:",t),w.value=t.value??"",clearTimeout(E),E=setTimeout(g,300)},O=async()=>{var t,e;y.value=!0;try{const{data:o}=await D.get(`/api/discount/${L.params.id}`),a=o.data;if(s.value={type:a.type,product_id:null,variant_id:null,discount_type:a.discount_type,discount_value:parseFloat(a.discount_value),expires_at:a.expires_at?new Date(a.expires_at):null},a.type==="product"&&a.products.length>0)s.value.product_id=a.products[0].id;else if(a.type==="variant"&&a.variants.length>0){const d=a.variants[0];s.value.product_id=d.product_id,s.value.variant_id=d.id}await g(),console.log(a.type),a.type==="product"&&a.products.length>0?(w.value=a.products[0][$.value],await g()):a.type==="variant"&&a.variants.length>0&&(w.value=a.variants[0].product[$.value],await g())}catch(o){console.error("Error loading discount:",o),m.add({severity:"error",summary:l("error"),detail:((e=(t=o.response)==null?void 0:t.data)==null?void 0:e.message)||l("error.loadError"),life:3e3}),F.push({name:"discount"})}finally{y.value=!1}};class Z{constructor(e,o){this.errors=e,this.t=o}required(e,o){return e==null?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):!0}numericRange(e,o,a,d=null){return e===null||isNaN(e)?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):a!==null&&e<a?(this.errors.value[o]=this.t("validation.minValue",{field:this.t(`discount.${o}`),min:a}),!1):d!==null&&e>d?(this.errors.value[o]=this.t("validation.maxValue",{field:this.t(`discount.${o}`),max:d}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const G=async()=>{var R,Y;r.value={};const t=new Z(r,l);if(t.required(s.value.product_id,"select_product"),t.required(s.value.discount_type,"discount_method"),h.value&&h.value.has_variants&&t.required(s.value.variant_id,"select_variant"),t.numericRange(s.value.discount_value,"discount_value",0),t.required(s.value.expires_at,"expiration_date"),!t.isValid()){const P=Object.values(r.value).join(", ");m.add({severity:"error",summary:l("error"),detail:P,life:3e3});return}y.value=!0;const e=s.value.variant_id!==null,o=e?"variant":"product",a=e?s.value.variant_id:s.value.product_id,d={type:o,ids:[a],discount_type:s.value.discount_type,discount_value:s.value.discount_value,expires_at:oe(s.value.expires_at).format("YYYY-MM-DD")};try{b.value?(await D.put(`/api/discount/${L.params.id}`,d),m.add({severity:"success",summary:l("success"),detail:l("discount.updated_successfully"),life:3e3})):(await D.post("/api/discount",d),m.add({severity:"success",summary:l("success"),detail:l("discount.created_successfully"),life:3e3})),F.push({name:"discount"})}catch(P){m.add({severity:"error",summary:l("error"),detail:((Y=(R=P.response)==null?void 0:R.data)==null?void 0:Y.message)||l("error.saveError"),life:3e3})}finally{y.value=!1}};return X(async()=>{await g(),b.value&&await O()}),(t,e)=>{const o=ee("can");return te((c(),p("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:U.value?"rtl":"ltr"},[u("h1",ue,n(b.value?i(l)("discount.edit_discount"):i(l)("discount.create_new_discount")),1),u("form",{onSubmit:ae(G,["prevent"]),class:"space-y-8"},[u("div",ne,[u("label",de,[V(n(i(l)("discount.select_product"))+" ",1),e[5]||(e[5]=u("span",{class:"text-red-500"},"*",-1))]),_(i(M),{modelValue:s.value.product_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.product_id=a),options:q.value,optionLabel:z,optionValue:"id",filter:"",filterPlaceholder:i(l)("discount.searchProducts"),placeholder:i(l)("discount.select_product"),loading:T.value,class:k(["w-full",{"p-invalid":r.value.select_product}]),onFilter:N},null,8,["modelValue","options","filterPlaceholder","placeholder","loading","class"]),r.value.select_product?(c(),p("small",ce,n(r.value.select_product),1)):x("",!0)]),C.value?(c(),p("div",pe,[u("label",ve,[V(n(i(l)("discount.select_variant"))+" ",1),e[6]||(e[6]=u("span",{class:"text-red-500"},"*",-1))]),_(i(M),{modelValue:s.value.variant_id,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.variant_id=a),options:j.value,optionLabel:A,optionValue:"id",placeholder:i(l)("discount.select_variant"),class:k(["w-full",{"p-invalid":r.value.select_variant}])},null,8,["modelValue","options","placeholder","class"]),r.value.select_variant?(c(),p("small",_e,n(r.value.select_variant),1)):x("",!0)])):x("",!0),u("div",me,[u("div",ye,[u("label",fe,[V(n(i(l)("discount.discount_value"))+" ",1),s.value.discount_type===1?(c(),p("span",he,"("+n(i(l)("discount.fixed_amount"))+")",1)):(c(),p("span",ge,"(%)")),e[7]||(e[7]=u("span",{class:"text-red-500"},"*",-1))]),_(i(se),{modelValue:s.value.discount_value,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.discount_value=a),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:0,max:s.value.discount_type===2?100:null,placeholder:i(l)("discount.enter_discount_value"),class:k(["w-full",{"p-invalid":r.value.discount_value}])},null,8,["modelValue","max","placeholder","class"]),r.value.discount_value?(c(),p("small",xe,n(r.value.discount_value),1)):x("",!0)]),u("div",be,[u("label",we,[V(n(i(l)("discount.expiration_date"))+" ",1),e[8]||(e[8]=u("span",{class:"text-red-500"},"*",-1))]),_(i(le),{modelValue:s.value.expires_at,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.expires_at=a),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:i(l)("discount.select_expiration_date"),class:k(["w-full",{"p-invalid":r.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),r.value.expiration_date?(c(),p("small",Ve,n(r.value.expiration_date),1)):x("",!0)])]),u("div",ke,[_(i(S),{type:"button",label:i(l)("discount.cancel"),icon:"pi pi-times",onClick:e[4]||(e[4]=a=>i(F).go(-1)),severity:"secondary",disabled:y.value},null,8,["label","disabled"]),_(i(S),{type:"submit",label:b.value?i(l)("discount.update_discount"):i(l)("discount.create_discount"),icon:"pi pi-check",loading:y.value},null,8,["label","loading"])])],32),_(i(ie))],8,re)),[[o,"create discounts"]])}}},qe=H(De,[["__scopeId","data-v-ee0a8c57"]]);export{qe as default};
