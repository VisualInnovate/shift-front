import{_ as z,c as w,l as G,p as N,a as W,u as H,r as c,x as j,o as J,d as K,a1 as X,B as Z,e as p,h as v,g as i,t as n,j as a,v as h,i as _,A as g,n as f,G as ee,b as x,V as $,al as te,W as q,k as se}from"./index-8ae77a16.js";import{h as ae}from"./moment-fbc5633a.js";import{l as C}from"./lodash-74f7b448.js";const oe=["dir"],le={class:"text-3xl font-bold text-center mb-8 text-gray-800"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"space-y-2 hidden"},ue={class:"block text-sm font-medium text-gray-700"},de={key:0,class:"p-error"},ne={class:"space-y-2 hidden"},ce={class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"p-error"},ve={key:0,class:"space-y-2"},_e={class:"block text-sm font-medium text-gray-700"},ye={key:0,class:"p-error"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-2"},he={class:"block text-sm font-medium text-gray-700"},ge={key:0},xe={key:1},be={key:0,class:"p-error"},Ve={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"p-error"},De={class:"pt-4 flex justify-center space-x-4"},Le={__name:"update",setup($e){const E=w(()=>localStorage.getItem("appLang")||"en"),R=w(()=>E.value==="en"?"name_en":"name_ar"),S=w(()=>E.value==="ar"),k=G(),D=N(),y=W(),{t}=H(),m=c(!1),r=c({}),b=w(()=>!!D.params.id),s=c({type:"category",ids:[],products:[],discount_type:1,discount_value:null,expires_at:null}),U=c([]),V=c([]),B=c(""),F=c(""),T=c(!1),I=c(!1);class M{constructor(e,o){this.errors=e,this.t=o}required(e,o){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):!0}numericRange(e,o,d,u){return e==null||isNaN(e)?(this.errors.value[o]=this.t("validation.requiredFields",{field:this.t(`discount.${o}`)}),!1):d!==null&&e<d?(this.errors.value[o]=this.t("validation.minValue",{field:this.t(`discount.${o}`),min:d}),!1):u!==null&&e>u?(this.errors.value[o]=this.t("validation.maxValue",{field:this.t(`discount.${o}`),max:u}),!1):!0}validDate(e,o){return!e||!(e instanceof Date)||isNaN(e.getTime())?(this.errors.value[o]=this.t("validation.invalidDate",{field:this.t(`discount.${o}`)}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const P=async()=>{var l;T.value=!0;try{const{data:e}=await x.get("/api/category",{params:{search:B.value||void 0}});U.value=((l=e.data)==null?void 0:l.data)||[]}catch(e){console.error("Error fetching categories:",e),y.add({severity:"error",summary:t("error"),detail:t("error.categoryLoad"),life:3e3})}finally{T.value=!1}};C.debounce(P,300);const L=async()=>{var l;try{const{data:e}=await x.get("/api/product",{params:{search:F.value||void 0,category_ids:s.value.ids.join(",")}});V.value=((l=e.data)==null?void 0:l.data)||[]}catch(e){console.error("Error fetching products:",e),y.add({severity:"error",summary:t("error"),detail:t("error.productLoad"),life:3e3})}finally{I.value=!1}},Y=C.debounce(L,300),A=l=>{F.value=l.value,Y()},O=async()=>{var l,e;m.value=!0;try{const{data:o}=await x.get(`/api/discount/${D.params.id}`),d=o.data;s.value={type:d.type,ids:d.type==="category"?d.ids:[],products:d.products,discount_type:d.discount_type,discount_value:d.discount_value,expires_at:d.expires_at?new Date(d.expires_at):null},L()}catch(o){console.error("Error loading discount:",o),y.add({severity:"error",summary:t("error"),detail:((e=(l=o.response)==null?void 0:l.data)==null?void 0:e.message)||t("error.loadError"),life:3e3}),k.push({name:"discount"})}finally{m.value=!1}};j(()=>s.value.type,l=>{s.value.ids=[],s.value.products=[],V.value=[],r.value={}}),j(()=>s.value.ids,l=>{s.value.type==="product"&&(s.value.products=[],l.length>0?L():V.value=[])},{deep:!0});const Q=async()=>{var o,d;r.value={};const l=new M(r,t);if(l.required(s.value.type,"type"),l.required(s.value.discount_type,"discount_type"),l.numericRange(s.value.discount_value,"discount_value",0,s.value.discount_type===2?100:null),l.validDate(s.value.expires_at,"expiration_date"),!l.isValid()){const u=Object.values(r.value)[0];y.add({severity:"error",summary:t("error"),detail:u,life:3e3});return}m.value=!0;const e={type:s.value.type,ids:s.value.type==="product"?s.value.products:s.value.ids,discount_type:s.value.discount_type,discount_value:s.value.discount_value,expires_at:ae(s.value.expires_at).format("YYYY-MM-DD")};try{b.value?(await x.put(`/api/discount/${D.params.id}`,e),y.add({severity:"success",summary:t("success"),detail:t("discount.updated_successfully"),life:3e3})):(await x.post("/api/discount",e),y.add({severity:"success",summary:t("success"),detail:t("discount.created_successfully"),life:3e3})),k.push({name:"discount"})}catch(u){y.add({severity:"error",summary:t("error"),detail:((d=(o=u.response)==null?void 0:o.data)==null?void 0:d.message)||t("error.saveError"),life:3e3})}finally{m.value=!1}};return J(()=>{P(),b.value&&O()}),(l,e)=>{const o=K("InputText"),d=X("can");return Z((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:S.value?"rtl":"ltr"},[i("h1",le,n(b.value?a(t)("discount.edit_discount"):a(t)("discount.create_new_discount")),1),i("form",{onSubmit:ee(Q,["prevent"]),class:"space-y-6"},[i("div",re,[i("div",ie,[i("label",ue,[h(n(a(t)("discount.discount_type"))+" ",1),e[6]||(e[6]=i("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:s.value.type,"onUpdate:modelValue":e[0]||(e[0]=u=>s.value.type=u),options:[{label:a(t)("discount.category"),value:"category"},{label:a(t)("discount.product"),value:"product"}],optionLabel:"label",optionValue:"value",placeholder:a(t)("discount.select_type"),class:g(["w-full",{"p-invalid":r.value.type}])},null,8,["modelValue","options","placeholder","class"]),r.value.type?(p(),v("small",de,n(r.value.type),1)):f("",!0)]),i("div",ne,[i("label",ce,[h(n(a(t)("discount.discount_method"))+" ",1),e[7]||(e[7]=i("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:s.value.discount_type,"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.discount_type=u),options:[{label:a(t)("discount.fixed_amount"),value:1},{label:a(t)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:a(t)("discount.select_method"),class:g(["w-full",{"p-invalid":r.value.discount_type}])},null,8,["modelValue","options","placeholder","class"]),r.value.discount_type?(p(),v("small",pe,n(r.value.discount_type),1)):f("",!0)])]),s.value.type==="product"?(p(),v("div",ve,[i("label",_e,[h(n(a(t)("discount.select_product"))+" ",1),e[8]||(e[8]=i("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:s.value.products[0],"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.products[0]=u),options:V.value,optionLabel:R.value,optionValue:"id",filter:"",filterPlaceholder:a(t)("discount.searchProducts"),placeholder:a(t)("discount.select_products"),loading:I.value,class:g(["w-full",{"p-invalid":r.value.select_product}]),onFilter:A},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),r.value.select_product?(p(),v("small",ye,n(r.value.select_product),1)):f("",!0)])):f("",!0),i("div",me,[i("div",fe,[i("label",he,[h(n(a(t)("discount.discount_value"))+" ",1),s.value.discount_type===1?(p(),v("span",ge,"("+n(a(t)("discount.fixed_amount"))+")",1)):(p(),v("span",xe,"(%)")),e[9]||(e[9]=i("span",{class:"text-red-500"},"*",-1))]),_(o,{type:"number",modelValue:s.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=u=>s.value.discount_value=u),placeholder:a(t)("discount.enter_discount_value"),class:g(["w-full",{"p-invalid":r.value.discount_value}])},null,8,["modelValue","placeholder","class"]),r.value.discount_value?(p(),v("small",be,n(r.value.discount_value),1)):f("",!0)]),i("div",Ve,[i("label",we,[h(n(a(t)("discount.expiration_date"))+" ",1),e[10]||(e[10]=i("span",{class:"text-red-500"},"*",-1))]),_(a(te),{modelValue:s.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=u=>s.value.expires_at=u),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:a(t)("discount.select_expiration_date"),class:g(["w-full",{"p-invalid":r.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),r.value.expiration_date?(p(),v("small",ke,n(r.value.expiration_date),1)):f("",!0)])]),i("div",De,[_(a(q),{type:"button",label:a(t)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=u=>a(k).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 mx-2 text-gray-700 rounded-lg shadow-md",disabled:m.value},null,8,["label","disabled"]),_(a(q),{type:"submit",label:b.value?a(t)("discount.update_discount"):a(t)("discount.create_discount"),icon:"pi pi-check",loading:m.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),_(a(se))],8,oe)),[[d,"create discounts"]])}}},Ie=z(Le,[["__scopeId","data-v-182115ed"]]);export{Ie as default};
