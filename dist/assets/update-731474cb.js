import{_ as z,c as w,l as G,p as N,a as W,u as H,r as c,x as P,o as J,d as K,a1 as X,B as Z,e as p,h as v,g as u,t as n,j as a,v as h,i as _,A as g,n as f,G as ee,b as x,V as $,al as te,W as j,k as se}from"./index-4d1925b8.js";import{h as ae}from"./moment-fbc5633a.js";import{l as C}from"./lodash-2d3b96c3.js";const oe=["dir"],le={class:"text-3xl font-bold text-center mb-8 text-gray-800"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ue={class:"space-y-2 hidden"},ie={class:"block text-sm font-medium text-gray-700"},de={key:0,class:"p-error"},ne={class:"space-y-2 hidden"},ce={class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"p-error"},ve={key:0,class:"space-y-2"},_e={class:"block text-sm font-medium text-gray-700"},ye={key:0,class:"p-error"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-2"},he={class:"block text-sm font-medium text-gray-700"},ge={key:0},xe={key:1},be={key:0,class:"p-error"},Ve={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"p-error"},De={class:"pt-4 flex justify-center space-x-4"},Le={__name:"update",setup($e){const E=w(()=>localStorage.getItem("appLang")||"en"),R=w(()=>E.value==="en"?"name_en":"name_ar"),S=w(()=>E.value==="ar"),k=G(),D=N(),y=W(),{t:s}=H(),m=c(!1),r=c({}),b=w(()=>!!D.params.id),t=c({type:"category",ids:[],products:[],discount_type:1,discount_value:null,expires_at:null}),U=c([]),V=c([]),B=c(""),q=c(""),F=c(!1),T=c(!1);class M{constructor(e,l){this.errors=e,this.t=l}required(e,l){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[l]=this.t("validation.requiredFields",{field:this.t(`discount.${l}`)}),!1):!0}numericRange(e,l,d,i){return e==null||isNaN(e)?(this.errors.value[l]=this.t("validation.requiredFields",{field:this.t(`discount.${l}`)}),!1):d!==null&&e<d?(this.errors.value[l]=this.t("validation.minValue",{field:this.t(`discount.${l}`),min:d}),!1):i!==null&&e>i?(this.errors.value[l]=this.t("validation.maxValue",{field:this.t(`discount.${l}`),max:i}),!1):!0}validDate(e,l){return!e||!(e instanceof Date)||isNaN(e.getTime())?(this.errors.value[l]=this.t("validation.invalidDate",{field:this.t(`discount.${l}`)}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const I=async()=>{var o;F.value=!0;try{const{data:e}=await x.get("/api/category",{params:{search:B.value||void 0}});U.value=((o=e.data)==null?void 0:o.data)||[]}catch(e){console.error("Error fetching categories:",e),y.add({severity:"error",summary:s("error"),detail:s("error.categoryLoad"),life:3e3})}finally{F.value=!1}};C.debounce(I,300);const L=async()=>{var o;try{const{data:e}=await x.get("/api/product",{params:{search:q.value||void 0,category_ids:t.value.ids.join(",")}});V.value=((o=e.data)==null?void 0:o.data)||[]}catch(e){console.error("Error fetching products:",e),y.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}finally{T.value=!1}},Y=C.debounce(L,300),A=o=>{q.value=o.value,Y()},O=async()=>{var o,e;m.value=!0;try{const{data:l}=await x.get(`/api/discount/${D.params.id}`),d=l.data;t.value={type:d.type,ids:d.type==="category"?d.ids:[],products:d.products,discount_type:d.discount_type,discount_value:d.discount_value,expires_at:d.expires_at?new Date(d.expires_at):null},L()}catch(l){console.error("Error loading discount:",l),y.add({severity:"error",summary:s("error"),detail:((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||s("error.loadError"),life:3e3}),k.push({name:"discount"})}finally{m.value=!1}};P(()=>t.value.type,o=>{t.value.ids=[],t.value.products=[],V.value=[],r.value={}}),P(()=>t.value.ids,o=>{t.value.type==="product"&&(t.value.products=[],o.length>0?L():V.value=[])},{deep:!0});const Q=async()=>{var l,d;r.value={};const o=new M(r,s);if(o.required(t.value.type,"type"),t.value.type==="category"?o.required(t.value.ids,"select_category"):t.value.type==="product"&&(o.required(t.value.ids,"select_category"),o.required(t.value.products,"select_product")),o.required(t.value.discount_type,"discount_type"),o.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),o.validDate(t.value.expires_at,"expiration_date"),!o.isValid()){const i=Object.values(r.value)[0];y.add({severity:"error",summary:s("error"),detail:i,life:3e3});return}m.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:ae(t.value.expires_at).format("YYYY-MM-DD")};try{b.value?(await x.put(`/api/discount/${D.params.id}`,e),y.add({severity:"success",summary:s("success"),detail:s("discount.updated_successfully"),life:3e3})):(await x.post("/api/discount",e),y.add({severity:"success",summary:s("success"),detail:s("discount.created_successfully"),life:3e3})),k.push({name:"discount"})}catch(i){y.add({severity:"error",summary:s("error"),detail:((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.message)||s("error.saveError"),life:3e3})}finally{m.value=!1}};return J(()=>{I(),b.value&&O()}),(o,e)=>{const l=K("InputText"),d=X("can");return Z((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:S.value?"rtl":"ltr"},[u("h1",le,n(b.value?a(s)("discount.edit_discount"):a(s)("discount.create_new_discount")),1),u("form",{onSubmit:ee(Q,["prevent"]),class:"space-y-6"},[u("div",re,[u("div",ue,[u("label",ie,[h(n(a(s)("discount.discount_type"))+" ",1),e[6]||(e[6]=u("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=i=>t.value.type=i),options:[{label:a(s)("discount.category"),value:"category"},{label:a(s)("discount.product"),value:"product"}],optionLabel:"label",optionValue:"value",placeholder:a(s)("discount.select_type"),class:g(["w-full",{"p-invalid":r.value.type}])},null,8,["modelValue","options","placeholder","class"]),r.value.type?(p(),v("small",de,n(r.value.type),1)):f("",!0)]),u("div",ne,[u("label",ce,[h(n(a(s)("discount.discount_method"))+" ",1),e[7]||(e[7]=u("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:t.value.discount_type,"onUpdate:modelValue":e[1]||(e[1]=i=>t.value.discount_type=i),options:[{label:a(s)("discount.fixed_amount"),value:1},{label:a(s)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:a(s)("discount.select_method"),class:g(["w-full",{"p-invalid":r.value.discount_type}])},null,8,["modelValue","options","placeholder","class"]),r.value.discount_type?(p(),v("small",pe,n(r.value.discount_type),1)):f("",!0)])]),t.value.type==="product"?(p(),v("div",ve,[u("label",_e,[h(n(a(s)("discount.select_product"))+" ",1),e[8]||(e[8]=u("span",{class:"text-red-500"},"*",-1))]),_(a($),{modelValue:t.value.products[0],"onUpdate:modelValue":e[2]||(e[2]=i=>t.value.products[0]=i),options:V.value,optionLabel:R.value,optionValue:"id",filter:"",filterPlaceholder:a(s)("discount.searchProducts"),placeholder:a(s)("discount.select_products"),loading:T.value,class:g(["w-full",{"p-invalid":r.value.select_product}]),onFilter:A},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),r.value.select_product?(p(),v("small",ye,n(r.value.select_product),1)):f("",!0)])):f("",!0),u("div",me,[u("div",fe,[u("label",he,[h(n(a(s)("discount.discount_value"))+" ",1),t.value.discount_type===1?(p(),v("span",ge,"("+n(a(s)("discount.fixed_amount"))+")",1)):(p(),v("span",xe,"(%)")),e[9]||(e[9]=u("span",{class:"text-red-500"},"*",-1))]),_(l,{type:"number",modelValue:t.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=i=>t.value.discount_value=i),placeholder:a(s)("discount.enter_discount_value"),class:g(["w-full",{"p-invalid":r.value.discount_value}])},null,8,["modelValue","placeholder","class"]),r.value.discount_value?(p(),v("small",be,n(r.value.discount_value),1)):f("",!0)]),u("div",Ve,[u("label",we,[h(n(a(s)("discount.expiration_date"))+" ",1),e[10]||(e[10]=u("span",{class:"text-red-500"},"*",-1))]),_(a(te),{modelValue:t.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=i=>t.value.expires_at=i),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:a(s)("discount.select_expiration_date"),class:g(["w-full",{"p-invalid":r.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),r.value.expiration_date?(p(),v("small",ke,n(r.value.expiration_date),1)):f("",!0)])]),u("div",De,[_(a(j),{type:"button",label:a(s)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=i=>a(k).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 mx-2 text-gray-700 rounded-lg shadow-md",disabled:m.value},null,8,["label","disabled"]),_(a(j),{type:"submit",label:b.value?a(s)("discount.update_discount"):a(s)("discount.create_discount"),icon:"pi pi-check",loading:m.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),_(a(se))],8,oe)),[[d,"create discounts"]])}}},Te=z(Le,[["__scopeId","data-v-2742f8e8"]]);export{Te as default};
