import{_ as z,l as w,u as G,k as N,G as H,j as J,r as c,q as I,o as K,n as W,a0 as X,y as Z,a as p,c as v,f as i,t as n,e as a,p as h,h as y,x as g,g as f,C as ee,i as x,U as $,ai as te,V as P,Q as se}from"./index-eeb36ec5.js";import{h as ae}from"./moment-fbc5633a.js";import{l as U}from"./lodash-abf3da4d.js";const oe=["dir"],le={class:"text-3xl font-bold text-center mb-8 text-gray-800"},re={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ie={class:"space-y-2 hidden"},ue={class:"block text-sm font-medium text-gray-700"},de={key:0,class:"p-error"},ne={class:"space-y-2 hidden"},ce={class:"block text-sm font-medium text-gray-700"},pe={key:0,class:"p-error"},ve={key:0,class:"space-y-2"},ye={class:"block text-sm font-medium text-gray-700"},_e={key:0,class:"p-error"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},fe={class:"space-y-2"},he={class:"block text-sm font-medium text-gray-700"},ge={key:0},xe={key:1},be={key:0,class:"p-error"},Ve={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},ke={key:0,class:"p-error"},De={class:"pt-4 flex justify-center space-x-4"},Le={__name:"update",setup($e){const q=w(()=>localStorage.getItem("appLang")||"en"),j=w(()=>q.value==="en"?"name_en":"name_ar"),R=w(()=>q.value==="ar"),k=G(),D=N(),_=H(),{t:s}=J(),m=c(!1),r=c({}),b=w(()=>!!D.params.id),t=c({type:"category",ids:[],products:[],discount_type:1,discount_value:null,expires_at:null}),S=c([]),V=c([]),M=c(""),E=c(""),F=c(!1),T=c(!1);class Y{constructor(e,l){this.errors=e,this.t=l}required(e,l){return!e||Array.isArray(e)&&e.length===0?(this.errors.value[l]=this.t("validation.requiredFields",{field:this.t(`discount.${l}`)}),!1):!0}numericRange(e,l,d,u){return e==null||isNaN(e)?(this.errors.value[l]=this.t("validation.requiredFields",{field:this.t(`discount.${l}`)}),!1):d!==null&&e<d?(this.errors.value[l]=this.t("validation.minValue",{field:this.t(`discount.${l}`),min:d}),!1):u!==null&&e>u?(this.errors.value[l]=this.t("validation.maxValue",{field:this.t(`discount.${l}`),max:u}),!1):!0}validDate(e,l){return!e||!(e instanceof Date)||isNaN(e.getTime())?(this.errors.value[l]=this.t("validation.invalidDate",{field:this.t(`discount.${l}`)}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const C=async()=>{var o;F.value=!0;try{const{data:e}=await x.get("/api/category",{params:{search:M.value||void 0}});S.value=((o=e.data)==null?void 0:o.data)||[]}catch(e){console.error("Error fetching categories:",e),_.add({severity:"error",summary:s("error"),detail:s("error.categoryLoad"),life:3e3})}finally{F.value=!1}};U.debounce(C,300);const L=async()=>{var o;try{const{data:e}=await x.get("/api/product",{params:{search:E.value||void 0,category_ids:t.value.ids.join(",")}});V.value=((o=e.data)==null?void 0:o.data)||[]}catch(e){console.error("Error fetching products:",e),_.add({severity:"error",summary:s("error"),detail:s("error.productLoad"),life:3e3})}finally{T.value=!1}},B=U.debounce(L,300),Q=o=>{E.value=o.value,B()},A=async()=>{var o,e;m.value=!0;try{const{data:l}=await x.get(`/api/discount/${D.params.id}`),d=l.data;t.value={type:d.type,ids:d.type==="category"?d.ids:[],products:d.products,discount_type:d.discount_type,discount_value:d.discount_value,expires_at:d.expires_at?new Date(d.expires_at):null},L()}catch(l){console.error("Error loading discount:",l),_.add({severity:"error",summary:s("error"),detail:((e=(o=l.response)==null?void 0:o.data)==null?void 0:e.message)||s("error.loadError"),life:3e3}),k.push({name:"discount"})}finally{m.value=!1}};I(()=>t.value.type,o=>{t.value.ids=[],t.value.products=[],V.value=[],r.value={}}),I(()=>t.value.ids,o=>{t.value.type==="product"&&(t.value.products=[],o.length>0?L():V.value=[])},{deep:!0});const O=async()=>{var l,d;r.value={};const o=new Y(r,s);if(o.required(t.value.type,"type"),t.value.type==="category"?o.required(t.value.ids,"select_category"):t.value.type==="product"&&(o.required(t.value.ids,"select_category"),o.required(t.value.products,"select_product")),o.required(t.value.discount_type,"discount_type"),o.numericRange(t.value.discount_value,"discount_value",0,t.value.discount_type===2?100:null),o.validDate(t.value.expires_at,"expiration_date"),!o.isValid()){const u=Object.values(r.value)[0];_.add({severity:"error",summary:s("error"),detail:u,life:3e3});return}m.value=!0;const e={type:t.value.type,ids:t.value.type==="product"?t.value.products:t.value.ids,discount_type:t.value.discount_type,discount_value:t.value.discount_value,expires_at:ae(t.value.expires_at).format("YYYY-MM-DD")};try{b.value?(await x.put(`/api/discount/${D.params.id}`,e),_.add({severity:"success",summary:s("success"),detail:s("discount.updated_successfully"),life:3e3})):(await x.post("/api/discount",e),_.add({severity:"success",summary:s("success"),detail:s("discount.created_successfully"),life:3e3})),k.push({name:"discount"})}catch(u){_.add({severity:"error",summary:s("error"),detail:((d=(l=u.response)==null?void 0:l.data)==null?void 0:d.message)||s("error.saveError"),life:3e3})}finally{m.value=!1}};return K(()=>{C(),b.value&&A()}),(o,e)=>{const l=W("InputText"),d=X("can");return Z((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:R.value?"rtl":"ltr"},[i("h1",le,n(b.value?a(s)("discount.edit_discount"):a(s)("discount.create_new_discount")),1),i("form",{onSubmit:ee(O,["prevent"]),class:"space-y-6"},[i("div",re,[i("div",ie,[i("label",ue,[h(n(a(s)("discount.discount_type"))+" ",1),e[6]||(e[6]=i("span",{class:"text-red-500"},"*",-1))]),y(a($),{modelValue:t.value.type,"onUpdate:modelValue":e[0]||(e[0]=u=>t.value.type=u),options:[{label:a(s)("discount.category"),value:"category"},{label:a(s)("discount.product"),value:"product"}],optionLabel:"label",optionValue:"value",placeholder:a(s)("discount.select_type"),class:g(["w-full",{"p-invalid":r.value.type}])},null,8,["modelValue","options","placeholder","class"]),r.value.type?(p(),v("small",de,n(r.value.type),1)):f("",!0)]),i("div",ne,[i("label",ce,[h(n(a(s)("discount.discount_method"))+" ",1),e[7]||(e[7]=i("span",{class:"text-red-500"},"*",-1))]),y(a($),{modelValue:t.value.discount_type,"onUpdate:modelValue":e[1]||(e[1]=u=>t.value.discount_type=u),options:[{label:a(s)("discount.fixed_amount"),value:1},{label:a(s)("discount.percentage"),value:2}],optionLabel:"label",optionValue:"value",placeholder:a(s)("discount.select_method"),class:g(["w-full",{"p-invalid":r.value.discount_type}])},null,8,["modelValue","options","placeholder","class"]),r.value.discount_type?(p(),v("small",pe,n(r.value.discount_type),1)):f("",!0)])]),t.value.type==="product"?(p(),v("div",ve,[i("label",ye,[h(n(a(s)("discount.select_product"))+" ",1),e[8]||(e[8]=i("span",{class:"text-red-500"},"*",-1))]),y(a($),{modelValue:t.value.products[0],"onUpdate:modelValue":e[2]||(e[2]=u=>t.value.products[0]=u),options:V.value,optionLabel:j.value,optionValue:"id",filter:"",filterPlaceholder:a(s)("discount.searchProducts"),placeholder:a(s)("discount.select_products"),loading:T.value,class:g(["w-full",{"p-invalid":r.value.select_product}]),onFilter:Q},null,8,["modelValue","options","optionLabel","filterPlaceholder","placeholder","loading","class"]),r.value.select_product?(p(),v("small",_e,n(r.value.select_product),1)):f("",!0)])):f("",!0),i("div",me,[i("div",fe,[i("label",he,[h(n(a(s)("discount.discount_value"))+" ",1),t.value.discount_type===1?(p(),v("span",ge,"("+n(a(s)("discount.fixed_amount"))+")",1)):(p(),v("span",xe,"(%)")),e[9]||(e[9]=i("span",{class:"text-red-500"},"*",-1))]),y(l,{type:"number",modelValue:t.value.discount_value,"onUpdate:modelValue":e[3]||(e[3]=u=>t.value.discount_value=u),placeholder:a(s)("discount.enter_discount_value"),class:g(["w-full",{"p-invalid":r.value.discount_value}])},null,8,["modelValue","placeholder","class"]),r.value.discount_value?(p(),v("small",be,n(r.value.discount_value),1)):f("",!0)]),i("div",Ve,[i("label",we,[h(n(a(s)("discount.expiration_date"))+" ",1),e[10]||(e[10]=i("span",{class:"text-red-500"},"*",-1))]),y(a(te),{modelValue:t.value.expires_at,"onUpdate:modelValue":e[4]||(e[4]=u=>t.value.expires_at=u),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:a(s)("discount.select_expiration_date"),class:g(["w-full",{"p-invalid":r.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),r.value.expiration_date?(p(),v("small",ke,n(r.value.expiration_date),1)):f("",!0)])]),i("div",De,[y(a(P),{type:"button",label:a(s)("discount.cancel"),icon:"pi pi-times",onClick:e[5]||(e[5]=u=>a(k).go(-1)),class:"px-6 py-3 bg-gray-200 hover:bg-gray-300 mx-2 text-gray-700 rounded-lg shadow-md",disabled:m.value},null,8,["label","disabled"]),y(a(P),{type:"submit",label:b.value?a(s)("discount.update_discount"):a(s)("discount.create_discount"),icon:"pi pi-check",loading:m.value,class:"px-8 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md"},null,8,["label","loading"])])],32),y(a(se))],8,oe)),[[d,"create discounts"]])}}},Te=z(Le,[["__scopeId","data-v-2742f8e8"]]);export{Te as default};
