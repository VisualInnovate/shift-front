import{_ as ae,u as te,p as re,q as oe,a as le,r as d,s as se,B as V,o as ne,ab as ie,c as u,d as c,D as de,f as a,t as i,h as l,g as b,e as g,m as ue,I as p,x as M,w as ce,F as pe,j as D,X as Y,Y as U,Z,z as ge}from"./index-21d8e7d9.js";import{l as B}from"./lodash-864ab509.js";const me={class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg"},ve={class:"text-3xl font-bold text-center mb-8 text-gray-800"},_e={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be={class:"space-y-2"},fe={for:"name_en",class:"block text-sm font-medium text-gray-700"},ye={class:"space-y-2"},he={for:"name_ar",class:"block text-sm font-medium text-gray-700"},xe={class:"space-y-2"},ke={for:"parent_id",class:"block text-sm font-medium text-gray-700"},we={class:"space-y-2"},De={for:"store_id",class:"block text-sm font-medium text-gray-700"},Ve={key:0,class:"space-y-2"},Pe={for:"market_id",class:"block text-sm font-medium text-gray-700"},je={class:"space-y-2"},Ce={class:"block text-sm font-medium text-gray-700"},Ee={class:"flex justify-center"},Se={key:0,class:"p-4 w-full h-full"},Ie={class:"relative group w-full h-full"},Fe=["src","alt"],$e={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Le={key:1,class:"p-4 flex flex-col items-center justify-center"},Te={class:"text-sm text-center text-gray-600"},Me={class:"text-blue-500 font-medium"},Ue={class:"space-y-2"},Be={class:"block text-sm font-medium text-gray-700"},Ae={class:"flex justify-center"},qe={key:0,class:"p-4 w-full h-full"},Re={class:"relative group w-full h-full"},Ne=["src","alt"],Oe={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},Qe={key:1,class:"p-4 flex flex-col items-center justify-center"},ze={class:"text-sm text-center text-gray-600"},Xe={class:"text-blue-500 font-medium"},Ye={class:"space-y-2 md:col-span-2"},Ze={class:"block text-sm font-medium text-gray-700"},Ge={class:"flex justify-center"},He={key:0,class:"p-4 w-full h-full"},Je={class:"relative group w-full h-full"},Ke=["src","alt"],We={class:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-30 flex items-center justify-center transition-all duration-300 rounded-lg"},ea={key:1,class:"p-4 flex flex-col items-center justify-center"},aa={class:"text-sm text-center text-gray-600"},ta={class:"text-blue-500 font-medium"},ra={class:"pt-4 flex justify-center space-x-4"},oa={key:0},la={key:1,class:"pi pi-spinner pi-spin"},sa={__name:"update",setup(na){const P=te(),A=re(),m=oe(),{t:r}=le(),v=d(!1),j=d(""),C=d(""),E=d(""),S=se(()=>localStorage.getItem("appLang")=="ar"?"name_ar":"name_en"),s=d({name_en:"",name_ar:"",linked_to_market:!1,market_id:null,parent_id:null,store_id:null,image:null,banner_one_image:null,banner_two_image:null}),f=d(null),y=d(null),h=d(null),q=d([]),R=d([]),N=d([]),x=d(!1),k=d(!1),w=d(!1),I=async()=>{try{const o=s.value.linked_to_market?"/api/market":"/api/category",e=await D.get(o,{params:{search:j.value||void 0}});q.value=e.data.data.data.map(n=>({...n,label:localStorage.getItem("appLang")=="ar"?n.name_ar:n.name_en,value:n.id}))}catch(o){console.error("Error fetching parent categories:",o),m.add({severity:"error",summary:r("error"),detail:s.value.linked_to_market?r("category.fetchMarketsError"):r("category.fetchParentError"),life:3e3})}},F=async()=>{try{const o=await D.get("/api/market",{params:{search:C.value||void 0}});R.value=o.data.data.data.map(e=>({...e,label:localStorage.getItem("appLang")=="ar"?e.name_ar:e.name_en,value:e.id}))}catch(o){console.error("Error fetching markets:",o),m.add({severity:"error",summary:r("error"),detail:r("category.fetchMarketsError"),life:3e3})}},$=async()=>{try{const o=await D.get("/api/store",{params:{search:E.value||void 0}});N.value=o.data.data.data.map(e=>({...e,label:localStorage.getItem("appLang")=="ar"?e.name_ar:e.name_en,value:e.id}))}catch(o){console.error("Error fetching stores:",o),m.add({severity:"error",summary:r("error"),detail:r("category.fetchStoresError"),life:3e3})}},O=B.debounce(I,300),Q=B.debounce(F,300),z=B.debounce($,300),G=o=>{j.value=o.value,O()},H=o=>{C.value=o.value,Q()},J=o=>{E.value=o.value,z()},K=async o=>{try{const n=(await D.get(`/api/category/${o}`)).data.data;s.value={name_en:n.name_en||"",name_ar:n.name_ar||"",linked_to_market:!!n.linked_to_market,market_id:n.market_id||null,parent_id:n.parent_id||null,store_id:n.store_id||null,image:null,banner_one_image:null,banner_two_image:null},n.media.forEach(t=>{t.name==="category_image"?f.value=t.url:t.name==="banner_one_image"?y.value=t.url:t.name==="banner_two_image"&&(h.value=t.url)})}catch(e){console.error("Error fetching category data:",e),m.add({severity:"error",summary:r("error"),detail:r("category.fetchError"),life:3e3})}},W=(o,e)=>{const n=new FileReader;n.onload=t=>{switch(e){case"image":s.value.image=o,f.value=t.target.result,x.value=!1;break;case"banner_one":s.value.banner_one_image=o,y.value=t.target.result,k.value=!1;break;case"banner_two":s.value.banner_two_image=o,h.value=t.target.result,w.value=!1;break}},n.readAsDataURL(o)},_=(o,e)=>{var t,T,X;const n=((t=o.target.files)==null?void 0:t[0])||((X=(T=o.dataTransfer)==null?void 0:T.files)==null?void 0:X[0]);n&&n.type.match("image.*")&&W(n,e)},L=o=>{switch(o){case"image":s.value.image=null,f.value=null;break;case"banner_one":s.value.banner_one_image=null,y.value=null;break;case"banner_two":s.value.banner_two_image=null,h.value=null;break}},ee=async()=>{var e,n;v.value=!0;const o=new FormData;o.append("name_en",s.value.name_en),o.append("name_ar",s.value.name_ar),o.append("linked_to_market",s.value.linked_to_market?"1":"0"),o.append("market_id",s.value.market_id||""),o.append("parent_id",s.value.parent_id||""),o.append("store_id",s.value.store_id||""),s.value.image&&o.append("image",s.value.image),s.value.banner_one_image&&o.append("banner_one_image",s.value.banner_one_image),s.value.banner_two_image&&o.append("banner_two_image",s.value.banner_two_image),o.append("_method","post");try{const t=A.params.id;if(!t)throw new Error("Category ID is required for update");const T=await D.post(`/api/category/${t}`,o,{headers:{"Content-Type":"multipart/form-data"}});P.push({name:"category"}),m.add({severity:"success",summary:r("success"),detail:r("category.updateSuccess"),life:3e3})}catch(t){console.error("Error:",t),m.add({severity:"error",summary:r("error"),detail:((n=(e=t.response)==null?void 0:e.data)==null?void 0:n.message)||r("category.updateError"),life:3e3})}finally{v.value=!1}};return V([()=>s.value.linked_to_market,j],()=>{s.value.parent_id=null,O()}),V(C,Q),V(E,z),V(()=>localStorage.getItem("appLang"),()=>{I(),F(),$()}),ne(async()=>{const o=A.params.id;if(!o){m.add({severity:"error",summary:r("error"),detail:r("category.idRequired"),life:3e3}),P.push({name:"category"});return}await Promise.all([K(o),F(),I(),$()])}),(o,e)=>{const n=ie("can");return u(),c(pe,null,[de((u(),c("div",me,[a("h1",ve,i(l(r)("category.updateTitle")),1),a("form",{onSubmit:p(ee,["prevent"]),class:"space-y-6"},[a("div",_e,[a("div",be,[a("label",fe,[b(i(l(r)("category.nameEn"))+" ",1),e[21]||(e[21]=a("span",{class:"text-red-500"},"*",-1))]),g(l(Y),{id:"name_en",modelValue:s.value.name_en,"onUpdate:modelValue":e[0]||(e[0]=t=>s.value.name_en=t),placeholder:l(r)("category.nameEnPlaceholder"),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:""},null,8,["modelValue","placeholder"])]),a("div",ye,[a("label",he,[b(i(l(r)("category.nameAr"))+" ",1),e[22]||(e[22]=a("span",{class:"text-red-500"},"*",-1))]),g(l(Y),{id:"name_ar",modelValue:s.value.name_ar,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.name_ar=t),placeholder:l(r)("category.nameArPlaceholder"),dir:"rtl",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",required:""},null,8,["modelValue","placeholder"])]),a("div",xe,[a("label",ke,i(s.value.linked_to_market?l(r)("category.market"):l(r)("category.parent")),1),g(l(U),{modelValue:s.value.parent_id,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.parent_id=t),options:q.value,optionLabel:S.value,optionValue:"id",placeholder:s.value.linked_to_market?l(r)("category.selectMarket"):l(r)("category.selectParent"),class:"w-full",filter:"",filterPlaceholder:s.value.linked_to_market?l(r)("category.searchMarkets"):l(r)("category.searchParent"),onFilter:G},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])]),a("div",we,[a("label",De,i(l(r)("category.store")),1),g(l(U),{modelValue:s.value.store_id,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.store_id=t),options:N.value,optionLabel:S.value,optionValue:"id",placeholder:l(r)("category.selectStore"),class:"w-full",filter:"",filterPlaceholder:l(r)("category.searchStores"),onFilter:J},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])]),s.value.linked_to_market?(u(),c("div",Ve,[a("label",Pe,[b(i(l(r)("category.market"))+" ",1),e[23]||(e[23]=a("span",{class:"text-red-500"},"*",-1))]),g(l(U),{modelValue:s.value.market_id,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.market_id=t),options:R.value,optionLabel:S.value,optionValue:"id",placeholder:l(r)("category.selectMarket"),class:"w-full",filter:"",filterPlaceholder:l(r)("category.searchMarkets"),onFilter:H},null,8,["modelValue","options","optionLabel","placeholder","filterPlaceholder"])])):ue("",!0),a("div",je,[a("label",Ce,i(l(r)("category.image")),1),a("div",Ee,[a("label",{onDragover:e[7]||(e[7]=p(t=>x.value=!0,["prevent"])),onDragleave:e[8]||(e[8]=t=>x.value=!1),onDrop:e[9]||(e[9]=p(t=>_(t,"image"),["prevent"])),class:M([{"border-blue-500 bg-blue-50":x.value,"border-gray-300":!x.value},"cursor-pointer w-full h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[5]||(e[5]=t=>_(t,"image")),accept:"image/*",class:"hidden"},null,32),f.value?(u(),c("div",Se,[a("div",Ie,[a("img",{src:f.value,alt:l(r)("category.imagePreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Fe),a("div",$e,[a("button",{type:"button",onClick:e[6]||(e[6]=p(t=>L("image"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[24]||(e[24]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",Le,[e[25]||(e[25]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",Te,[a("span",Me,i(l(r)("category.clickToUpload")),1),b(" "+i(l(r)("category.orDragAndDrop")),1)])]))],34)])]),a("div",Ue,[a("label",Be,i(l(r)("category.bannerOne")),1),a("div",Ae,[a("label",{onDragover:e[12]||(e[12]=p(t=>k.value=!0,["prevent"])),onDragleave:e[13]||(e[13]=t=>k.value=!1),onDrop:e[14]||(e[14]=p(t=>_(t,"banner_one"),["prevent"])),class:M([{"border-blue-500 bg-blue-50":k.value,"border-gray-300":!k.value},"cursor-pointer w-full h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[10]||(e[10]=t=>_(t,"banner_one")),accept:"image/*",class:"hidden"},null,32),y.value?(u(),c("div",qe,[a("div",Re,[a("img",{src:y.value,alt:l(r)("category.bannerOnePreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Ne),a("div",Oe,[a("button",{type:"button",onClick:e[11]||(e[11]=p(t=>L("banner_one"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[26]||(e[26]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",Qe,[e[27]||(e[27]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",ze,[a("span",Xe,i(l(r)("category.clickToUpload")),1),b(" "+i(l(r)("category.orDragAndDrop")),1)])]))],34)])]),a("div",Ye,[a("label",Ze,i(l(r)("category.bannerTwo")),1),a("div",Ge,[a("label",{onDragover:e[17]||(e[17]=p(t=>w.value=!0,["prevent"])),onDragleave:e[18]||(e[18]=t=>w.value=!1),onDrop:e[19]||(e[19]=p(t=>_(t,"banner_two"),["prevent"])),class:M([{"border-blue-500 bg-blue-50":w.value,"border-gray-300":!w.value},"cursor-pointer w-full max-w-2xl h-48 rounded-xl border-2 border-dashed transition-colors duration-300 flex items-center justify-center"])},[a("input",{type:"file",onChange:e[15]||(e[15]=t=>_(t,"banner_two")),accept:"image/*",class:"hidden"},null,32),h.value?(u(),c("div",He,[a("div",Je,[a("img",{src:h.value,alt:l(r)("category.bannerTwoPreview"),class:"w-full h-full object-contain rounded-lg shadow-md transition-transform duration-300 group-hover:scale-105"},null,8,Ke),a("div",We,[a("button",{type:"button",onClick:e[16]||(e[16]=p(t=>L("banner_two"),["stop"])),class:"opacity-0 group-hover:opacity-100 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition"},e[28]||(e[28]=[a("i",{class:"pi pi-trash text-sm"},null,-1)]))])])])):(u(),c("div",ea,[e[29]||(e[29]=a("div",{class:"bg-blue-100 p-3 rounded-full mb-2"},[a("i",{class:"pi pi-image text-blue-500 text-xl"})],-1)),a("p",aa,[a("span",ta,i(l(r)("category.clickToUpload")),1),b(" "+i(l(r)("category.orDragAndDrop")),1)])]))],34)])])]),a("div",ra,[g(l(Z),{type:"button",label:l(r)("cancel"),icon:"pi pi-times",onClick:e[20]||(e[20]=t=>l(P).go(-1)),class:"px-6 py-3 mx-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:v.value},null,8,["label","disabled"]),g(l(Z),{type:"submit",label:l(r)("category.updateButton"),icon:"pi pi-check",loading:v.value,class:"px-8 mx-2 py-3 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-md hover:shadow-lg transition-all duration-300 flex items-center justify-center space-x-2",disabled:v.value},{default:ce(()=>[v.value?(u(),c("i",la)):(u(),c("span",oa,i(l(r)("category.updateButton")),1))]),_:1},8,["label","loading","disabled"])])],32)])),[[n,"create categories"]]),g(l(ge))],64)}}},ua=ae(sa,[["__scopeId","data-v-60c31e63"]]);export{ua as default};
