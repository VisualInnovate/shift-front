import{_ as H,c,l as J,p as K,a as Q,u as X,r as f,x as M,o as Z,a1 as ee,B as te,e as p,h as v,g as r,t as n,j as o,v as g,i as _,A as j,n as w,G as ae,b as V,V as S,aj as se,al as le,W as U,k as oe}from"./index-48daaf2f.js";import{h as ie}from"./moment-fbc5633a.js";const re=["dir"],ue={class:"text-3xl font-bold text-center mb-8 text-gray-800"},ne={class:"space-y-2"},de={class:"block text-sm font-medium text-gray-700"},ce={key:0,class:"p-error"},pe={key:0,class:"space-y-2"},ve={class:"block text-sm font-medium text-gray-700"},_e={class:"text-xs text-gray-600"},me={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},ye={class:"space-y-2"},fe={class:"block text-sm font-medium text-gray-700"},he={key:0},ge={key:1},xe={key:0,class:"p-error"},be={class:"space-y-2"},we={class:"block text-sm font-medium text-gray-700"},Ve={key:0,class:"p-error"},ke={class:"pt-6 flex justify-center gap-6"},$e={__name:"update",setup(De){const q=c(()=>localStorage.getItem("appLang")||"en"),k=c(()=>q.value==="en"?"name_en":"name_ar"),Y=c(()=>q.value==="ar"),$=J(),D=K(),m=Q(),{t:l}=X(),x=c(()=>!!D.params.id),y=f(!1),u=f({}),s=f({type:"product",product_id:null,variant_id:null,discount_type:1,discount_value:null,expires_at:null}),F=f([]),b=f(""),L=f(!1),T=c(()=>F.value.find(t=>t.id===s.value.product_id)),E=c(()=>{var t;return((t=T.value)==null?void 0:t.variants)||[]});M(E,t=>{t.length>0&&!s.value.variant_id?s.value.variant_id=t[0].id:t.length===0&&(s.value.variant_id=null)});const A=c(()=>T.value&&T.value.has_variants===!0),C=t=>{const e=t[k.value],i=t.base_price?t.base_price:"N/A";return`${e} - ${i}`},N=t=>{const e=t.price?t.price:"N/A";return`${t.sku} - ${e}`};M(()=>s.value.product_id,()=>{s.value.variant_id=null});const h=async()=>{L.value=!0;try{const{data:t}=await V.get("/api/discount/create/data",{params:{search:b.value||void 0,per_page:100}});F.value=t.data.data??[]}catch(t){console.error(t),m.add({severity:"error",summary:l("error"),detail:l("error.productLoad"),life:3e3})}finally{L.value=!1}};let I;const O=t=>{console.log("Product filter event:",t),b.value=t.value??"",clearTimeout(I),I=setTimeout(h,300)},z=async()=>{var t,e;y.value=!0;try{const{data:i}=await V.get(`/api/discount/${D.params.id}`),a=i.data;if(s.value={type:a.type,product_id:null,variant_id:null,discount_type:a.discount_type,discount_value:parseFloat(a.discount_value),expires_at:a.expires_at?new Date(a.expires_at):null},a.type==="product"&&a.products.length>0)s.value.product_id=a.products[0].id;else if(a.type==="variant"&&a.variants.length>0){const d=a.variants[0];s.value.product_id=d.product_id,s.value.variant_id=d.id}await h(),console.log(a.type),a.type==="product"&&a.products.length>0?(b.value=a.products[0][k.value],await h()):a.type==="variant"&&a.variants.length>0&&(b.value=a.variants[0].product[k.value],await h())}catch(i){console.error("Error loading discount:",i),m.add({severity:"error",summary:l("error"),detail:((e=(t=i.response)==null?void 0:t.data)==null?void 0:e.message)||l("error.loadError"),life:3e3}),$.push({name:"discount"})}finally{y.value=!1}};class G{constructor(e,i){this.errors=e,this.t=i}required(e,i){return e==null?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):!0}numericRange(e,i,a,d=null){return e===null||isNaN(e)?(this.errors.value[i]=this.t("validation.requiredFields",{field:this.t(`discount.${i}`)}),!1):a!==null&&e<a?(this.errors.value[i]=this.t("validation.minValue",{field:this.t(`discount.${i}`),min:a}),!1):d!==null&&e>d?(this.errors.value[i]=this.t("validation.maxValue",{field:this.t(`discount.${i}`),max:d}),!1):!0}isValid(){return Object.keys(this.errors.value).length===0}}const W=async()=>{var R,B;u.value={};const t=new G(u,l);if(t.required(s.value.product_id,"select_product"),t.required(s.value.discount_type,"discount_method"),t.numericRange(s.value.discount_value,"discount_value",0),t.required(s.value.expires_at,"expiration_date"),!t.isValid()){const P=Object.values(u.value).join(", ");m.add({severity:"error",summary:l("error"),detail:P,life:3e3});return}y.value=!0;const e=s.value.variant_id!==null,i=e?"variant":"product",a=e?s.value.variant_id:s.value.product_id,d={type:i,ids:[a],discount_type:s.value.discount_type,discount_value:s.value.discount_value,expires_at:ie(s.value.expires_at).format("YYYY-MM-DD")};try{x.value?(await V.put(`/api/discount/${D.params.id}`,d),m.add({severity:"success",summary:l("success"),detail:l("discount.updated_successfully"),life:3e3})):(await V.post("/api/discount",d),m.add({severity:"success",summary:l("success"),detail:l("discount.created_successfully"),life:3e3})),$.push({name:"discount"})}catch(P){m.add({severity:"error",summary:l("error"),detail:((B=(R=P.response)==null?void 0:R.data)==null?void 0:B.message)||l("error.saveError"),life:3e3})}finally{y.value=!1}};return Z(async()=>{await h(),x.value&&await z()}),(t,e)=>{const i=ee("can");return te((p(),v("div",{class:"max-w-5xl mx-auto p-6 bg-white rounded-xl shadow-lg",dir:Y.value?"rtl":"ltr"},[r("h1",ue,n(x.value?o(l)("discount.edit_discount"):o(l)("discount.create_new_discount")),1),r("form",{onSubmit:ae(W,["prevent"]),class:"space-y-8"},[r("div",ne,[r("label",de,[g(n(o(l)("discount.select_product"))+" ",1),e[5]||(e[5]=r("span",{class:"text-red-500"},"*",-1))]),_(o(S),{modelValue:s.value.product_id,"onUpdate:modelValue":e[0]||(e[0]=a=>s.value.product_id=a),options:F.value,optionLabel:C,optionValue:"id",filter:"",filterPlaceholder:o(l)("discount.searchProducts"),placeholder:o(l)("discount.select_product"),loading:L.value,class:j(["w-full",{"p-invalid":u.value.select_product}]),onFilter:O},null,8,["modelValue","options","filterPlaceholder","placeholder","loading","class"]),u.value.select_product?(p(),v("small",ce,n(u.value.select_product),1)):w("",!0)]),A.value?(p(),v("div",pe,[r("label",ve,[g(n(o(l)("discount.select_variant"))+" ",1),e[6]||(e[6]=r("span",{class:"text-gray-500"},"(اختياري)",-1))]),g(" "+n(s.value.variant_id)+" ",1),_(o(S),{modelValue:s.value.variant_id,"onUpdate:modelValue":e[1]||(e[1]=a=>s.value.variant_id=a),options:E.value,optionLabel:N,optionValue:"id",placeholder:o(l)("discount.apply_to_whole_product"),class:"w-full",clearable:""},null,8,["modelValue","options","placeholder"]),r("small",_e,n(o(l)("discount.variant_hint")||"اتركه فارغاً لتطبيق الخصم على المنتج بأكمله (جميع المتغيرات)"),1)])):w("",!0),r("div",me,[r("div",ye,[r("label",fe,[g(n(o(l)("discount.discount_value"))+" ",1),s.value.discount_type===1?(p(),v("span",he,"("+n(o(l)("discount.fixed_amount"))+")",1)):(p(),v("span",ge,"(%)")),e[7]||(e[7]=r("span",{class:"text-red-500"},"*",-1))]),_(o(se),{modelValue:s.value.discount_value,"onUpdate:modelValue":e[2]||(e[2]=a=>s.value.discount_value=a),mode:"decimal",minFractionDigits:2,maxFractionDigits:2,min:0,max:s.value.discount_type===2?100:null,placeholder:o(l)("discount.enter_discount_value"),class:j(["w-full",{"p-invalid":u.value.discount_value}])},null,8,["modelValue","max","placeholder","class"]),u.value.discount_value?(p(),v("small",xe,n(u.value.discount_value),1)):w("",!0)]),r("div",be,[r("label",we,[g(n(o(l)("discount.expiration_date"))+" ",1),e[8]||(e[8]=r("span",{class:"text-red-500"},"*",-1))]),_(o(le),{modelValue:s.value.expires_at,"onUpdate:modelValue":e[3]||(e[3]=a=>s.value.expires_at=a),minDate:new Date,dateFormat:"yy-mm-dd",placeholder:o(l)("discount.select_expiration_date"),class:j(["w-full",{"p-invalid":u.value.expiration_date}]),showIcon:""},null,8,["modelValue","minDate","placeholder","class"]),u.value.expiration_date?(p(),v("small",Ve,n(u.value.expiration_date),1)):w("",!0)])]),r("div",ke,[_(o(U),{type:"button",label:o(l)("discount.cancel"),icon:"pi pi-times",onClick:e[4]||(e[4]=a=>o($).go(-1)),severity:"secondary",disabled:y.value},null,8,["label","disabled"]),_(o(U),{type:"submit",label:x.value?o(l)("discount.update_discount"):o(l)("discount.create_discount"),icon:"pi pi-check",loading:y.value},null,8,["label","loading"])])],32),_(o(oe))],8,re)),[[i,"create discounts"]])}}},Te=H($e,[["__scopeId","data-v-b39ac082"]]);export{Te as default};
